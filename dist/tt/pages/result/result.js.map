{"version":3,"file":"pages/result/result.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AC5VA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;ACnQA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;AC7CA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;ACrDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApBA;AAAA;AAAA;AAoBA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC9WA;AACA;AACA;AACA;;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;ACrGA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;;AAKA;AACA;AACA;;AAKA;AACA;AACA;;AAKA;AACA;AACA;AAIA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAAA;AAAA;AAAA;AAEA;AACA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAAA;AAAA;AASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAEA;;AAEA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;;;;;;;;;;;ACr4BA;AACA;AAEA;AACA;;AAMA;AACA;;AAQA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;;AAGA;AACA;;AA2CA;AACA;;AAmBA;AACA;;AAmBA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAKA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAIA;AACA;AACA;AAIA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAKA;AAAA;AACA;AACA;AAIA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAGA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAGA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AAEA;AAEA;AAGA;;AAGA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;;AAGA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAKA;AACA;AACA;;AAEA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AAEA;AAGA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAGA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;;AAEA;AACA;AACA;AACA;AAEA;AACA;AAIA;AACA;AACA;AAEA;AACA;AAIA;AACA;AACA;AAKA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAEA;;;;;;;;;;AC/wBA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAOA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAEA;AACA;AACA;;;;;;;;;;;AChGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;;;AC5CA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAGA;AAGA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC5EA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAWA;AACA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAiBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAiBA;AACA;AAAA;AAXA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAgBA;AACA;AAAA;AAVA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAEA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AA1BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6BA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzmBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC//BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACdA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;ACLA;AACA;AACA;AACA;AACA;;;;;;;;;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;ACjDA;AACA;AACA;AACA;;;;;;;;;;ACHA;AACA;AACA;AACA;;;;;;;;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;ACPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://AppStarCardWXSS/./src/pages/result/result.tsx?b30d","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/alipay.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/index.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/calc.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/downloader.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/gradient.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/pen.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/qrcode.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/sha1.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/string-polyfill.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/util.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/libs/wx-canvas.js","webpack://AppStarCardWXSS/./node_modules/@hb/taro-fusion-components/esm/components/Poster/weapp.js","webpack://AppStarCardWXSS/./src/pages/result/result.tsx","webpack://AppStarCardWXSS/./node_modules/@babel/runtime/helpers/arrayLikeToArray.js","webpack://AppStarCardWXSS/./node_modules/@babel/runtime/helpers/arrayWithoutHoles.js","webpack://AppStarCardWXSS/./node_modules/@babel/runtime/helpers/createForOfIteratorHelper.js","webpack://AppStarCardWXSS/./node_modules/@babel/runtime/helpers/iterableToArray.js","webpack://AppStarCardWXSS/./node_modules/@babel/runtime/helpers/nonIterableSpread.js","webpack://AppStarCardWXSS/./node_modules/@babel/runtime/helpers/toConsumableArray.js","webpack://AppStarCardWXSS/./node_modules/@babel/runtime/helpers/unsupportedIterableToArray.js","webpack://AppStarCardWXSS/./node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js"],"sourcesContent":["import _classCallCheck from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nvar _class;\nimport React, { Component, Fragment } from 'react';\nimport { observer } from 'mobx-react';\nimport { View, Image, Text } from '@tarojs/components';\nimport { PageSkeleton, Native, Poster, SafeAreaView, PageHeader } from '@hb/taro-fusion-components';\nimport Taro from '@tarojs/taro';\nimport posterConfig from './data/result-poster.json';\nimport './result.scss';\nimport { appraisalPassed, checkSuccess, identifyText_icon } from '@/assets/index';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Result = observer(_class = /*#__PURE__*/function (_Component) {\n  function Result() {\n    var _this;\n    _classCallCheck(this, Result);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, Result, [].concat(args));\n    _defineProperty(_this, \"state\", {\n      posterUrl: '',\n      generating: false\n    });\n    // 返回上一页\n    _defineProperty(_this, \"handleBack\", function () {\n      Taro.navigateBack();\n    });\n    // 分享功能\n    _defineProperty(_this, \"handleShare\", function () {\n      Taro.showActionSheet({\n        itemList: ['保存鉴别证书', '分享给好友'],\n        success: function success(res) {\n          if (res.tapIndex === 0) {\n            _this.handleSaveImage();\n          } else if (res.tapIndex === 1) {\n            _this.handleShareToFriend();\n          }\n        }\n      });\n    });\n    // 长按生成图片\n    _defineProperty(_this, \"handleLongPress\", function () {\n      _this.handleSaveImage();\n    });\n    // 生成并保存图片\n    _defineProperty(_this, \"handleSaveImage\", function () {\n      try {\n        _this.setState({\n          generating: true\n        });\n        Taro.showLoading({\n          title: '正在生成证书...'\n        });\n\n        // 使用 Poster 组件生成图片\n        // posterUrl 会在 onReady 回调中设置\n      } catch (_unused) {\n        _this.handleGenerateError();\n      }\n    });\n    // 处理生成错误\n    _defineProperty(_this, \"handleGenerateError\", function () {\n      Taro.hideLoading();\n      Taro.showToast({\n        title: '生成失败，请重试',\n        icon: 'none'\n      });\n      _this.setState({\n        generating: false\n      });\n    });\n    // Poster 生成完成回调\n    _defineProperty(_this, \"handlePosterReady\", function (path) {\n      _this.setState({\n        posterUrl: path,\n        generating: false\n      });\n      Taro.hideLoading();\n\n      // 先预览图片\n      Taro.previewImage({\n        urls: [path],\n        current: path\n      });\n\n      // 询问是否保存\n      setTimeout(function () {\n        Taro.showModal({\n          title: '保存鉴别证书',\n          content: '是否保存鉴别证书到相册？',\n          success: function success(res) {\n            if (res.confirm) {\n              _this.saveToAlbum(path);\n            }\n          }\n        });\n      }, 1000);\n    });\n    // 保存到相册\n    _defineProperty(_this, \"saveToAlbum\", function (filePath) {\n      Taro.saveImageToPhotosAlbum({\n        filePath: filePath,\n        success: function success() {\n          Taro.showToast({\n            title: '已保存到相册',\n            icon: 'success'\n          });\n        },\n        fail: function fail(err) {\n          // 处理权限问题\n          if (err.errMsg.includes('auth')) {\n            Taro.showModal({\n              title: '需要授权',\n              content: '需要您授权保存图片到相册',\n              success: function success(res) {\n                if (res.confirm) {\n                  Taro.openSetting();\n                }\n              }\n            });\n          } else {\n            Taro.showToast({\n              title: '保存失败',\n              icon: 'none'\n            });\n          }\n        }\n      });\n    });\n    // 分享给好友\n    _defineProperty(_this, \"handleShareToFriend\", function () {\n      if (_this.state.posterUrl) {\n        Taro.showShareImageMenu({\n          path: _this.state.posterUrl\n        });\n      } else {\n        Taro.showToast({\n          title: '请先生成证书',\n          icon: 'none'\n        });\n      }\n    });\n    return _this;\n  }\n  _inherits(Result, _Component);\n  return _createClass(Result, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      Native.hideHomeButton();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var generating = this.state.generating;\n      return /*#__PURE__*/_jsxs(PageSkeleton, {\n        className: \"page-result-view\",\n        children: [/*#__PURE__*/_jsx(Fragment, {\n          children: /*#__PURE__*/_jsx(PageHeader, {\n            className: \"custom-page-header\",\n            title: \"\\u9274\\u522B\\u7ED3\\u679C\",\n            backIconColor: \"white\",\n            bgColor: \"#020202\",\n            titleColor: \"#fff\"\n          })\n        }, \"header\"), /*#__PURE__*/_jsxs(Fragment, {\n          children: [/*#__PURE__*/_jsxs(View, {\n            className: \"content-card\",\n            onLongPress: this.handleLongPress,\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"title-section\",\n              children: [/*#__PURE__*/_jsxs(View, {\n                className: \"title-header\",\n                children: [/*#__PURE__*/_jsx(View, {\n                  className: \"line\"\n                }), /*#__PURE__*/_jsx(Text, {\n                  className: \"title-text\",\n                  children: \"\\u5728\\u7EBF\\u9274\\u5B9A\\u8BC1\\u660E\"\n                }), /*#__PURE__*/_jsx(View, {\n                  className: \"line\"\n                })]\n              }), /*#__PURE__*/_jsx(View, {\n                className: \"result-status\",\n                children: \"\\u7B26\\u5408\\u6B63\\u54C1\\u7279\\u5F81\"\n              }), /*#__PURE__*/_jsx(View, {\n                className: \"result-tip\",\n                children: \"\\u9274\\u522B\\u7ED3\\u679C\\u6839\\u636E\\u7528\\u6237\\u4FE1\\u606F\\u5F97\\u51FA\"\n              })]\n            }), /*#__PURE__*/_jsx(View, {\n              className: \"img-section\",\n              children: /*#__PURE__*/_jsxs(View, {\n                className: \"product-image-container\",\n                children: [/*#__PURE__*/_jsx(Image, {\n                  src: \"https://img1.baidu.com/it/u=293340820,2978436854&fm=253&app=138&f=JPEG?w=683&h=856\",\n                  className: \"product-image\",\n                  mode: \"aspectFill\"\n                }), /*#__PURE__*/_jsx(Image, {\n                  src: appraisalPassed,\n                  className: \"verify-badge\"\n                })]\n              })\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"appraiser-info\",\n              children: [/*#__PURE__*/_jsx(Image, {\n                className: \"appraiser-avatar\",\n                src: \"https://img1.baidu.com/it/u=293340820,2978436854&fm=253&app=138&f=JPEG?w=683&h=856\",\n                mode: \"aspectFill\"\n              }), /*#__PURE__*/_jsxs(View, {\n                children: [/*#__PURE__*/_jsxs(View, {\n                  className: \"appraiser-badge\",\n                  children: [/*#__PURE__*/_jsx(Image, {\n                    src: identifyText_icon,\n                    className: \"verified-icon\"\n                  }), /*#__PURE__*/_jsx(Text, {\n                    className: \"badge-text\",\n                    children: \"\\u661F\\u5361\\u9274\\u5B9A\\u5E08\"\n                  })]\n                }), /*#__PURE__*/_jsx(View, {\n                  className: \"appraiser-name\",\n                  children: \"\\u6930\\u6930\"\n                })]\n              })]\n            }), /*#__PURE__*/_jsx(View, {\n              className: \"description\",\n              children: \"\\u201C\\u5C0F\\u5361\\u7EC6\\u8282\\u5DE5\\u827A\\u7B26\\u5408\\u6B63\\u54C1\\u7279\\u5F81\\uFF0C\\u9274\\u522B\\u901A\\u8FC7\\uFF0C\\u7EB9\\u8DEF\\u6BD4\\u4F8B\\u5207\\u89D2\\u6CA1\\u95EE\\u9898\\u201D\"\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"analysis-header\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"analysis-title\",\n                children: \"\\u9274\\u522B\\u90E8\\u4F4D\\u5206\\u6790\"\n              }), /*#__PURE__*/_jsxs(View, {\n                className: \"header-right\",\n                children: [/*#__PURE__*/_jsx(Text, {\n                  className: \"analysis-count\",\n                  children: \"5\\u9879\\u5168\\u901A\\u8FC7\"\n                }), /*#__PURE__*/_jsx(Image, {\n                  src: checkSuccess,\n                  className: \"check-success-icon\"\n                })]\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"check-list\",\n              children: [/*#__PURE__*/_jsxs(View, {\n                className: \"check-item\",\n                children: [/*#__PURE__*/_jsx(Text, {\n                  className: \"check-label\",\n                  children: \"\\u5C0F\\u5361\\u6B63\\u9762\"\n                }), /*#__PURE__*/_jsx(View, {\n                  className: \"divider-line\"\n                }), /*#__PURE__*/_jsx(Image, {\n                  src: checkSuccess,\n                  className: \"check-success-icon\"\n                })]\n              }), /*#__PURE__*/_jsxs(View, {\n                className: \"check-item\",\n                children: [/*#__PURE__*/_jsx(Text, {\n                  className: \"check-label\",\n                  children: \"\\u5C0F\\u5361\\u80CC\\u9762\"\n                }), /*#__PURE__*/_jsx(View, {\n                  className: \"divider-line\"\n                }), /*#__PURE__*/_jsx(Image, {\n                  src: checkSuccess,\n                  className: \"check-success-icon\"\n                })]\n              }), /*#__PURE__*/_jsxs(View, {\n                className: \"check-item\",\n                children: [/*#__PURE__*/_jsx(Text, {\n                  className: \"check-label\",\n                  children: \"\\u5C0F\\u5361\\u6B63\\u9762\\u7EB9\\u8DEF\\u5BF9\\u5149\"\n                }), /*#__PURE__*/_jsx(View, {\n                  className: \"divider-line\"\n                }), /*#__PURE__*/_jsx(Image, {\n                  src: checkSuccess,\n                  className: \"check-success-icon\"\n                })]\n              }), /*#__PURE__*/_jsxs(View, {\n                className: \"check-item\",\n                children: [/*#__PURE__*/_jsx(Text, {\n                  className: \"check-label\",\n                  children: \"\\u5C0F\\u5361\\u80CC\\u9762\\u6587\\u5B57logo\"\n                }), /*#__PURE__*/_jsx(View, {\n                  className: \"divider-line\"\n                }), /*#__PURE__*/_jsx(Image, {\n                  src: checkSuccess,\n                  className: \"check-success-icon\"\n                })]\n              }), /*#__PURE__*/_jsxs(View, {\n                className: \"check-item\",\n                children: [/*#__PURE__*/_jsx(Text, {\n                  className: \"check-label\",\n                  children: \"\\u5C0F\\u5361\\u50CF\\u7D20\\u70B9\"\n                }), /*#__PURE__*/_jsx(View, {\n                  className: \"divider-line\"\n                }), /*#__PURE__*/_jsx(Image, {\n                  src: checkSuccess,\n                  className: \"check-success-icon\"\n                })]\n              })]\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"info-section\",\n              children: [/*#__PURE__*/_jsxs(View, {\n                className: \"info-row\",\n                children: [/*#__PURE__*/_jsx(Text, {\n                  className: \"info-label\",\n                  children: \"\\u9274\\u522BID\\uFF1A\"\n                }), /*#__PURE__*/_jsx(Text, {\n                  className: \"info-value\",\n                  children: \"73r9273894377789\"\n                })]\n              }), /*#__PURE__*/_jsxs(View, {\n                className: \"info-row\",\n                children: [/*#__PURE__*/_jsx(Text, {\n                  className: \"info-label\",\n                  children: \"\\u9274\\u522B\\u65F6\\u95F4\\uFF1A\"\n                }), /*#__PURE__*/_jsx(Text, {\n                  className: \"info-value\",\n                  children: \"2025-10-05\"\n                }), /*#__PURE__*/_jsx(Text, {\n                  className: \"info-value\",\n                  children: \"13:30\"\n                })]\n              })]\n            })]\n          }), generating && /*#__PURE__*/_jsx(View, {\n            style: {\n              position: 'fixed',\n              left: '-9999px',\n              top: '-9999px'\n            },\n            children: /*#__PURE__*/_jsx(Poster, {\n              palette: posterConfig.data,\n              onReady: this.handlePosterReady\n            })\n          })]\n        }, \"scroll\"), /*#__PURE__*/_jsx(Fragment, {\n          children: /*#__PURE__*/_jsx(Text, {\n            className: \"footer-tip\",\n            children: \"\\u5728\\u7EBF\\u9274\\u5B9A\\u7ED3\\u679C\\u4EC5\\u4F9B\\u53C2\\u8003\\uFF0C\\u5177\\u4F53\\u60C5\\u51B5\\u4EE5\\u5B9E\\u7269\\u4E3A\\u51C6\"\n          })\n        }, 'footer'), /*#__PURE__*/_jsx(SafeAreaView, {\n          safeAreaInsetBottom: true\n        })]\n      });\n    }\n  }]);\n}(Component)) || _class;\nexport { Result as default };","import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\n/* eslint-disable */\nimport React, { Component } from 'react';\nimport { View, Canvas } from '@tarojs/components';\nimport Taro from '@tarojs/taro';\nfunction getNum() {\n  var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  return parseFloat(value);\n}\nvar AlipayPoster = /*#__PURE__*/function (_Component) {\n  function AlipayPoster(props) {\n    var _this;\n    _classCallCheck(this, AlipayPoster);\n    _this = _callSuper(this, AlipayPoster, [props]);\n    _defineProperty(_this, \"deviceWidth\", 375);\n    _this.state = {\n      picURL: '',\n      showCanvas: true,\n      painterStyle: '',\n      photoStyle: ''\n    };\n    return _this;\n  }\n  _inherits(AlipayPoster, _Component);\n  return _createClass(AlipayPoster, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _my$getSystemInfoSync = my.getSystemInfoSync(),\n        screen = _my$getSystemInfoSync.screen;\n      var _ref = screen || {},\n        _ref$width = _ref.width,\n        width = _ref$width === void 0 ? 375 : _ref$width;\n      this.deviceWidth = width;\n    }\n  }, {\n    key: \"triggerEvent\",\n    value: function triggerEvent(method, data) {\n      if (this.props[method]) {\n        this.props[method](data);\n      }\n    }\n\n    /**\n     * 测量文本宽度（代替`ctx.measureText`）\n     * @description fix mpaas bug: `measureText` 在真机上无法测量超过屏幕宽度（1x）的文本。\n     * 故这里对文本进行切片，然后计算每个切片的长度，最后累加。\n     * @param {*} text\n     * @param {*} fontSize\n     */\n  }, {\n    key: \"measureText\",\n    value: function measureText(ctx, text, fontSize) {\n      // 单元切片的字数, 乘以0.8是为了确保每个切片在安全区域内  \n      var unitSliceFontCount = Math.ceil(this.deviceWidth / fontSize * 0.8);\n\n      // 如果文本长度小于等于单片长度，则直接测量，无需切分\n      if (text.length <= unitSliceFontCount) {\n        return ctx.measureText(text);\n      }\n      var sliceStartIndex = 0;\n      var sliceEndIndex = unitSliceFontCount;\n      var textWidth = 0;\n      while (sliceStartIndex < text.length) {\n        var unitSliceText = text.slice(sliceStartIndex, sliceEndIndex);\n        textWidth += ctx.measureText(unitSliceText).width;\n        sliceStartIndex += unitSliceFontCount;\n        sliceEndIndex += unitSliceFontCount;\n      }\n      return {\n        width: textWidth\n      };\n    }\n\n    /**\n     * 将一段文字拆成多段\n     * @param {*} ctx\n     * @param {*} text\n     * @param {*} fontSize\n     * @param {*} width\n     * @param {*} maxLines\n     */\n  }, {\n    key: \"splitText\",\n    value: function splitText(ctx, text, fontSize, width, maxLines) {\n      var arr = [];\n\n      // 记录剩余文字\n      var remainText = text;\n      while (arr.length < maxLines - 1 && this.measureText(ctx, remainText, fontSize).width > width) {\n        // 估算一行能容纳多少文字\n        var assumTextNum = Math.floor(width / fontSize);\n\n        // 计算假定文字的宽度\n        var _this$measureText = this.measureText(ctx, remainText.substr(0, assumTextNum), fontSize),\n          assumTextWidth = _this$measureText.width;\n        if (assumTextWidth > width) {\n          while (assumTextWidth > width) {\n            assumTextWidth = this.measureText(ctx, remainText.substr(0, --assumTextNum), fontSize).width;\n          }\n        } else {\n          while (assumTextWidth <= width) {\n            assumTextWidth = this.measureText(ctx, remainText.substr(0, ++assumTextNum), fontSize).width;\n          }\n          assumTextWidth = this.measureText(ctx, remainText.substr(0, --assumTextNum), fontSize).width;\n        }\n        arr.push({\n          text: remainText.substr(0, assumTextNum),\n          width: assumTextWidth\n        });\n        remainText = remainText.substr(assumTextNum);\n      }\n      arr.push({\n        text: remainText,\n        width: this.measureText(ctx, remainText, fontSize).width\n      });\n      return arr;\n    }\n  }, {\n    key: \"onCanvasReady\",\n    value: function onCanvasReady() {\n      var _this2 = this;\n      var that = this;\n      var _this$props$palette = this.props.palette,\n        viewWidth = _this$props$palette.width,\n        viewHeight = _this$props$palette.height,\n        background = _this$props$palette.background,\n        views = _this$props$palette.views;\n      var _Taro$getSystemInfoSy = Taro.getSystemInfoSync(),\n        pixelRatio = _Taro$getSystemInfoSy.pixelRatio;\n      var context = my.createCanvasContext('photo');\n      this.canvasContext = context;\n      var bgSrc = background;\n      context.drawImage(bgSrc, 0, 0, parseFloat(viewWidth), parseFloat(viewHeight));\n      views.forEach(function (element) {\n        var type = element.type,\n          text = element.text,\n          css = element.css,\n          url = element.url;\n        var color = css.color,\n          fontSize = css.fontSize,\n          fontWeight = css.fontWeight,\n          left = css.left,\n          _css$textAlign = css.textAlign,\n          textAlign = _css$textAlign === void 0 ? 'left' : _css$textAlign,\n          top = css.top,\n          width = css.width,\n          bottom = css.bottom,\n          height = css.height,\n          right = css.right,\n          borderRadius = css.borderRadius,\n          _css$maxLines = css.maxLines,\n          maxLines = _css$maxLines === void 0 ? 1 : _css$maxLines,\n          _css$lineHeight = css.lineHeight,\n          lineHeight = _css$lineHeight === void 0 ? 1 : _css$lineHeight;\n        if (type === 'text') {\n          context.setFontSize(getNum(fontSize));\n          context.setFillStyle(color);\n          // alipay 不支持\n          // context.setFontWeight(fontWeight);\n          context.setTextBaseline('top');\n          // 当width不存在时，以left绘制\n          context.setTextAlign(width ? textAlign : 'left');\n          var textWidth = _this2.measureText(context, text, getNum(fontSize)).width;\n          var posX = left ? getNum(left) : getNum(viewWidth) - (getNum(right) + (getNum(textWidth) || textWidth));\n          if (width && textAlign === 'center') {\n            posX = posX + getNum(width || textWidth) / 2;\n          }\n          if (width && getNum(textWidth) > getNum(width)) {\n            var txts = _this2.splitText(context, element.text, getNum(fontSize), getNum(width), maxLines);\n            var _posX = left ? getNum(left) : getNum(viewWidth) - (getNum(right) + getNum(width));\n            var textHeight = isNaN(lineHeight) ? getNum(lineHeight) : getNum(fontSize) * lineHeight;\n            txts.forEach(function (txt, index) {\n              context.fillText(txt.text, _posX, getNum(top) + textHeight * index, getNum(width));\n            });\n          } else {\n            context.fillText(element.text, posX, getNum(top), getNum(width || textWidth));\n          }\n        }\n        if (type === 'image') {\n          context.save();\n          var imgWidth = getNum(width);\n          var imgHeight = getNum(height);\n          var x = left ? getNum(left) : getNum(viewWidth) - (getNum(width) + getNum(right));\n          var y = top ? getNum(top) : getNum(viewHeight) - (getNum(height) + getNum(bottom));\n          if (borderRadius) {\n            var radius = getNum(borderRadius);\n            context.beginPath();\n            context.arc(x + radius, y + radius, radius, Math.PI, Math.PI * 1.5);\n            context.lineTo(x + imgWidth - radius, y);\n            context.arc(x + imgWidth - radius, y + radius, radius, Math.PI * 1.5, 0);\n            context.lineTo(x + imgWidth, y + imgHeight - radius);\n            context.arc(x + imgWidth - radius, y + imgHeight - radius, radius, 0, Math.PI * 0.5);\n            context.lineTo(x + radius, y + imgHeight);\n            context.arc(x + radius, y + imgHeight - radius, radius, Math.PI * 0.5, Math.PI);\n            context.lineTo(x, y + radius);\n            context.setLineJoin('round');\n            context.clip();\n          }\n          context.drawImage(url, x, y, imgWidth, imgHeight);\n          context.restore();\n        }\n      });\n      context.draw(false, function () {\n        // 此时绘制完成\n        context.toTempFilePath({\n          success: function success(res) {\n            that.triggerEvent('imgOK', {\n              path: res.apFilePath\n            });\n          }\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this3 = this;\n      var _this$state = this.state,\n        painterStyle = _this$state.painterStyle,\n        photoStyle = _this$state.photoStyle;\n      var _this$props$palette2 = this.props.palette,\n        width = _this$props$palette2.width,\n        height = _this$props$palette2.height;\n      var customStyle = this.props.customStyle;\n      return /*#__PURE__*/React.createElement(View, {\n        style: \"position: relative;\".concat(customStyle, \";\").concat(painterStyle)\n      }, /*#__PURE__*/React.createElement(Canvas, {\n        id: \"photo\",\n        onReady: function onReady() {\n          return _this3.onCanvasReady();\n        },\n        style: photoStyle,\n        width: getNum(width),\n        height: getNum(height)\n      }));\n    }\n  }]);\n}(Component);\nexport default AlipayPoster;\nAlipayPoster.defaultProps = {\n  use2D: false,\n  customStyle: '',\n  customActionStyle: {},\n  palette: {},\n  dancePalette: {},\n  scaleRatio: 1,\n  widthPixels: 0,\n  dirty: false,\n  LRU: false,\n  action: {},\n  disableAction: false,\n  clearActionBox: false\n};","import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nimport React, { Component } from 'react';\nimport { Native } from '../../apis/Native';\nimport AlipayPoster from './alipay';\nimport WeAppPoster from './weapp';\nexport var Poster = /*#__PURE__*/function (_Component) {\n  function Poster() {\n    _classCallCheck(this, Poster);\n    return _callSuper(this, Poster, arguments);\n  }\n  _inherits(Poster, _Component);\n  return _createClass(Poster, [{\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n        palette = _this$props.palette,\n        style = _this$props.style,\n        _this$props$onReady = _this$props.onReady,\n        onReady = _this$props$onReady === void 0 ? function () {\n          return undefined;\n        } : _this$props$onReady;\n      var renderProps = {\n        use2D: true,\n        palette: palette,\n        imgOK: function imgOK(_ref) {\n          var path = _ref.path;\n          return onReady(path);\n        },\n        customStyle: style\n      };\n      if (Native.IS_ALIPAY_PLATFORM) {\n        return /*#__PURE__*/React.createElement(AlipayPoster, renderProps);\n      }\n      if (Native.IS_WEAPP) {\n        return /*#__PURE__*/React.createElement(WeAppPoster, renderProps);\n      }\n      return null;\n    }\n  }]);\n}(Component);","/* eslint-disable */\n// 四则运算\n\n!(function () {\n  var calculate = function (s) {\n    s = s.trim();\n    const stack = new Array();\n    let preSign = '+';\n    let numStr = '';\n    const n = s.length;\n    for (let i = 0; i < n; ++i) {\n      if (s[i] === '.' || (!isNaN(Number(s[i])) && s[i] !== ' ')) {\n        numStr += s[i];\n      } else if (s[i] === '(') {\n        let isClose = 1;\n        let j = i;\n        while (isClose > 0) {\n          j += 1;\n          if (s[j] === '(') isClose += 1;\n          if (s[j] === ')') isClose -= 1;\n        }\n        numStr = `${calculate(s.slice(i + 1, j))}`;\n        i = j;\n      }\n      if ((isNaN(Number(s[i])) && s[i] !== '.') || i === n - 1) {\n        let num = parseFloat(numStr);\n        switch (preSign) {\n          case '+':\n            stack.push(num);\n            break;\n          case '-':\n            stack.push(-num);\n            break;\n          case '*':\n            stack.push(stack.pop() * num);\n            break;\n          case '/':\n            stack.push(stack.pop() / num);\n            break;\n          default:\n            break;\n        }\n        preSign = s[i];\n        numStr = '';\n      }\n    }\n    let ans = 0;\n    while (stack.length) {\n      ans += stack.pop();\n    }\n    return ans;\n  };\n  module.exports = calculate;\n})();\n","import Taro from '@tarojs/taro';\n\n/**\n * LRU 文件存储，使用该 downloader 可以让下载的文件存储在本地，下次进入小程序后可以直接使用\n * 详细设计文档可查看 https://juejin.im/post/5b42d3ede51d4519277b6ce3\n */\nconst util = require('./util');\nconst sha1 = require('./sha1');\n\nconst SAVED_FILES_KEY = 'savedFiles';\nconst KEY_TOTAL_SIZE = 'totalSize';\nconst KEY_PATH = 'path';\nconst KEY_TIME = 'time';\nconst KEY_SIZE = 'size';\n\n// 可存储总共为 6M，目前小程序可允许的最大本地存储为 10M\nlet MAX_SPACE_IN_B = 6 * 1024 * 1024;\nlet savedFiles = {};\n\nexport default class Dowloader {\n  constructor() {\n    // app 如果设置了最大存储空间，则使用 app 中的\n    if (getApp().PAINTER_MAX_LRU_SPACE) {\n      MAX_SPACE_IN_B = getApp().PAINTER_MAX_LRU_SPACE;\n    }\n    Taro.getStorage({\n      key: SAVED_FILES_KEY,\n      success: function (res) {\n        if (res.data) {\n          savedFiles = res.data;\n        }\n      },\n    }).catch(err => {\n      console.log(err)\n    });\n  }\n\n  /**\n   * 下载文件，会用 lru 方式来缓存文件到本地\n   * @param {String} url 文件的 url\n   */\n  download(url, lru) {\n    return new Promise((resolve, reject) => {\n      if (!(url && util.isValidUrl(url))) {\n        resolve(url);\n        return;\n      }\n      const fileName = getFileName(url);\n      if (!lru) {\n        // 无 lru 情况下直接判断 临时文件是否存在，不存在重新下载\n        Taro.getFileSystemManager().getFileInfo({\n          filePath: fileName,\n          success: () => {\n            resolve(url);\n          },\n          fail: () => {\n            if (util.isOnlineUrl(url)) {\n              downloadFile(url, lru).then((path) => {\n                resolve(path);\n              }, () => {\n                reject();\n              });\n            } else if (util.isDataUrl(url)) {\n              transformBase64File(url, lru).then(path => {\n                resolve(path);\n              }, () => {\n                reject();\n              });\n            }\n          },\n        })\n        return\n      }\n\n      const file = getFile(fileName);\n\n      if (file) {\n        if (file[KEY_PATH].indexOf('//usr/') !== -1) {\n          Taro.getFileSystemManager().getFileInfo({\n            filePath: file[KEY_PATH],\n            success() {\n              resolve(file[KEY_PATH]);\n            },\n            fail(error) {\n              console.error(`base64 file broken, ${JSON.stringify(error)}`);\n              transformBase64File(url, lru).then(path => {\n                resolve(path);\n              }, () => {\n                reject();\n              });\n            }\n          })\n        } else {\n          // 检查文件是否正常，不正常需要重新下载\n          Taro.getSavedFileInfo({\n            filePath: file[KEY_PATH],\n            success: (res) => {\n              resolve(file[KEY_PATH]);\n            },\n            fail: (error) => {\n              console.error(`the file is broken, redownload it, ${JSON.stringify(error)}`);\n              downloadFile(url, lru).then((path) => {\n                resolve(path);\n              }, () => {\n                reject();\n              });\n            },\n          });\n        }\n      } else {\n        if (util.isOnlineUrl(url)) {\n          downloadFile(url, lru).then((path) => {\n            resolve(path);\n          }, () => {\n            reject();\n          });\n        } else if (util.isDataUrl(url)) {\n          transformBase64File(url, lru).then(path => {\n            resolve(path);\n          }, () => {\n            reject();\n          });\n        }\n      }\n    });\n  }\n}\n\nfunction getFileName(url) {\n  if (util.isDataUrl(url)) { \n    const [, format, bodyData] = /data:image\\/(\\w+);base64,(.*)/.exec(url) || [];\n    const fileName = `${sha1.hex_sha1(bodyData)}.${format}`;\n    return fileName;\n  } else {\n    return url;\n  }\n}\n\nfunction transformBase64File(base64data, lru) {\n  return new Promise((resolve, reject) => {\n    const [, format, bodyData] = /data:image\\/(\\w+);base64,(.*)/.exec(base64data) || [];\n    if (!format) {\n      console.error('base parse failed');\n      reject();\n      return;\n    }\n    const fileName = `${sha1.hex_sha1(bodyData)}.${format}`;\n    const path = `${wx.env.USER_DATA_PATH}/${fileName}`;\n    const buffer = Taro.base64ToArrayBuffer(bodyData.replace(/[\\r\\n]/g, \"\"));\n    Taro.getFileSystemManager().writeFile({\n      filePath: path,\n      data: buffer,\n      encoding: 'binary',\n      success() {\n        Taro.getFileSystemManager().getFileInfo({\n          filePath: path,\n          success: (tmpRes) => {\n            const newFileSize = tmpRes.size;\n            lru ? doLru(newFileSize).then(() => {\n              saveFile(fileName, newFileSize, path, true).then((filePath) => {\n                resolve(filePath);\n              });\n            }, () => {\n              resolve(path);\n            }) : resolve(path);\n          },\n          fail: (error) => {\n          // 文件大小信息获取失败，则此文件也不要进行存储\n            console.error(`getFileInfo ${path} failed, ${JSON.stringify(error)}`);\n            resolve(path);\n          },\n        });\n      },\n      fail(err) {\n        console.log(err)\n      }\n    })\n  });  \n}\n\nfunction downloadFile(url, lru) {\n  return new Promise((resolve, reject) => {\n    const downloader = url.startsWith('cloud://')?wx.cloud.downloadFile:Taro.downloadFile\n    downloader({\n      url: url,\n      fileID: url,\n      success: function (res) {\n        if (res.statusCode !== 200) {\n          console.log(`downloadFile ${url} failed res.statusCode is not 200`);\n          reject();\n          return;\n        }\n        const {\n          tempFilePath\n        } = res;\n        Taro.getFileSystemManager().getFileInfo({\n          filePath: tempFilePath,\n          success: (tmpRes) => {\n            const newFileSize = tmpRes.size;\n            lru ? doLru(newFileSize).then(() => {\n              saveFile(url, newFileSize, tempFilePath).then((filePath) => {\n                resolve(filePath);\n              });\n            }, () => {\n              resolve(tempFilePath);\n            }) : resolve(tempFilePath);\n          },\n          fail: (error) => {\n            // 文件大小信息获取失败，则此文件也不要进行存储\n            console.error(`getFileInfo ${res.tempFilePath} failed, ${JSON.stringify(error)}`);\n            resolve(res.tempFilePath);\n          },\n        });\n      },\n      fail: function (error) {\n        console.error(`downloadFile failed, ${JSON.stringify(error)} `);\n        reject();\n      },\n    });\n  });\n}\n\nfunction saveFile(key, newFileSize, tempFilePath, isDataUrl = false) {\n  return new Promise((resolve, reject) => {\n    if (isDataUrl) {\n      const totalSize = savedFiles[KEY_TOTAL_SIZE] ? savedFiles[KEY_TOTAL_SIZE] : 0;\n      savedFiles[key] = {};\n      savedFiles[key][KEY_PATH] = tempFilePath;\n      savedFiles[key][KEY_TIME] = new Date().getTime();\n      savedFiles[key][KEY_SIZE] = newFileSize;\n      savedFiles['totalSize'] = newFileSize + totalSize;\n      Taro.setStorage({\n        key: SAVED_FILES_KEY,\n        data: savedFiles,\n      });\n      resolve(tempFilePath);\n      return;\n    }\n    Taro.saveFile({\n      tempFilePath: tempFilePath,\n      success: (fileRes) => {\n        const totalSize = savedFiles[KEY_TOTAL_SIZE] ? savedFiles[KEY_TOTAL_SIZE] : 0;\n        savedFiles[key] = {};\n        savedFiles[key][KEY_PATH] = fileRes.savedFilePath;\n        savedFiles[key][KEY_TIME] = new Date().getTime();\n        savedFiles[key][KEY_SIZE] = newFileSize;\n        savedFiles['totalSize'] = newFileSize + totalSize;\n        Taro.setStorage({\n          key: SAVED_FILES_KEY,\n          data: savedFiles,\n        });\n        resolve(fileRes.savedFilePath);\n      },\n      fail: (error) => {\n        console.error(`saveFile ${key} failed, then we delete all files, ${JSON.stringify(error)}`);\n        // 由于 saveFile 成功后，res.tempFilePath 处的文件会被移除，所以在存储未成功时，我们还是继续使用临时文件\n        resolve(tempFilePath);\n        // 如果出现错误，就直接情况本地的所有文件，因为你不知道是不是因为哪次lru的某个文件未删除成功\n        reset();\n      },\n    });\n  });\n}\n\n/**\n * 清空所有下载相关内容\n */\nfunction reset() {\n  Taro.removeStorage({\n    key: SAVED_FILES_KEY,\n    success: () => {\n      Taro.getSavedFileList({\n        success: (listRes) => {\n          removeFiles(listRes.fileList);\n        },\n        fail: (getError) => {\n          console.error(`getSavedFileList failed, ${JSON.stringify(getError)}`);\n        },\n      });\n    },\n  });\n}\n\nfunction doLru(size) {\n  if (size > MAX_SPACE_IN_B) {\n    return Promise.reject()\n  }\n  return new Promise((resolve, reject) => {\n    let totalSize = savedFiles[KEY_TOTAL_SIZE] ? savedFiles[KEY_TOTAL_SIZE] : 0;\n\n    if (size + totalSize <= MAX_SPACE_IN_B) {\n      resolve();\n      return;\n    }\n    // 如果加上新文件后大小超过最大限制，则进行 lru\n    const pathsShouldDelete = [];\n    // 按照最后一次的访问时间，从小到大排序\n    const allFiles = JSON.parse(JSON.stringify(savedFiles));\n    delete allFiles[KEY_TOTAL_SIZE];\n    const sortedKeys = Object.keys(allFiles).sort((a, b) => {\n      return allFiles[a][KEY_TIME] - allFiles[b][KEY_TIME];\n    });\n\n    for (const sortedKey of sortedKeys) {\n      totalSize -= savedFiles[sortedKey].size;\n      pathsShouldDelete.push(savedFiles[sortedKey][KEY_PATH]);\n      delete savedFiles[sortedKey];\n      if (totalSize + size < MAX_SPACE_IN_B) {\n        break;\n      }\n    }\n\n    savedFiles['totalSize'] = totalSize;\n\n    Taro.setStorage({\n      key: SAVED_FILES_KEY,\n      data: savedFiles,\n      success: () => {\n        // 保证 storage 中不会存在不存在的文件数据\n        if (pathsShouldDelete.length > 0) {\n          removeFiles(pathsShouldDelete);\n        }\n        resolve();\n      },\n      fail: (error) => {\n        console.error(`doLru setStorage failed, ${JSON.stringify(error)}`);\n        reject();\n      },\n    });\n  });\n}\n\nfunction removeFiles(pathsShouldDelete) {\n  for (const pathDel of pathsShouldDelete) {\n    let delPath = pathDel;\n    if (typeof pathDel === 'object') {\n      delPath = pathDel.filePath;\n    }\n    if (delPath.indexOf('//usr/') !== -1) {\n      Taro.getFileSystemManager().unlink({\n        filePath: delPath,\n        fail(error) {\n          console.error(`removeSavedFile ${pathDel} failed, ${JSON.stringify(error)}`);\n        }\n      })\n    } else {\n      Taro.removeSavedFile({\n        filePath: delPath,\n        fail: (error) => {\n          console.error(`removeSavedFile ${pathDel} failed, ${JSON.stringify(error)}`);\n        },\n      });\n    }\n  }\n}\n\nfunction getFile(key) {\n  if (!savedFiles[key]) {\n    return;\n  }\n  savedFiles[key]['time'] = new Date().getTime();\n  Taro.setStorage({\n    key: SAVED_FILES_KEY,\n    data: savedFiles,\n  });\n  return savedFiles[key];\n}","/* eslint-disable */\n// 当ctx传入当前文件，const grd = ctx.createCircularGradient() 和 \n// const grd = this.ctx.createLinearGradient() 无效，因此只能分开处理\n// 先分析，在外部创建grd，再传入使用就可以\n\n!(function () {\n\n  var api = {\n    isGradient: function(bg) {\n      if (bg && (bg.startsWith('linear') || bg.startsWith('radial'))) {\n        return true;\n      } \n      return false;\n    },\n\n    doGradient: function(bg, width, height, ctx) {\n      if (bg.startsWith('linear')) {\n        linearEffect(width, height, bg, ctx);\n      } else if (bg.startsWith('radial')) {\n        radialEffect(width, height, bg, ctx);\n      }\n    },\n  }\n\n  function analizeGrad(string) {\n    const colorPercents = string.substring(0, string.length - 1).split(\"%,\");\n    const colors = [];\n    const percents = [];\n    for (let colorPercent of colorPercents) {\n      colors.push(colorPercent.substring(0, colorPercent.lastIndexOf(\" \")).trim());\n      percents.push(colorPercent.substring(colorPercent.lastIndexOf(\" \"), colorPercent.length) / 100);\n    }\n    return {colors: colors, percents: percents};\n  }\n\n  function radialEffect(width, height, bg, ctx) {\n    const colorPer = analizeGrad(bg.match(/radial-gradient\\((.+)\\)/)[1]);\n    const grd = ctx.createRadialGradient(0, 0, 0, 0, 0, width < height ? height / 2 : width / 2);\n    for (let i = 0; i < colorPer.colors.length; i++) {\n      grd.addColorStop(colorPer.percents[i], colorPer.colors[i]);\n    }\n    ctx.fillStyle = grd;\n    //ctx.fillRect(-(width / 2), -(height / 2), width, height);\n  }\n\n  function analizeLinear(bg, width, height) {\n    const direction = bg.match(/([-]?\\d{1,3})deg/);\n    const dir = direction && direction[1] ? parseFloat(direction[1]) : 0;\n    let coordinate;\n    switch (dir) {\n      case 0: coordinate = [0, -height / 2, 0, height / 2]; break;\n      case 90: coordinate = [width / 2, 0, -width / 2, 0]; break;\n      case -90: coordinate = [-width / 2, 0, width / 2, 0]; break;\n      case 180: coordinate = [0, height / 2, 0, -height / 2]; break;\n      case -180: coordinate = [0, -height / 2, 0, height / 2]; break;\n      default:\n        let x1 = 0;\n        let y1 = 0;\n        let x2 = 0;\n        let y2 = 0;\n        if (direction[1] > 0 && direction[1] < 90) {\n          x1 = (width / 2) - ((width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;\n          y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;\n          x2 = -x1;\n          y1 = -y2;\n        } else if (direction[1] > -180 && direction[1] < -90) {\n          x1 = -(width / 2) + ((width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;\n          y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;\n          x2 = -x1;\n          y1 = -y2;\n        } else if (direction[1] > 90 && direction[1] < 180) {\n          x1 = (width / 2) + (-(width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;\n          y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;\n          x2 = -x1;\n          y1 = -y2;\n        } else {\n          x1 = -(width / 2) - (-(width / 2) * Math.tan((90 - direction[1]) * Math.PI * 2 / 360) - height / 2) * Math.sin(2 * (90 - direction[1]) * Math.PI * 2 / 360) / 2;\n          y2 = Math.tan((90 - direction[1]) * Math.PI * 2 / 360) * x1;\n          x2 = -x1;\n          y1 = -y2;\n        }\n        coordinate = [x1, y1, x2, y2];\n      break;\n    }\n    return coordinate;\n  }\n\n  function linearEffect(width, height, bg, ctx) {\n    const param = analizeLinear(bg, width, height);\n    const grd = ctx.createLinearGradient(param[0], param[1], param[2], param[3]);\n    const content = bg.match(/linear-gradient\\((.+)\\)/)[1];\n    const colorPer = analizeGrad(content.substring(content.indexOf(',') + 1));\n    for (let i = 0; i < colorPer.colors.length; i++) {\n      grd.addColorStop(colorPer.percents[i], colorPer.colors[i]);\n    }\n    ctx.fillStyle = grd\n    //ctx.fillRect(-(width / 2), -(height / 2), width, height);\n  }\n\n  module.exports = { api }\n\n})();\n","const QR = require('./qrcode.js');\nconst GD = require('./gradient.js');\nrequire('./string-polyfill.js');\n\nexport const penCache = {\n  // 用于存储带 id 的 view 的 rect 信息\n  viewRect: {},\n  textLines: {},\n};\nexport const clearPenCache = id => {\n  if (id) {\n    penCache.viewRect[id] = null;\n    penCache.textLines[id] = null;\n  } else {\n    penCache.viewRect = {};\n    penCache.textLines = {};\n  }\n};\nexport default class Painter {\n  constructor(ctx, data) {\n    this.ctx = ctx;\n    this.data = data;\n  }\n\n  paint(callback) {\n    this.style = {\n      width: this.data.width.toPx(),\n      height: this.data.height.toPx(),\n    };\n\n    this._background();\n    for (const view of this.data.views) {\n      this._drawAbsolute(view);\n    }\n    this.ctx.draw(false, () => {\n      callback && callback();\n    });\n  }\n\n  _background() {\n    this.ctx.save();\n    const { width, height } = this.style;\n    const bg = this.data.background;\n    this.ctx.translate(width / 2, height / 2);\n\n    this._doClip(this.data.borderRadius, width, height);\n    if (!bg) {\n      // 如果未设置背景，则默认使用透明色\n      this.ctx.fillStyle = 'transparent';\n      this.ctx.fillRect(-(width / 2), -(height / 2), width, height);\n    } else if (bg.startsWith('#') || bg.startsWith('rgba') || bg.toLowerCase() === 'transparent') {\n      // 背景填充颜色\n      this.ctx.fillStyle = bg;\n      this.ctx.fillRect(-(width / 2), -(height / 2), width, height);\n    } else if (GD.api.isGradient(bg)) {\n      GD.api.doGradient(bg, width, height, this.ctx);\n      this.ctx.fillRect(-(width / 2), -(height / 2), width, height);\n    } else {\n      // 背景填充图片\n      this.ctx.drawImage(bg, -(width / 2), -(height / 2), width, height);\n    }\n    this.ctx.restore();\n  }\n\n  _drawAbsolute(view) {\n    if (!(view && view.type)) {\n      // 过滤无效 view\n      return;\n    }\n    // 证明 css 为数组形式，需要合并\n    if (view.css && view.css.length) {\n      /* eslint-disable no-param-reassign */\n      view.css = Object.assign(...view.css);\n    }\n    switch (view.type) {\n      case 'image':\n        this._drawAbsImage(view);\n        break;\n      case 'text':\n        this._fillAbsText(view);\n        break;\n      case 'inlineText':\n        this._fillAbsInlineText(view);\n        break;\n      case 'rect':\n        this._drawAbsRect(view);\n        break;\n      case 'qrcode':\n        this._drawQRCode(view);\n        break;\n      default:\n        break;\n    }\n  }\n\n  _border({ borderRadius = 0, width, height, borderWidth = 0, borderStyle = 'solid' }) {\n    let r1 = 0,\n      r2 = 0,\n      r3 = 0,\n      r4 = 0;\n    const minSize = Math.min(width, height);\n    if (borderRadius) {\n      const border = borderRadius.split(/\\s+/);\n      if (border.length === 4) {\n        r1 = Math.min(border[0].toPx(false, minSize), width / 2, height / 2);\n        r2 = Math.min(border[1].toPx(false, minSize), width / 2, height / 2);\n        r3 = Math.min(border[2].toPx(false, minSize), width / 2, height / 2);\n        r4 = Math.min(border[3].toPx(false, minSize), width / 2, height / 2);\n      } else {\n        r1 = r2 = r3 = r4 = Math.min(borderRadius && borderRadius.toPx(false, minSize), width / 2, height / 2);\n      }\n    }\n    const lineWidth = borderWidth && borderWidth.toPx(false, minSize);\n    this.ctx.lineWidth = lineWidth;\n    if (borderStyle === 'dashed') {\n      this.ctx.setLineDash([(lineWidth * 4) / 3, (lineWidth * 4) / 3]);\n      // this.ctx.lineDashOffset = 2 * lineWidth\n    } else if (borderStyle === 'dotted') {\n      this.ctx.setLineDash([lineWidth, lineWidth]);\n    }\n    const notSolid = borderStyle !== 'solid';\n    this.ctx.beginPath();\n\n    notSolid && r1 === 0 && this.ctx.moveTo(-width / 2 - lineWidth, -height / 2 - lineWidth / 2); // 顶边虚线规避重叠规则\n    r1 !== 0 && this.ctx.arc(-width / 2 + r1, -height / 2 + r1, r1 + lineWidth / 2, 1 * Math.PI, 1.5 * Math.PI); //左上角圆弧\n    this.ctx.lineTo(\n      r2 === 0 ? (notSolid ? width / 2 : width / 2 + lineWidth / 2) : width / 2 - r2,\n      -height / 2 - lineWidth / 2,\n    ); // 顶边线\n\n    notSolid && r2 === 0 && this.ctx.moveTo(width / 2 + lineWidth / 2, -height / 2 - lineWidth); // 右边虚线规避重叠规则\n    r2 !== 0 && this.ctx.arc(width / 2 - r2, -height / 2 + r2, r2 + lineWidth / 2, 1.5 * Math.PI, 2 * Math.PI); // 右上角圆弧\n    this.ctx.lineTo(\n      width / 2 + lineWidth / 2,\n      r3 === 0 ? (notSolid ? height / 2 : height / 2 + lineWidth / 2) : height / 2 - r3,\n    ); // 右边线\n\n    notSolid && r3 === 0 && this.ctx.moveTo(width / 2 + lineWidth, height / 2 + lineWidth / 2); // 底边虚线规避重叠规则\n    r3 !== 0 && this.ctx.arc(width / 2 - r3, height / 2 - r3, r3 + lineWidth / 2, 0, 0.5 * Math.PI); // 右下角圆弧\n    this.ctx.lineTo(\n      r4 === 0 ? (notSolid ? -width / 2 : -width / 2 - lineWidth / 2) : -width / 2 + r4,\n      height / 2 + lineWidth / 2,\n    ); // 底边线\n\n    notSolid && r4 === 0 && this.ctx.moveTo(-width / 2 - lineWidth / 2, height / 2 + lineWidth); // 左边虚线规避重叠规则\n    r4 !== 0 && this.ctx.arc(-width / 2 + r4, height / 2 - r4, r4 + lineWidth / 2, 0.5 * Math.PI, 1 * Math.PI); // 左下角圆弧\n    this.ctx.lineTo(\n      -width / 2 - lineWidth / 2,\n      r1 === 0 ? (notSolid ? -height / 2 : -height / 2 - lineWidth / 2) : -height / 2 + r1,\n    ); // 左边线\n    notSolid && r1 === 0 && this.ctx.moveTo(-width / 2 - lineWidth, -height / 2 - lineWidth / 2); // 顶边虚线规避重叠规则\n\n    if (!notSolid) {\n      this.ctx.closePath();\n    }\n  }\n\n  /**\n   * 根据 borderRadius 进行裁减\n   */\n  _doClip(borderRadius, width, height, borderStyle) {\n    if (borderRadius && width && height) {\n      // 防止在某些机型上周边有黑框现象，此处如果直接设置 fillStyle 为透明，在 Android 机型上会导致被裁减的图片也变为透明， iOS 和 IDE 上不会\n      // globalAlpha 在 1.9.90 起支持，低版本下无效，但把 fillStyle 设为了 white，相对默认的 black 要好点\n      this.ctx.globalAlpha = 0;\n      this.ctx.fillStyle = 'white';\n      this._border({\n        borderRadius,\n        width,\n        height,\n        borderStyle,\n      });\n      this.ctx.fill();\n      // 在 ios 的 6.6.6 版本上 clip 有 bug，禁掉此类型上的 clip，也就意味着，在此版本微信的 ios 设备下无法使用 border 属性\n      if (!(getApp().systemInfo && getApp().systemInfo.version <= '6.6.6' && getApp().systemInfo.platform === 'ios')) {\n        this.ctx.clip();\n      }\n      this.ctx.globalAlpha = 1;\n    }\n  }\n\n  /**\n   * 画边框\n   */\n  _doBorder(view, width, height) {\n    if (!view.css) {\n      return;\n    }\n    const { borderRadius, borderWidth, borderColor, borderStyle } = view.css;\n    if (!borderWidth) {\n      return;\n    }\n    this.ctx.save();\n    this._preProcess(view, true);\n    this.ctx.strokeStyle = borderColor || 'black';\n    this._border({\n      borderRadius,\n      width,\n      height,\n      borderWidth,\n      borderStyle,\n    });\n    this.ctx.stroke();\n    this.ctx.restore();\n  }\n\n  _preProcess(view, notClip) {\n    let width = 0;\n    let height;\n    let extra;\n    const paddings = this._doPaddings(view);\n    switch (view.type) {\n      case 'inlineText': {\n        {\n          // 计算行数\n          let lines = 0;\n          // 文字总长度\n          let textLength = 0;\n          // 行高\n          let lineHeight = 0;\n          const textList = view.textList || [];\n          for (let i = 0; i < textList.length; i++) {\n            let subView = textList[i];\n            const fontWeight = subView.css.fontWeight || '400';\n            const textStyle = subView.css.textStyle || 'normal';\n            if (!subView.css.fontSize) {\n              subView.css.fontSize = '20rpx';\n            }\n            this.ctx.font = `${textStyle} ${fontWeight} ${subView.css.fontSize.toPx()}px \"${subView.css.fontFamily || 'sans-serif'}\"`;\n            textLength += this.ctx.measureText(subView.text).width;\n            let tempLineHeight = subView.css.lineHeight ? subView.css.lineHeight.toPx() : subView.css.fontSize.toPx();\n            lineHeight = Math.max(lineHeight, tempLineHeight);\n          }\n          width = view.css.width ? view.css.width.toPx(false, this.style.width) - paddings[1] - paddings[3] : textLength;;\n          const calLines = Math.ceil(textLength / width);\n\n          lines += calLines;\n          // lines = view.css.maxLines < lines ? view.css.maxLines : lines;\n          height = lineHeight * lines;\n          extra = {\n            lines: lines,\n            lineHeight: lineHeight,\n            // textArray: textArray,\n            // linesArray: linesArray,\n          };\n        }\n        break;\n      }\n      case 'text': {\n        const textArray = String(view.text).split('\\n');\n        // 处理多个连续的'\\n'\n        for (let i = 0; i < textArray.length; ++i) {\n          if (textArray[i] === '') {\n            textArray[i] = ' ';\n          }\n        }\n        const fontWeight = view.css.fontWeight || '400';\n        const textStyle = view.css.textStyle || 'normal';\n        if (!view.css.fontSize) {\n          view.css.fontSize = '20rpx';\n        }\n        this.ctx.font = `${textStyle} ${fontWeight} ${view.css.fontSize.toPx()}px \"${\n          view.css.fontFamily || 'sans-serif'\n        }\"`;\n        // 计算行数\n        let lines = 0;\n        const linesArray = [];\n        for (let i = 0; i < textArray.length; ++i) {\n          const textLength = this.ctx.measureText(textArray[i]).width;\n          const minWidth = view.css.fontSize.toPx() + paddings[1] + paddings[3];\n          let partWidth = view.css.width\n            ? view.css.width.toPx(false, this.style.width) - paddings[1] - paddings[3]\n            : textLength;\n          if (partWidth < minWidth) {\n            partWidth = minWidth;\n          }\n          const calLines = Math.ceil(textLength / partWidth);\n          // 取最长的作为 width\n          width = partWidth > width ? partWidth : width;\n          lines += calLines;\n          linesArray[i] = calLines;\n        }\n        lines = view.css.maxLines < lines ? view.css.maxLines : lines;\n        const lineHeight = view.css.lineHeight ? view.css.lineHeight.toPx() : view.css.fontSize.toPx();\n        height = lineHeight * lines;\n        extra = {\n          lines: lines,\n          lineHeight: lineHeight,\n          textArray: textArray,\n          linesArray: linesArray,\n        };\n        break;\n      }\n      case 'image': {\n        // image的长宽设置成auto的逻辑处理\n        const ratio = getApp().systemInfo.pixelRatio ? getApp().systemInfo.pixelRatio : 2;\n        // 有css却未设置width或height，则默认为auto\n        if (view.css) {\n          if (!view.css.width) {\n            view.css.width = 'auto';\n          }\n          if (!view.css.height) {\n            view.css.height = 'auto';\n          }\n        }\n        if (!view.css || (view.css.width === 'auto' && view.css.height === 'auto')) {\n          width = Math.round(view.sWidth / ratio);\n          height = Math.round(view.sHeight / ratio);\n        } else if (view.css.width === 'auto') {\n          height = view.css.height.toPx(false, this.style.height);\n          width = (view.sWidth / view.sHeight) * height;\n        } else if (view.css.height === 'auto') {\n          width = view.css.width.toPx(false, this.style.width);\n          height = (view.sHeight / view.sWidth) * width;\n        } else {\n          width = view.css.width.toPx(false, this.style.width);\n          height = view.css.height.toPx(false, this.style.height);\n        }\n        break;\n      }\n      default:\n        if (!(view.css.width && view.css.height)) {\n          console.error('You should set width and height');\n          return;\n        }\n        width = view.css.width.toPx(false, this.style.width);\n        height = view.css.height.toPx(false, this.style.height);\n        break;\n    }\n    let x;\n    if (view.css && view.css.right) {\n      if (typeof view.css.right === 'string') {\n        x = this.style.width - view.css.right.toPx(true, this.style.width);\n      } else {\n        // 可以用数组方式，把文字长度计算进去\n        // [right, 文字id, 乘数（默认 1）]\n        const rights = view.css.right;\n        x =\n          this.style.width -\n          rights[0].toPx(true, this.style.width) -\n          penCache.viewRect[rights[1]].width * (rights[2] || 1);\n      }\n    } else if (view.css && view.css.left) {\n      if (typeof view.css.left === 'string') {\n        x = view.css.left.toPx(true, this.style.width);\n      } else {\n        const lefts = view.css.left;\n        x = lefts[0].toPx(true, this.style.width) + penCache.viewRect[lefts[1]].width * (lefts[2] || 1);\n      }\n    } else {\n      x = 0;\n    }\n    //const y = view.css && view.css.bottom ? this.style.height - height - view.css.bottom.toPx(true) : (view.css && view.css.top ? view.css.top.toPx(true) : 0);\n    let y;\n    if (view.css && view.css.bottom) {\n      y = this.style.height - height - view.css.bottom.toPx(true, this.style.height);\n    } else {\n      if (view.css && view.css.top) {\n        if (typeof view.css.top === 'string') {\n          y = view.css.top.toPx(true, this.style.height);\n        } else {\n          const tops = view.css.top;\n          y = tops[0].toPx(true, this.style.height) + penCache.viewRect[tops[1]].height * (tops[2] || 1);\n        }\n      } else {\n        y = 0;\n      }\n    }\n\n    const angle = view.css && view.css.rotate ? this._getAngle(view.css.rotate) : 0;\n    // 当设置了 right 时，默认 align 用 right，反之用 left\n    const align = view.css && view.css.align ? view.css.align : view.css && view.css.right ? 'right' : 'left';\n    const verticalAlign = view.css && view.css.verticalAlign ? view.css.verticalAlign : 'top';\n    // 记录绘制时的画布\n    let xa = 0;\n    switch (align) {\n      case 'center':\n        xa = x;\n        break;\n      case 'right':\n        xa = x - width / 2;\n        break;\n      default:\n        xa = x + width / 2;\n        break;\n    }\n    let ya = 0;\n    switch (verticalAlign) {\n      case 'center':\n        ya = y;\n        break;\n      case 'bottom':\n        ya = y - height / 2;\n        break;\n      default:\n        ya = y + height / 2;\n        break;\n    }\n    this.ctx.translate(xa, ya);\n    // 记录该 view 的有效点击区域\n    // TODO ，旋转和裁剪的判断\n    // 记录在真实画布上的左侧\n    let left = x;\n    if (align === 'center') {\n      left = x - width / 2;\n    } else if (align === 'right') {\n      left = x - width;\n    }\n    var top = y;\n    if (verticalAlign === 'center') {\n      top = y - height / 2;\n    } else if (verticalAlign === 'bottom') {\n      top = y - height;\n    }\n    if (view.rect) {\n      view.rect.left = left;\n      view.rect.top = top;\n      view.rect.right = left + width;\n      view.rect.bottom = top + height;\n      view.rect.x = view.css && view.css.right ? x - width : x;\n      view.rect.y = y;\n    } else {\n      view.rect = {\n        left: left,\n        top: top,\n        right: left + width,\n        bottom: top + height,\n        x: view.css && view.css.right ? x - width : x,\n        y: y,\n      };\n    }\n\n    view.rect.left = view.rect.left - paddings[3];\n    view.rect.top = view.rect.top - paddings[0];\n    view.rect.right = view.rect.right + paddings[1];\n    view.rect.bottom = view.rect.bottom + paddings[2];\n    if (view.type === 'text') {\n      view.rect.minWidth = view.css.fontSize.toPx() + paddings[1] + paddings[3];\n    }\n\n    this.ctx.rotate(angle);\n    if (!notClip && view.css && view.css.borderRadius && view.type !== 'rect') {\n      this._doClip(view.css.borderRadius, width, height, view.css.borderStyle);\n    }\n    this._doShadow(view);\n    if (view.id) {\n      penCache.viewRect[view.id] = {\n        width,\n        height,\n        left: view.rect.left,\n        top: view.rect.top,\n        right: view.rect.right,\n        bottom: view.rect.bottom,\n      };\n    }\n    return {\n      width: width,\n      height: height,\n      x: x,\n      y: y,\n      extra: extra,\n    };\n  }\n\n  _doPaddings(view) {\n    const { padding } = view.css ? view.css : {};\n    let pd = [0, 0, 0, 0];\n    if (padding) {\n      const pdg = padding.split(/\\s+/);\n      if (pdg.length === 1) {\n        const x = pdg[0].toPx();\n        pd = [x, x, x, x];\n      }\n      if (pdg.length === 2) {\n        const x = pdg[0].toPx();\n        const y = pdg[1].toPx();\n        pd = [x, y, x, y];\n      }\n      if (pdg.length === 3) {\n        const x = pdg[0].toPx();\n        const y = pdg[1].toPx();\n        const z = pdg[2].toPx();\n        pd = [x, y, z, y];\n      }\n      if (pdg.length === 4) {\n        const x = pdg[0].toPx();\n        const y = pdg[1].toPx();\n        const z = pdg[2].toPx();\n        const a = pdg[3].toPx();\n        pd = [x, y, z, a];\n      }\n    }\n    return pd;\n  }\n\n  // 画文字的背景图片\n  _doBackground(view) {\n    this.ctx.save();\n    const { width: rawWidth, height: rawHeight } = this._preProcess(view, true);\n\n    const { background } = view.css;\n    let pd = this._doPaddings(view);\n    const width = rawWidth + pd[1] + pd[3];\n    const height = rawHeight + pd[0] + pd[2];\n\n    this._doClip(view.css.borderRadius, width, height, view.css.borderStyle);\n    if (GD.api.isGradient(background)) {\n      GD.api.doGradient(background, width, height, this.ctx);\n    } else {\n      this.ctx.fillStyle = background;\n    }\n    this.ctx.fillRect(-(width / 2), -(height / 2), width, height);\n\n    this.ctx.restore();\n  }\n\n  _drawQRCode(view) {\n    this.ctx.save();\n    const { width, height } = this._preProcess(view);\n    QR.api.draw(view.content, this.ctx, -width / 2, -height / 2, width, height, view.css.background, view.css.color);\n    this.ctx.restore();\n    this._doBorder(view, width, height);\n  }\n\n  _drawAbsImage(view) {\n    if (!view.url) {\n      return;\n    }\n    this.ctx.save();\n    const { width, height } = this._preProcess(view);\n    // 获得缩放到图片大小级别的裁减框\n    let rWidth = view.sWidth;\n    let rHeight = view.sHeight;\n    let startX = 0;\n    let startY = 0;\n    // 绘画区域比例\n    const cp = width / height;\n    // 原图比例\n    const op = view.sWidth / view.sHeight;\n    if (cp >= op) {\n      rHeight = rWidth / cp;\n      startY = Math.round((view.sHeight - rHeight) / 2);\n    } else {\n      rWidth = rHeight * cp;\n      startX = Math.round((view.sWidth - rWidth) / 2);\n    }\n    if (view.css && view.css.mode === 'scaleToFill') {\n      this.ctx.drawImage(view.url, -(width / 2), -(height / 2), width, height);\n    } else {\n      this.ctx.drawImage(view.url, startX, startY, rWidth, rHeight, -(width / 2), -(height / 2), width, height);\n      view.rect.startX = startX / view.sWidth;\n      view.rect.startY = startY / view.sHeight;\n      view.rect.endX = (startX + rWidth) / view.sWidth;\n      view.rect.endY = (startY + rHeight) / view.sHeight;\n    }\n    this.ctx.restore();\n    this._doBorder(view, width, height);\n  }\n  /**\n   * \n   * @param {*} view \n   * @description 一行内文字多样式的方法\n   * \n   * 暂不支持配置 text-align，默认left\n   * 暂不支持配置 maxLines\n   */\n  _fillAbsInlineText(view) {\n    if (!view.textList) {\n      return;\n    }\n    if (view.css.background) {\n      // 生成背景\n      this._doBackground(view);\n    }\n    this.ctx.save();\n    const { width, height, extra } = this._preProcess(view, view.css.background && view.css.borderRadius);\n    const { lines, lineHeight } = extra;\n    let staticX = -(width / 2);\n    let lineIndex = 0; // 第几行\n    let x = staticX; // 开始x位置\n    let leftWidth = width; // 当前行剩余多少宽度可以使用\n\n    let getStyle = css => {\n      const fontWeight = css.fontWeight || '400';\n      const textStyle = css.textStyle || 'normal';\n      if (!css.fontSize) {\n        css.fontSize = '20rpx';\n      }\n      return `${textStyle} ${fontWeight} ${css.fontSize.toPx()}px \"${css.fontFamily || 'sans-serif'}\"`;\n    }\n\n    // 遍历行内的文字数组\n    for (let j = 0; j < view.textList.length; j++) {\n      const subView = view.textList[j];\n\n      // 某个文字开始位置\n      let start = 0;\n      // 文字已使用的数量\n      let alreadyCount = 0;\n      // 文字总长度\n      let textLength = subView.text.length;\n      // 文字总宽度\n      let textWidth = this.ctx.measureText(subView.text).width;\n      // 每个文字的平均宽度\n      let preWidth = Math.ceil(textWidth / textLength);\n\n      // 循环写文字\n      while (alreadyCount < textLength) {\n        // alreadyCount - start + 1 -> 当前摘取出来的文字\n        // 比较可用宽度，寻找最大可写文字长度\n        while ((alreadyCount - start + 1) * preWidth < leftWidth && alreadyCount < textLength) {\n          alreadyCount++;\n        }\n\n        // 取出文字\n        let text = subView.text.substr(start, alreadyCount - start);\n\n        const y = -(height / 2) + subView.css.fontSize.toPx() + lineIndex * lineHeight;\n\n        // 设置文字样式\n        this.ctx.font = getStyle(subView.css);\n\n        this.ctx.fillStyle = subView.css.color || 'black';\n        this.ctx.textAlign = 'left';\n\n        // 执行画布操作\n        if (subView.css.textStyle === 'stroke') {\n          this.ctx.strokeText(text, x, y);\n        } else {\n          this.ctx.fillText(text, x, y);\n        }\n\n        // 当次已使用宽度\n        let currentUsedWidth = this.ctx.measureText(text).width;\n\n        const fontSize = subView.css.fontSize.toPx();\n\n        // 画 textDecoration\n        let textDecoration;\n        if (subView.css.textDecoration) {\n          this.ctx.lineWidth = fontSize / 13;\n          this.ctx.beginPath();\n          if (/\\bunderline\\b/.test(subView.css.textDecoration)) {\n            this.ctx.moveTo(x, y);\n            this.ctx.lineTo(x + currentUsedWidth, y);\n            textDecoration = {\n              moveTo: [x, y],\n              lineTo: [x + currentUsedWidth, y],\n            };\n          }\n          if (/\\boverline\\b/.test(subView.css.textDecoration)) {\n            this.ctx.moveTo(x, y - fontSize);\n            this.ctx.lineTo(x + currentUsedWidth, y - fontSize);\n            textDecoration = {\n              moveTo: [x, y - fontSize],\n              lineTo: [x + currentUsedWidth, y - fontSize],\n            };\n          }\n          if (/\\bline-through\\b/.test(subView.css.textDecoration)) {\n            this.ctx.moveTo(x, y - fontSize / 3);\n            this.ctx.lineTo(x + currentUsedWidth, y - fontSize / 3);\n            textDecoration = {\n              moveTo: [x, y - fontSize / 3],\n              lineTo: [x + currentUsedWidth, y - fontSize / 3],\n            };\n          }\n          this.ctx.closePath();\n          this.ctx.strokeStyle = subView.css.color;\n          this.ctx.stroke();\n        }\n\n        // 重置数据\n        start = alreadyCount;\n        leftWidth -= currentUsedWidth;\n        x += currentUsedWidth;\n        // 如果剩余宽度 小于等于0 或者小于一个字的平均宽度，换行\n        if (leftWidth <= 0 || leftWidth < preWidth) {\n          leftWidth = width;\n          x = staticX;\n          lineIndex++;\n        }\n      }\n    }\n\n    this.ctx.restore();\n    this._doBorder(view, width, height);\n  }\n\n  _fillAbsText(view) {\n    if (!view.text) {\n      return;\n    }\n    if (view.css.background) {\n      // 生成背景\n      this._doBackground(view);\n    }\n    this.ctx.save();\n    const { width, height, extra } = this._preProcess(view, view.css.background && view.css.borderRadius);\n    this.ctx.fillStyle = view.css.color || 'black';\n    if (view.id && penCache.textLines[view.id]) {\n      this.ctx.textAlign = view.css.textAlign ? view.css.textAlign : 'left';\n      for (const i of penCache.textLines[view.id]) {\n        const { measuredWith, text, x, y, textDecoration } = i;\n        if (view.css.textStyle === 'stroke') {\n          this.ctx.strokeText(text, x, y, measuredWith);\n        } else {\n          this.ctx.fillText(text, x, y, measuredWith);\n        }\n        if (textDecoration) {\n          const fontSize = view.css.fontSize.toPx();\n          this.ctx.lineWidth = fontSize / 13;\n          this.ctx.beginPath();\n          this.ctx.moveTo(...textDecoration.moveTo);\n          this.ctx.lineTo(...textDecoration.lineTo);\n          this.ctx.closePath();\n          this.ctx.strokeStyle = view.css.color;\n          this.ctx.stroke();\n        }\n      }\n    } else {\n      const { lines, lineHeight, textArray, linesArray } = extra;\n      // 如果设置了id，则保留 text 的长度\n      if (view.id) {\n        let textWidth = 0;\n        for (let i = 0; i < textArray.length; ++i) {\n          const _w = this.ctx.measureText(textArray[i]).width;\n          textWidth = _w > textWidth ? _w : textWidth;\n        }\n        penCache.viewRect[view.id].width = width ? (textWidth < width ? textWidth : width) : textWidth;\n      }\n      let lineIndex = 0;\n      for (let j = 0; j < textArray.length; ++j) {\n        const preLineLength = Math.ceil(textArray[j].length / linesArray[j]);\n        let start = 0;\n        let alreadyCount = 0;\n\n        for (let i = 0; i < linesArray[j]; ++i) {\n          // 绘制行数大于最大行数，则直接跳出循环\n          if (lineIndex >= lines) {\n            break;\n          }\n          alreadyCount = preLineLength;\n          let text = textArray[j].substr(start, alreadyCount);\n          let measuredWith = this.ctx.measureText(text).width;\n          // 如果测量大小小于width一个字符的大小，则进行补齐，如果测量大小超出 width，则进行减除\n          // 如果已经到文本末尾，也不要进行该循环\n          while (\n            start + alreadyCount <= textArray[j].length &&\n            (width - measuredWith > view.css.fontSize.toPx() || measuredWith - width > view.css.fontSize.toPx())\n          ) {\n            if (measuredWith < width) {\n              text = textArray[j].substr(start, ++alreadyCount);\n            } else {\n              if (text.length <= 1) {\n                // 如果只有一个字符时，直接跳出循环\n                break;\n              }\n              text = textArray[j].substr(start, --alreadyCount);\n              // break;\n            }\n            measuredWith = this.ctx.measureText(text).width;\n          }\n          start += text.length;\n          // 如果是最后一行了，发现还有未绘制完的内容，则加...\n          if (lineIndex === lines - 1 && (j < textArray.length - 1 || start < textArray[j].length)) {\n            while (this.ctx.measureText(`${text}...`).width > width) {\n              if (text.length <= 1) {\n                // 如果只有一个字符时，直接跳出循环\n                break;\n              }\n              text = text.substring(0, text.length - 1);\n            }\n            text += '...';\n            measuredWith = this.ctx.measureText(text).width;\n          }\n          this.ctx.textAlign = view.css.textAlign ? view.css.textAlign : 'left';\n          let x;\n          let lineX;\n          switch (view.css.textAlign) {\n            case 'center':\n              x = 0;\n              lineX = x - measuredWith / 2;\n              break;\n            case 'right':\n              x = width / 2;\n              lineX = x - measuredWith;\n              break;\n            default:\n              x = -(width / 2);\n              lineX = x;\n              break;\n          }\n\n          const y =\n            -(height / 2) +\n            (lineIndex === 0 ? view.css.fontSize.toPx() : view.css.fontSize.toPx() + lineIndex * lineHeight);\n          lineIndex++;\n          if (view.css.textStyle === 'stroke') {\n            this.ctx.strokeText(text, x, y, measuredWith);\n          } else {\n            this.ctx.fillText(text, x, y, measuredWith);\n          }\n          const fontSize = view.css.fontSize.toPx();\n          let textDecoration;\n          if (view.css.textDecoration) {\n            this.ctx.lineWidth = fontSize / 13;\n            this.ctx.beginPath();\n            if (/\\bunderline\\b/.test(view.css.textDecoration)) {\n              this.ctx.moveTo(lineX, y);\n              this.ctx.lineTo(lineX + measuredWith, y);\n              textDecoration = {\n                moveTo: [lineX, y],\n                lineTo: [lineX + measuredWith, y],\n              };\n            }\n            if (/\\boverline\\b/.test(view.css.textDecoration)) {\n              this.ctx.moveTo(lineX, y - fontSize);\n              this.ctx.lineTo(lineX + measuredWith, y - fontSize);\n              textDecoration = {\n                moveTo: [lineX, y - fontSize],\n                lineTo: [lineX + measuredWith, y - fontSize],\n              };\n            }\n            if (/\\bline-through\\b/.test(view.css.textDecoration)) {\n              this.ctx.moveTo(lineX, y - fontSize / 3);\n              this.ctx.lineTo(lineX + measuredWith, y - fontSize / 3);\n              textDecoration = {\n                moveTo: [lineX, y - fontSize / 3],\n                lineTo: [lineX + measuredWith, y - fontSize / 3],\n              };\n            }\n            this.ctx.closePath();\n            this.ctx.strokeStyle = view.css.color;\n            this.ctx.stroke();\n          }\n          if (view.id) {\n            penCache.textLines[view.id]\n              ? penCache.textLines[view.id].push({\n                  text,\n                  x,\n                  y,\n                  measuredWith,\n                  textDecoration,\n                })\n              : (penCache.textLines[view.id] = [\n                  {\n                    text,\n                    x,\n                    y,\n                    measuredWith,\n                    textDecoration,\n                  },\n                ]);\n          }\n        }\n      }\n    }\n    this.ctx.restore();\n    this._doBorder(view, width, height);\n  }\n\n  _drawAbsRect(view) {\n    this.ctx.save();\n    const { width, height } = this._preProcess(view);\n    if (GD.api.isGradient(view.css.color)) {\n      GD.api.doGradient(view.css.color, width, height, this.ctx);\n    } else {\n      this.ctx.fillStyle = view.css.color;\n    }\n    const { borderRadius, borderStyle, borderWidth } = view.css;\n    this._border({\n      borderRadius,\n      width,\n      height,\n      borderWidth,\n      borderStyle,\n    });\n    this.ctx.fill();\n    this.ctx.restore();\n    this._doBorder(view, width, height);\n  }\n\n  // shadow 支持 (x, y, blur, color), 不支持 spread\n  // shadow:0px 0px 10px rgba(0,0,0,0.1);\n  _doShadow(view) {\n    if (!view.css || !view.css.shadow) {\n      return;\n    }\n    const box = view.css.shadow.replace(/,\\s+/g, ',').split(/\\s+/);\n    if (box.length > 4) {\n      console.error(\"shadow don't spread option\");\n      return;\n    }\n    this.ctx.shadowOffsetX = parseInt(box[0], 10);\n    this.ctx.shadowOffsetY = parseInt(box[1], 10);\n    this.ctx.shadowBlur = parseInt(box[2], 10);\n    this.ctx.shadowColor = box[3];\n  }\n\n  _getAngle(angle) {\n    return (Number(angle) * Math.PI) / 180;\n  }\n}\n","/* eslint-disable */\n!(function () {\n\n  // alignment pattern\n  var adelta = [\n    0, 11, 15, 19, 23, 27, 31,\n    16, 18, 20, 22, 24, 26, 28, 20, 22, 24, 24, 26, 28, 28, 22, 24, 24,\n    26, 26, 28, 28, 24, 24, 26, 26, 26, 28, 28, 24, 26, 26, 26, 28, 28\n  ];\n\n  // version block\n  var vpat = [\n    0xc94, 0x5bc, 0xa99, 0x4d3, 0xbf6, 0x762, 0x847, 0x60d,\n    0x928, 0xb78, 0x45d, 0xa17, 0x532, 0x9a6, 0x683, 0x8c9,\n    0x7ec, 0xec4, 0x1e1, 0xfab, 0x08e, 0xc1a, 0x33f, 0xd75,\n    0x250, 0x9d5, 0x6f0, 0x8ba, 0x79f, 0xb0b, 0x42e, 0xa64,\n    0x541, 0xc69\n  ];\n\n  // final format bits with mask: level << 3 | mask\n  var fmtword = [\n    0x77c4, 0x72f3, 0x7daa, 0x789d, 0x662f, 0x6318, 0x6c41, 0x6976,    //L\n    0x5412, 0x5125, 0x5e7c, 0x5b4b, 0x45f9, 0x40ce, 0x4f97, 0x4aa0,    //M\n    0x355f, 0x3068, 0x3f31, 0x3a06, 0x24b4, 0x2183, 0x2eda, 0x2bed,    //Q\n    0x1689, 0x13be, 0x1ce7, 0x19d0, 0x0762, 0x0255, 0x0d0c, 0x083b    //H\n  ];\n\n  // 4 per version: number of blocks 1,2; data width; ecc width\n  var eccblocks = [\n    1, 0, 19, 7, 1, 0, 16, 10, 1, 0, 13, 13, 1, 0, 9, 17,\n    1, 0, 34, 10, 1, 0, 28, 16, 1, 0, 22, 22, 1, 0, 16, 28,\n    1, 0, 55, 15, 1, 0, 44, 26, 2, 0, 17, 18, 2, 0, 13, 22,\n    1, 0, 80, 20, 2, 0, 32, 18, 2, 0, 24, 26, 4, 0, 9, 16,\n    1, 0, 108, 26, 2, 0, 43, 24, 2, 2, 15, 18, 2, 2, 11, 22,\n    2, 0, 68, 18, 4, 0, 27, 16, 4, 0, 19, 24, 4, 0, 15, 28,\n    2, 0, 78, 20, 4, 0, 31, 18, 2, 4, 14, 18, 4, 1, 13, 26,\n    2, 0, 97, 24, 2, 2, 38, 22, 4, 2, 18, 22, 4, 2, 14, 26,\n    2, 0, 116, 30, 3, 2, 36, 22, 4, 4, 16, 20, 4, 4, 12, 24,\n    2, 2, 68, 18, 4, 1, 43, 26, 6, 2, 19, 24, 6, 2, 15, 28,\n    4, 0, 81, 20, 1, 4, 50, 30, 4, 4, 22, 28, 3, 8, 12, 24,\n    2, 2, 92, 24, 6, 2, 36, 22, 4, 6, 20, 26, 7, 4, 14, 28,\n    4, 0, 107, 26, 8, 1, 37, 22, 8, 4, 20, 24, 12, 4, 11, 22,\n    3, 1, 115, 30, 4, 5, 40, 24, 11, 5, 16, 20, 11, 5, 12, 24,\n    5, 1, 87, 22, 5, 5, 41, 24, 5, 7, 24, 30, 11, 7, 12, 24,\n    5, 1, 98, 24, 7, 3, 45, 28, 15, 2, 19, 24, 3, 13, 15, 30,\n    1, 5, 107, 28, 10, 1, 46, 28, 1, 15, 22, 28, 2, 17, 14, 28,\n    5, 1, 120, 30, 9, 4, 43, 26, 17, 1, 22, 28, 2, 19, 14, 28,\n    3, 4, 113, 28, 3, 11, 44, 26, 17, 4, 21, 26, 9, 16, 13, 26,\n    3, 5, 107, 28, 3, 13, 41, 26, 15, 5, 24, 30, 15, 10, 15, 28,\n    4, 4, 116, 28, 17, 0, 42, 26, 17, 6, 22, 28, 19, 6, 16, 30,\n    2, 7, 111, 28, 17, 0, 46, 28, 7, 16, 24, 30, 34, 0, 13, 24,\n    4, 5, 121, 30, 4, 14, 47, 28, 11, 14, 24, 30, 16, 14, 15, 30,\n    6, 4, 117, 30, 6, 14, 45, 28, 11, 16, 24, 30, 30, 2, 16, 30,\n    8, 4, 106, 26, 8, 13, 47, 28, 7, 22, 24, 30, 22, 13, 15, 30,\n    10, 2, 114, 28, 19, 4, 46, 28, 28, 6, 22, 28, 33, 4, 16, 30,\n    8, 4, 122, 30, 22, 3, 45, 28, 8, 26, 23, 30, 12, 28, 15, 30,\n    3, 10, 117, 30, 3, 23, 45, 28, 4, 31, 24, 30, 11, 31, 15, 30,\n    7, 7, 116, 30, 21, 7, 45, 28, 1, 37, 23, 30, 19, 26, 15, 30,\n    5, 10, 115, 30, 19, 10, 47, 28, 15, 25, 24, 30, 23, 25, 15, 30,\n    13, 3, 115, 30, 2, 29, 46, 28, 42, 1, 24, 30, 23, 28, 15, 30,\n    17, 0, 115, 30, 10, 23, 46, 28, 10, 35, 24, 30, 19, 35, 15, 30,\n    17, 1, 115, 30, 14, 21, 46, 28, 29, 19, 24, 30, 11, 46, 15, 30,\n    13, 6, 115, 30, 14, 23, 46, 28, 44, 7, 24, 30, 59, 1, 16, 30,\n    12, 7, 121, 30, 12, 26, 47, 28, 39, 14, 24, 30, 22, 41, 15, 30,\n    6, 14, 121, 30, 6, 34, 47, 28, 46, 10, 24, 30, 2, 64, 15, 30,\n    17, 4, 122, 30, 29, 14, 46, 28, 49, 10, 24, 30, 24, 46, 15, 30,\n    4, 18, 122, 30, 13, 32, 46, 28, 48, 14, 24, 30, 42, 32, 15, 30,\n    20, 4, 117, 30, 40, 7, 47, 28, 43, 22, 24, 30, 10, 67, 15, 30,\n    19, 6, 118, 30, 18, 31, 47, 28, 34, 34, 24, 30, 20, 61, 15, 30\n  ];\n\n  // Galois field log table\n  var glog = [\n    0xff, 0x00, 0x01, 0x19, 0x02, 0x32, 0x1a, 0xc6, 0x03, 0xdf, 0x33, 0xee, 0x1b, 0x68, 0xc7, 0x4b,\n    0x04, 0x64, 0xe0, 0x0e, 0x34, 0x8d, 0xef, 0x81, 0x1c, 0xc1, 0x69, 0xf8, 0xc8, 0x08, 0x4c, 0x71,\n    0x05, 0x8a, 0x65, 0x2f, 0xe1, 0x24, 0x0f, 0x21, 0x35, 0x93, 0x8e, 0xda, 0xf0, 0x12, 0x82, 0x45,\n    0x1d, 0xb5, 0xc2, 0x7d, 0x6a, 0x27, 0xf9, 0xb9, 0xc9, 0x9a, 0x09, 0x78, 0x4d, 0xe4, 0x72, 0xa6,\n    0x06, 0xbf, 0x8b, 0x62, 0x66, 0xdd, 0x30, 0xfd, 0xe2, 0x98, 0x25, 0xb3, 0x10, 0x91, 0x22, 0x88,\n    0x36, 0xd0, 0x94, 0xce, 0x8f, 0x96, 0xdb, 0xbd, 0xf1, 0xd2, 0x13, 0x5c, 0x83, 0x38, 0x46, 0x40,\n    0x1e, 0x42, 0xb6, 0xa3, 0xc3, 0x48, 0x7e, 0x6e, 0x6b, 0x3a, 0x28, 0x54, 0xfa, 0x85, 0xba, 0x3d,\n    0xca, 0x5e, 0x9b, 0x9f, 0x0a, 0x15, 0x79, 0x2b, 0x4e, 0xd4, 0xe5, 0xac, 0x73, 0xf3, 0xa7, 0x57,\n    0x07, 0x70, 0xc0, 0xf7, 0x8c, 0x80, 0x63, 0x0d, 0x67, 0x4a, 0xde, 0xed, 0x31, 0xc5, 0xfe, 0x18,\n    0xe3, 0xa5, 0x99, 0x77, 0x26, 0xb8, 0xb4, 0x7c, 0x11, 0x44, 0x92, 0xd9, 0x23, 0x20, 0x89, 0x2e,\n    0x37, 0x3f, 0xd1, 0x5b, 0x95, 0xbc, 0xcf, 0xcd, 0x90, 0x87, 0x97, 0xb2, 0xdc, 0xfc, 0xbe, 0x61,\n    0xf2, 0x56, 0xd3, 0xab, 0x14, 0x2a, 0x5d, 0x9e, 0x84, 0x3c, 0x39, 0x53, 0x47, 0x6d, 0x41, 0xa2,\n    0x1f, 0x2d, 0x43, 0xd8, 0xb7, 0x7b, 0xa4, 0x76, 0xc4, 0x17, 0x49, 0xec, 0x7f, 0x0c, 0x6f, 0xf6,\n    0x6c, 0xa1, 0x3b, 0x52, 0x29, 0x9d, 0x55, 0xaa, 0xfb, 0x60, 0x86, 0xb1, 0xbb, 0xcc, 0x3e, 0x5a,\n    0xcb, 0x59, 0x5f, 0xb0, 0x9c, 0xa9, 0xa0, 0x51, 0x0b, 0xf5, 0x16, 0xeb, 0x7a, 0x75, 0x2c, 0xd7,\n    0x4f, 0xae, 0xd5, 0xe9, 0xe6, 0xe7, 0xad, 0xe8, 0x74, 0xd6, 0xf4, 0xea, 0xa8, 0x50, 0x58, 0xaf\n  ];\n\n  // Galios field exponent table\n  var gexp = [\n    0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1d, 0x3a, 0x74, 0xe8, 0xcd, 0x87, 0x13, 0x26,\n    0x4c, 0x98, 0x2d, 0x5a, 0xb4, 0x75, 0xea, 0xc9, 0x8f, 0x03, 0x06, 0x0c, 0x18, 0x30, 0x60, 0xc0,\n    0x9d, 0x27, 0x4e, 0x9c, 0x25, 0x4a, 0x94, 0x35, 0x6a, 0xd4, 0xb5, 0x77, 0xee, 0xc1, 0x9f, 0x23,\n    0x46, 0x8c, 0x05, 0x0a, 0x14, 0x28, 0x50, 0xa0, 0x5d, 0xba, 0x69, 0xd2, 0xb9, 0x6f, 0xde, 0xa1,\n    0x5f, 0xbe, 0x61, 0xc2, 0x99, 0x2f, 0x5e, 0xbc, 0x65, 0xca, 0x89, 0x0f, 0x1e, 0x3c, 0x78, 0xf0,\n    0xfd, 0xe7, 0xd3, 0xbb, 0x6b, 0xd6, 0xb1, 0x7f, 0xfe, 0xe1, 0xdf, 0xa3, 0x5b, 0xb6, 0x71, 0xe2,\n    0xd9, 0xaf, 0x43, 0x86, 0x11, 0x22, 0x44, 0x88, 0x0d, 0x1a, 0x34, 0x68, 0xd0, 0xbd, 0x67, 0xce,\n    0x81, 0x1f, 0x3e, 0x7c, 0xf8, 0xed, 0xc7, 0x93, 0x3b, 0x76, 0xec, 0xc5, 0x97, 0x33, 0x66, 0xcc,\n    0x85, 0x17, 0x2e, 0x5c, 0xb8, 0x6d, 0xda, 0xa9, 0x4f, 0x9e, 0x21, 0x42, 0x84, 0x15, 0x2a, 0x54,\n    0xa8, 0x4d, 0x9a, 0x29, 0x52, 0xa4, 0x55, 0xaa, 0x49, 0x92, 0x39, 0x72, 0xe4, 0xd5, 0xb7, 0x73,\n    0xe6, 0xd1, 0xbf, 0x63, 0xc6, 0x91, 0x3f, 0x7e, 0xfc, 0xe5, 0xd7, 0xb3, 0x7b, 0xf6, 0xf1, 0xff,\n    0xe3, 0xdb, 0xab, 0x4b, 0x96, 0x31, 0x62, 0xc4, 0x95, 0x37, 0x6e, 0xdc, 0xa5, 0x57, 0xae, 0x41,\n    0x82, 0x19, 0x32, 0x64, 0xc8, 0x8d, 0x07, 0x0e, 0x1c, 0x38, 0x70, 0xe0, 0xdd, 0xa7, 0x53, 0xa6,\n    0x51, 0xa2, 0x59, 0xb2, 0x79, 0xf2, 0xf9, 0xef, 0xc3, 0x9b, 0x2b, 0x56, 0xac, 0x45, 0x8a, 0x09,\n    0x12, 0x24, 0x48, 0x90, 0x3d, 0x7a, 0xf4, 0xf5, 0xf7, 0xf3, 0xfb, 0xeb, 0xcb, 0x8b, 0x0b, 0x16,\n    0x2c, 0x58, 0xb0, 0x7d, 0xfa, 0xe9, 0xcf, 0x83, 0x1b, 0x36, 0x6c, 0xd8, 0xad, 0x47, 0x8e, 0x00\n  ];\n\n  // Working buffers:\n  // data input and ecc append, image working buffer, fixed part of image, run lengths for badness\n  var strinbuf = [], eccbuf = [], qrframe = [], framask = [], rlens = [];\n  // Control values - width is based on version, last 4 are from table.\n  var version, width, neccblk1, neccblk2, datablkw, eccblkwid;\n  var ecclevel = 2;\n  // set bit to indicate cell in qrframe is immutable.  symmetric around diagonal\n  function setmask(x, y) {\n    var bt;\n    if (x > y) {\n      bt = x;\n      x = y;\n      y = bt;\n    }\n    // y*y = 1+3+5...\n    bt = y;\n    bt *= y;\n    bt += y;\n    bt >>= 1;\n    bt += x;\n    framask[bt] = 1;\n  }\n\n  // enter alignment pattern - black to qrframe, white to mask (later black frame merged to mask)\n  function putalign(x, y) {\n    var j;\n\n    qrframe[x + width * y] = 1;\n    for (j = -2; j < 2; j++) {\n      qrframe[(x + j) + width * (y - 2)] = 1;\n      qrframe[(x - 2) + width * (y + j + 1)] = 1;\n      qrframe[(x + 2) + width * (y + j)] = 1;\n      qrframe[(x + j + 1) + width * (y + 2)] = 1;\n    }\n    for (j = 0; j < 2; j++) {\n      setmask(x - 1, y + j);\n      setmask(x + 1, y - j);\n      setmask(x - j, y - 1);\n      setmask(x + j, y + 1);\n    }\n  }\n\n  //========================================================================\n  // Reed Solomon error correction\n  // exponentiation mod N\n  function modnn(x) {\n    while (x >= 255) {\n      x -= 255;\n      x = (x >> 8) + (x & 255);\n    }\n    return x;\n  }\n\n  var genpoly = [];\n\n  // Calculate and append ECC data to data block.  Block is in strinbuf, indexes to buffers given.\n  function appendrs(data, dlen, ecbuf, eclen) {\n    var i, j, fb;\n\n    for (i = 0; i < eclen; i++)\n      strinbuf[ecbuf + i] = 0;\n    for (i = 0; i < dlen; i++) {\n      fb = glog[strinbuf[data + i] ^ strinbuf[ecbuf]];\n      if (fb != 255)     /* fb term is non-zero */\n        for (j = 1; j < eclen; j++)\n          strinbuf[ecbuf + j - 1] = strinbuf[ecbuf + j] ^ gexp[modnn(fb + genpoly[eclen - j])];\n      else\n        for (j = ecbuf; j < ecbuf + eclen; j++)\n          strinbuf[j] = strinbuf[j + 1];\n      strinbuf[ecbuf + eclen - 1] = fb == 255 ? 0 : gexp[modnn(fb + genpoly[0])];\n    }\n  }\n\n  //========================================================================\n  // Frame data insert following the path rules\n\n  // check mask - since symmetrical use half.\n  function ismasked(x, y) {\n    var bt;\n    if (x > y) {\n      bt = x;\n      x = y;\n      y = bt;\n    }\n    bt = y;\n    bt += y * y;\n    bt >>= 1;\n    bt += x;\n    return framask[bt];\n  }\n\n  //========================================================================\n  //  Apply the selected mask out of the 8.\n  function applymask(m) {\n    var x, y, r3x, r3y;\n\n    switch (m) {\n      case 0:\n        for (y = 0; y < width; y++)\n          for (x = 0; x < width; x++)\n            if (!((x + y) & 1) && !ismasked(x, y))\n              qrframe[x + y * width] ^= 1;\n        break;\n      case 1:\n        for (y = 0; y < width; y++)\n          for (x = 0; x < width; x++)\n            if (!(y & 1) && !ismasked(x, y))\n              qrframe[x + y * width] ^= 1;\n        break;\n      case 2:\n        for (y = 0; y < width; y++)\n          for (r3x = 0, x = 0; x < width; x++ , r3x++) {\n            if (r3x == 3)\n              r3x = 0;\n            if (!r3x && !ismasked(x, y))\n              qrframe[x + y * width] ^= 1;\n          }\n        break;\n      case 3:\n        for (r3y = 0, y = 0; y < width; y++ , r3y++) {\n          if (r3y == 3)\n            r3y = 0;\n          for (r3x = r3y, x = 0; x < width; x++ , r3x++) {\n            if (r3x == 3)\n              r3x = 0;\n            if (!r3x && !ismasked(x, y))\n              qrframe[x + y * width] ^= 1;\n          }\n        }\n        break;\n      case 4:\n        for (y = 0; y < width; y++)\n          for (r3x = 0, r3y = ((y >> 1) & 1), x = 0; x < width; x++ , r3x++) {\n            if (r3x == 3) {\n              r3x = 0;\n              r3y = !r3y;\n            }\n            if (!r3y && !ismasked(x, y))\n              qrframe[x + y * width] ^= 1;\n          }\n        break;\n      case 5:\n        for (r3y = 0, y = 0; y < width; y++ , r3y++) {\n          if (r3y == 3)\n            r3y = 0;\n          for (r3x = 0, x = 0; x < width; x++ , r3x++) {\n            if (r3x == 3)\n              r3x = 0;\n            if (!((x & y & 1) + !(!r3x | !r3y)) && !ismasked(x, y))\n              qrframe[x + y * width] ^= 1;\n          }\n        }\n        break;\n      case 6:\n        for (r3y = 0, y = 0; y < width; y++ , r3y++) {\n          if (r3y == 3)\n            r3y = 0;\n          for (r3x = 0, x = 0; x < width; x++ , r3x++) {\n            if (r3x == 3)\n              r3x = 0;\n            if (!(((x & y & 1) + (r3x && (r3x == r3y))) & 1) && !ismasked(x, y))\n              qrframe[x + y * width] ^= 1;\n          }\n        }\n        break;\n      case 7:\n        for (r3y = 0, y = 0; y < width; y++ , r3y++) {\n          if (r3y == 3)\n            r3y = 0;\n          for (r3x = 0, x = 0; x < width; x++ , r3x++) {\n            if (r3x == 3)\n              r3x = 0;\n            if (!(((r3x && (r3x == r3y)) + ((x + y) & 1)) & 1) && !ismasked(x, y))\n              qrframe[x + y * width] ^= 1;\n          }\n        }\n        break;\n    }\n    return;\n  }\n\n  // Badness coefficients.\n  var N1 = 3, N2 = 3, N3 = 40, N4 = 10;\n\n  // Using the table of the length of each run, calculate the amount of bad image \n  // - long runs or those that look like finders; called twice, once each for X and Y\n  function badruns(length) {\n    var i;\n    var runsbad = 0;\n    for (i = 0; i <= length; i++)\n      if (rlens[i] >= 5)\n        runsbad += N1 + rlens[i] - 5;\n    // BwBBBwB as in finder\n    for (i = 3; i < length - 1; i += 2)\n      if (rlens[i - 2] == rlens[i + 2]\n        && rlens[i + 2] == rlens[i - 1]\n        && rlens[i - 1] == rlens[i + 1]\n        && rlens[i - 1] * 3 == rlens[i]\n        // white around the black pattern? Not part of spec\n        && (rlens[i - 3] == 0 // beginning\n          || i + 3 > length  // end\n          || rlens[i - 3] * 3 >= rlens[i] * 4 || rlens[i + 3] * 3 >= rlens[i] * 4)\n      )\n        runsbad += N3;\n    return runsbad;\n  }\n\n  // Calculate how bad the masked image is - blocks, imbalance, runs, or finders.\n  function badcheck() {\n    var x, y, h, b, b1;\n    var thisbad = 0;\n    var bw = 0;\n\n    // blocks of same color.\n    for (y = 0; y < width - 1; y++)\n      for (x = 0; x < width - 1; x++)\n        if ((qrframe[x + width * y] && qrframe[(x + 1) + width * y]\n          && qrframe[x + width * (y + 1)] && qrframe[(x + 1) + width * (y + 1)]) // all black\n          || !(qrframe[x + width * y] || qrframe[(x + 1) + width * y]\n            || qrframe[x + width * (y + 1)] || qrframe[(x + 1) + width * (y + 1)])) // all white\n          thisbad += N2;\n\n    // X runs\n    for (y = 0; y < width; y++) {\n      rlens[0] = 0;\n      for (h = b = x = 0; x < width; x++) {\n        if ((b1 = qrframe[x + width * y]) == b)\n          rlens[h]++;\n        else\n          rlens[++h] = 1;\n        b = b1;\n        bw += b ? 1 : -1;\n      }\n      thisbad += badruns(h);\n    }\n\n    // black/white imbalance\n    if (bw < 0)\n      bw = -bw;\n\n    var big = bw;\n    var count = 0;\n    big += big << 2;\n    big <<= 1;\n    while (big > width * width)\n      big -= width * width, count++;\n    thisbad += count * N4;\n\n    // Y runs\n    for (x = 0; x < width; x++) {\n      rlens[0] = 0;\n      for (h = b = y = 0; y < width; y++) {\n        if ((b1 = qrframe[x + width * y]) == b)\n          rlens[h]++;\n        else\n          rlens[++h] = 1;\n        b = b1;\n      }\n      thisbad += badruns(h);\n    }\n    return thisbad;\n  }\n\n  function genframe(instring) {\n    var x, y, k, t, v, i, j, m;\n\n    // find the smallest version that fits the string\n    t = instring.length;\n    version = 0;\n    do {\n      version++;\n      k = (ecclevel - 1) * 4 + (version - 1) * 16;\n      neccblk1 = eccblocks[k++];\n      neccblk2 = eccblocks[k++];\n      datablkw = eccblocks[k++];\n      eccblkwid = eccblocks[k];\n      k = datablkw * (neccblk1 + neccblk2) + neccblk2 - 3 + (version <= 9);\n      if (t <= k)\n        break;\n    } while (version < 40);\n\n    // FIXME - insure that it fits insted of being truncated\n    width = 17 + 4 * version;\n\n    // allocate, clear and setup data structures\n    v = datablkw + (datablkw + eccblkwid) * (neccblk1 + neccblk2) + neccblk2;\n    for (t = 0; t < v; t++)\n      eccbuf[t] = 0;\n    strinbuf = instring.slice(0);\n\n    for (t = 0; t < width * width; t++)\n      qrframe[t] = 0;\n\n    for (t = 0; t < (width * (width + 1) + 1) / 2; t++)\n      framask[t] = 0;\n\n    // insert finders - black to frame, white to mask\n    for (t = 0; t < 3; t++) {\n      k = 0;\n      y = 0;\n      if (t == 1)\n        k = (width - 7);\n      if (t == 2)\n        y = (width - 7);\n      qrframe[(y + 3) + width * (k + 3)] = 1;\n      for (x = 0; x < 6; x++) {\n        qrframe[(y + x) + width * k] = 1;\n        qrframe[y + width * (k + x + 1)] = 1;\n        qrframe[(y + 6) + width * (k + x)] = 1;\n        qrframe[(y + x + 1) + width * (k + 6)] = 1;\n      }\n      for (x = 1; x < 5; x++) {\n        setmask(y + x, k + 1);\n        setmask(y + 1, k + x + 1);\n        setmask(y + 5, k + x);\n        setmask(y + x + 1, k + 5);\n      }\n      for (x = 2; x < 4; x++) {\n        qrframe[(y + x) + width * (k + 2)] = 1;\n        qrframe[(y + 2) + width * (k + x + 1)] = 1;\n        qrframe[(y + 4) + width * (k + x)] = 1;\n        qrframe[(y + x + 1) + width * (k + 4)] = 1;\n      }\n    }\n\n    // alignment blocks\n    if (version > 1) {\n      t = adelta[version];\n      y = width - 7;\n      for (; ;) {\n        x = width - 7;\n        while (x > t - 3) {\n          putalign(x, y);\n          if (x < t)\n            break;\n          x -= t;\n        }\n        if (y <= t + 9)\n          break;\n        y -= t;\n        putalign(6, y);\n        putalign(y, 6);\n      }\n    }\n\n    // single black\n    qrframe[8 + width * (width - 8)] = 1;\n\n    // timing gap - mask only\n    for (y = 0; y < 7; y++) {\n      setmask(7, y);\n      setmask(width - 8, y);\n      setmask(7, y + width - 7);\n    }\n    for (x = 0; x < 8; x++) {\n      setmask(x, 7);\n      setmask(x + width - 8, 7);\n      setmask(x, width - 8);\n    }\n\n    // reserve mask-format area\n    for (x = 0; x < 9; x++)\n      setmask(x, 8);\n    for (x = 0; x < 8; x++) {\n      setmask(x + width - 8, 8);\n      setmask(8, x);\n    }\n    for (y = 0; y < 7; y++)\n      setmask(8, y + width - 7);\n\n    // timing row/col\n    for (x = 0; x < width - 14; x++)\n      if (x & 1) {\n        setmask(8 + x, 6);\n        setmask(6, 8 + x);\n      }\n      else {\n        qrframe[(8 + x) + width * 6] = 1;\n        qrframe[6 + width * (8 + x)] = 1;\n      }\n\n    // version block\n    if (version > 6) {\n      t = vpat[version - 7];\n      k = 17;\n      for (x = 0; x < 6; x++)\n        for (y = 0; y < 3; y++ , k--)\n          if (1 & (k > 11 ? version >> (k - 12) : t >> k)) {\n            qrframe[(5 - x) + width * (2 - y + width - 11)] = 1;\n            qrframe[(2 - y + width - 11) + width * (5 - x)] = 1;\n          }\n          else {\n            setmask(5 - x, 2 - y + width - 11);\n            setmask(2 - y + width - 11, 5 - x);\n          }\n    }\n\n    // sync mask bits - only set above for white spaces, so add in black bits\n    for (y = 0; y < width; y++)\n      for (x = 0; x <= y; x++)\n        if (qrframe[x + width * y])\n          setmask(x, y);\n\n    // convert string to bitstream\n    // 8 bit data to QR-coded 8 bit data (numeric or alphanum, or kanji not supported)\n    v = strinbuf.length;\n\n    // string to array\n    for (i = 0; i < v; i++)\n      eccbuf[i] = strinbuf.charCodeAt(i);\n    strinbuf = eccbuf.slice(0);\n\n    // calculate max string length\n    x = datablkw * (neccblk1 + neccblk2) + neccblk2;\n    if (v >= x - 2) {\n      v = x - 2;\n      if (version > 9)\n        v--;\n    }\n\n    // shift and repack to insert length prefix\n    i = v;\n    if (version > 9) {\n      strinbuf[i + 2] = 0;\n      strinbuf[i + 3] = 0;\n      while (i--) {\n        t = strinbuf[i];\n        strinbuf[i + 3] |= 255 & (t << 4);\n        strinbuf[i + 2] = t >> 4;\n      }\n      strinbuf[2] |= 255 & (v << 4);\n      strinbuf[1] = v >> 4;\n      strinbuf[0] = 0x40 | (v >> 12);\n    }\n    else {\n      strinbuf[i + 1] = 0;\n      strinbuf[i + 2] = 0;\n      while (i--) {\n        t = strinbuf[i];\n        strinbuf[i + 2] |= 255 & (t << 4);\n        strinbuf[i + 1] = t >> 4;\n      }\n      strinbuf[1] |= 255 & (v << 4);\n      strinbuf[0] = 0x40 | (v >> 4);\n    }\n    // fill to end with pad pattern\n    i = v + 3 - (version < 10);\n    while (i < x) {\n      strinbuf[i++] = 0xec;\n      // buffer has room    if (i == x)      break;\n      strinbuf[i++] = 0x11;\n    }\n\n    // calculate and append ECC\n\n    // calculate generator polynomial\n    genpoly[0] = 1;\n    for (i = 0; i < eccblkwid; i++) {\n      genpoly[i + 1] = 1;\n      for (j = i; j > 0; j--)\n        genpoly[j] = genpoly[j]\n          ? genpoly[j - 1] ^ gexp[modnn(glog[genpoly[j]] + i)] : genpoly[j - 1];\n      genpoly[0] = gexp[modnn(glog[genpoly[0]] + i)];\n    }\n    for (i = 0; i <= eccblkwid; i++)\n      genpoly[i] = glog[genpoly[i]]; // use logs for genpoly[] to save calc step\n\n    // append ecc to data buffer\n    k = x;\n    y = 0;\n    for (i = 0; i < neccblk1; i++) {\n      appendrs(y, datablkw, k, eccblkwid);\n      y += datablkw;\n      k += eccblkwid;\n    }\n    for (i = 0; i < neccblk2; i++) {\n      appendrs(y, datablkw + 1, k, eccblkwid);\n      y += datablkw + 1;\n      k += eccblkwid;\n    }\n    // interleave blocks\n    y = 0;\n    for (i = 0; i < datablkw; i++) {\n      for (j = 0; j < neccblk1; j++)\n        eccbuf[y++] = strinbuf[i + j * datablkw];\n      for (j = 0; j < neccblk2; j++)\n        eccbuf[y++] = strinbuf[(neccblk1 * datablkw) + i + (j * (datablkw + 1))];\n    }\n    for (j = 0; j < neccblk2; j++)\n      eccbuf[y++] = strinbuf[(neccblk1 * datablkw) + i + (j * (datablkw + 1))];\n    for (i = 0; i < eccblkwid; i++)\n      for (j = 0; j < neccblk1 + neccblk2; j++)\n        eccbuf[y++] = strinbuf[x + i + j * eccblkwid];\n    strinbuf = eccbuf;\n\n    // pack bits into frame avoiding masked area.\n    x = y = width - 1;\n    k = v = 1;         // up, minus\n    /* inteleaved data and ecc codes */\n    m = (datablkw + eccblkwid) * (neccblk1 + neccblk2) + neccblk2;\n    for (i = 0; i < m; i++) {\n      t = strinbuf[i];\n      for (j = 0; j < 8; j++ , t <<= 1) {\n        if (0x80 & t)\n          qrframe[x + width * y] = 1;\n        do {        // find next fill position\n          if (v)\n            x--;\n          else {\n            x++;\n            if (k) {\n              if (y != 0)\n                y--;\n              else {\n                x -= 2;\n                k = !k;\n                if (x == 6) {\n                  x--;\n                  y = 9;\n                }\n              }\n            }\n            else {\n              if (y != width - 1)\n                y++;\n              else {\n                x -= 2;\n                k = !k;\n                if (x == 6) {\n                  x--;\n                  y -= 8;\n                }\n              }\n            }\n          }\n          v = !v;\n        } while (ismasked(x, y));\n      }\n    }\n\n    // save pre-mask copy of frame\n    strinbuf = qrframe.slice(0);\n    t = 0;           // best\n    y = 30000;         // demerit\n    // for instead of while since in original arduino code\n    // if an early mask was \"good enough\" it wouldn't try for a better one\n    // since they get more complex and take longer.\n    for (k = 0; k < 8; k++) {\n      applymask(k);      // returns black-white imbalance\n      x = badcheck();\n      if (x < y) { // current mask better than previous best?\n        y = x;\n        t = k;\n      }\n      if (t == 7)\n        break;       // don't increment i to a void redoing mask\n      qrframe = strinbuf.slice(0); // reset for next pass\n    }\n    if (t != k)         // redo best mask - none good enough, last wasn't t\n      applymask(t);\n\n    // add in final mask/ecclevel bytes\n    y = fmtword[t + ((ecclevel - 1) << 3)];\n    // low byte\n    for (k = 0; k < 8; k++ , y >>= 1)\n      if (y & 1) {\n        qrframe[(width - 1 - k) + width * 8] = 1;\n        if (k < 6)\n          qrframe[8 + width * k] = 1;\n        else\n          qrframe[8 + width * (k + 1)] = 1;\n      }\n    // high byte\n    for (k = 0; k < 7; k++ , y >>= 1)\n      if (y & 1) {\n        qrframe[8 + width * (width - 7 + k)] = 1;\n        if (k)\n          qrframe[(6 - k) + width * 8] = 1;\n        else\n          qrframe[7 + width * 8] = 1;\n      }\n    return qrframe;\n  }\n\n\n\n\n  var _canvas = null;\n\n  var api = {\n\n    get ecclevel() {\n      return ecclevel;\n    },\n\n    set ecclevel(val) {\n      ecclevel = val;\n    },\n\n    get size() {\n      return _size;\n    },\n\n    set size(val) {\n      _size = val\n    },\n\n    get canvas() {\n      return _canvas;\n    },\n\n    set canvas(el) {\n      _canvas = el;\n    },\n\n    getFrame: function (string) {\n      return genframe(string);\n    },\n    //这里的utf16to8(str)是对Text中的字符串进行转码，让其支持中文\n    utf16to8: function (str) {\n      var out, i, len, c;\n\n      out = \"\";\n      len = str.length;\n      for (i = 0; i < len; i++) {\n        c = str.charCodeAt(i);\n        if ((c >= 0x0001) && (c <= 0x007F)) {\n          out += str.charAt(i);\n        } else if (c > 0x07FF) {\n          out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));\n          out += String.fromCharCode(0x80 | ((c >> 6) & 0x3F));\n          out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));\n        } else {\n          out += String.fromCharCode(0xC0 | ((c >> 6) & 0x1F));\n          out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));\n        }\n      }\n      return out;\n    },\n    /**\n     * 新增$this参数，传入组件的this,兼容在组件中生成\n     * @param bg 目前只能设置颜色值\n     */ \n    draw: function (str, ctx, startX, startY, cavW, cavH, bg, color, $this, ecc) {\n      var that = this;\n      ecclevel = ecc || ecclevel;\n      if (!ctx) {\n        console.warn('No canvas provided to draw QR code in!')\n        return;\n      }\n      var size = Math.min(cavW, cavH);\n      str = that.utf16to8(str);//增加中文显示\n\n      var frame = that.getFrame(str);\n      var px = size / width;\n      if (bg) {\n        ctx.fillStyle = bg;\n        ctx.fillRect(startX, startY, cavW, cavW);\n      }\n      ctx.fillStyle = color || 'black';\n      for (var i = 0; i < width; i++) {\n        for (var j = 0; j < width; j++) {\n          if (frame[j * width + i]) {\n            ctx.fillRect(startX + px * i, startY + px * j, px, px);\n          }\n        }\n      }\n    }\n  }\n  module.exports = { api }\n  // exports.draw = api;\n\n})();","var hexcase = 0;\nvar chrsz = 8;\n\nfunction hex_sha1(s) {\n  return binb2hex(core_sha1(str2binb(s), s.length * chrsz));\n}\n\nfunction core_sha1(x, len) {\n  x[len >> 5] |= 0x80 << (24 - (len % 32));\n  x[(((len + 64) >> 9) << 4) + 15] = len;\n\n  var w = Array(80);\n  var a = 1732584193;\n  var b = -271733879;\n  var c = -1732584194;\n  var d = 271733878;\n  var e = -1009589776;\n\n  for (var i = 0; i < x.length; i += 16) {\n    var olda = a;\n    var oldb = b;\n    var oldc = c;\n    var oldd = d;\n    var olde = e;\n\n    for (var j = 0; j < 80; j++) {\n      if (j < 16) w[j] = x[i + j];\n      else w[j] = rol(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);\n      var t = safe_add(\n        safe_add(rol(a, 5), sha1_ft(j, b, c, d)),\n        safe_add(safe_add(e, w[j]), sha1_kt(j))\n      );\n      e = d;\n      d = c;\n      c = rol(b, 30);\n      b = a;\n      a = t;\n    }\n\n    a = safe_add(a, olda);\n    b = safe_add(b, oldb);\n    c = safe_add(c, oldc);\n    d = safe_add(d, oldd);\n    e = safe_add(e, olde);\n  }\n  return Array(a, b, c, d, e);\n}\n\nfunction sha1_ft(t, b, c, d) {\n  if (t < 20) return (b & c) | (~b & d);\n  if (t < 40) return b ^ c ^ d;\n  if (t < 60) return (b & c) | (b & d) | (c & d);\n  return b ^ c ^ d;\n}\n\nfunction sha1_kt(t) {\n  return t < 20\n    ? 1518500249\n    : t < 40\n    ? 1859775393\n    : t < 60\n    ? -1894007588\n    : -899497514;\n}\n\nfunction safe_add(x, y) {\n  var lsw = (x & 0xffff) + (y & 0xffff);\n  var msw = (x >> 16) + (y >> 16) + (lsw >> 16);\n  return (msw << 16) | (lsw & 0xffff);\n}\n\nfunction rol(num, cnt) {\n  return (num << cnt) | (num >>> (32 - cnt));\n}\n\nfunction str2binb(str) {\n  var bin = Array();\n  var mask = (1 << chrsz) - 1;\n  for (var i = 0; i < str.length * chrsz; i += chrsz)\n    bin[i >> 5] |= (str.charCodeAt(i / chrsz) & mask) << (24 - (i % 32));\n  return bin;\n}\n\nfunction binb2hex(binarray) {\n  var hex_tab = hexcase ? \"0123456789ABCDEF\" : \"0123456789abcdef\";\n  var str = \"\";\n  for (var i = 0; i < binarray.length * 4; i++) {\n    str +=\n      hex_tab.charAt((binarray[i >> 2] >> ((3 - (i % 4)) * 8 + 4)) & 0xf) +\n      hex_tab.charAt((binarray[i >> 2] >> ((3 - (i % 4)) * 8)) & 0xf);\n  }\n  return str;\n}\n\nmodule.exports = {\n  hex_sha1,\n}","String.prototype.substr = function (start, length) {\n  if (start === undefined) {\n    return this.toString()\n  }\n  if (typeof start !== 'number' || (typeof length !== 'number' && length !== undefined) ) {\n    return ''\n  }\n  const strArr = [...this]\n  const _length = strArr.length\n  if (_length + start < 0) {\n    start = 0\n  }\n  if (length === undefined || (start < 0 && start + length > 0)) {\n    return strArr.slice(start).join('')\n  } else {\n    return strArr.slice(start, start + length).join('')\n  }\n}\n\n\nString.prototype.substring = function (start, end) {\n  if (start === undefined) {\n    return this.toString()\n  }\n  if (typeof start !== 'number' || (typeof end !== 'number' && end !== undefined) ) {\n    return ''\n  }\n  if (!(start > 0)) {\n    start = 0\n  }\n  if (!(end > 0) && end !== undefined) {\n    end = 0\n  }\n  const strArr = [...this]\n  const _length = strArr.length\n  if (start > _length) {\n    start = _length\n  }\n  if (end > _length) {\n    end = _length\n  }\n  if (end < start) {\n    [start, end] = [end, start]\n  }\n  return strArr.slice(start, end).join('')\n}","\nfunction isValidUrl(url) {\n  return isOnlineUrl(url) || isDataUrl(url);\n}\n\nfunction isOnlineUrl(url) {\n  return /((ht|f)tp(s?)|cloud):\\/\\/([^ \\\\/]*\\.)+[^ \\\\/]*(:[0-9]+)?\\/?/.test(url)\n}\n\nfunction isDataUrl(url) {\n  return /data:image\\/(\\w+);base64,(.*)/.test(url);\n}\n\n/**\n * 深度对比两个对象是否一致\n * from: https://github.com/epoberezkin/fast-deep-equal\n * @param  {Object} a 对象a\n * @param  {Object} b 对象b\n * @return {Boolean}   是否相同\n */\n/* eslint-disable */\nfunction equal(a, b) {\n  if (a === b) return true;\n\n  if (a && b && typeof a == 'object' && typeof b == 'object') {\n    var arrA = Array.isArray(a)\n      , arrB = Array.isArray(b)\n      , i\n      , length\n      , key;\n\n    if (arrA && arrB) {\n      length = a.length;\n      if (length != b.length) return false;\n      for (i = length; i-- !== 0;)\n        if (!equal(a[i], b[i])) return false;\n      return true;\n    }\n\n    if (arrA != arrB) return false;\n\n    var dateA = a instanceof Date\n      , dateB = b instanceof Date;\n    if (dateA != dateB) return false;\n    if (dateA && dateB) return a.getTime() == b.getTime();\n\n    var regexpA = a instanceof RegExp\n      , regexpB = b instanceof RegExp;\n    if (regexpA != regexpB) return false;\n    if (regexpA && regexpB) return a.toString() == b.toString();\n\n    var keys = Object.keys(a);\n    length = keys.length;\n\n    if (length !== Object.keys(b).length)\n      return false;\n\n    for (i = length; i-- !== 0;)\n      if (!Object.prototype.hasOwnProperty.call(b, keys[i])) return false;\n\n    for (i = length; i-- !== 0;) {\n      key = keys[i];\n      if (!equal(a[key], b[key])) return false;\n    }\n\n    return true;\n  }\n\n  return a!==a && b!==b;\n}\n\nmodule.exports = {\n  isValidUrl,\n  isOnlineUrl,\n  isDataUrl,\n  equal\n};\n\n","// @ts-check\nexport default class WxCanvas {\n  ctx;\n  type;\n  canvasId;\n  canvasNode;\n  stepList = [];\n  canvasPrototype = {};\n\n  constructor(type, ctx, canvasId, isNew, canvasNode) {\n    this.ctx = ctx;\n    this.canvasId = canvasId;\n    this.type = type;\n    if (isNew) {\n      this.canvasNode = canvasNode || {};\n    }\n  }\n\n  set width(w) {\n    if (this.canvasNode) {\n      this.canvasNode.width = w;\n      // 经测试，在 2d 接口中如果不设置这个值，IOS 端有一定几率会出现图片显示不全的情况。\n      this.canvasNode._width = w;\n    }\n  }\n\n  get width() {\n    if (this.canvasNode) return this.canvasNode.width;\n    return 0;\n  }\n\n  set height(h) {\n    if (this.canvasNode) {\n      this.canvasNode.height = h;\n      // 经测试，在 2d 接口中如果不设置这个值，IOS 端有一定几率会出现图片显示不全的情况。\n      this.canvasNode._height = h;\n    }\n  }\n\n  get height() {\n    if (this.canvasNode) return this.canvasNode.height;\n    return 0;\n  }\n\n  set lineWidth(args) {\n    this.canvasPrototype.lineWidth = args;\n    this.stepList.push({\n      action: \"lineWidth\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get lineWidth() {\n    return this.canvasPrototype.lineWidth;\n  }\n\n  set lineCap(args) {\n    this.canvasPrototype.lineCap = args;\n    this.stepList.push({\n      action: \"lineCap\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get lineCap() {\n    return this.canvasPrototype.lineCap;\n  }\n\n  set lineJoin(args) {\n    this.canvasPrototype.lineJoin = args;\n    this.stepList.push({\n      action: \"lineJoin\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get lineJoin() {\n    return this.canvasPrototype.lineJoin;\n  }\n\n  set miterLimit(args) {\n    this.canvasPrototype.miterLimit = args;\n    this.stepList.push({\n      action: \"miterLimit\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get miterLimit() {\n    return this.canvasPrototype.miterLimit;\n  }\n\n  set lineDashOffset(args) {\n    this.canvasPrototype.lineDashOffset = args;\n    this.stepList.push({\n      action: \"lineDashOffset\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get lineDashOffset() {\n    return this.canvasPrototype.lineDashOffset;\n  }\n\n  set font(args) {\n    this.canvasPrototype.font = args;\n    this.ctx.font = args;\n    this.stepList.push({\n      action: \"font\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get font() {\n    return this.canvasPrototype.font;\n  }\n\n  set textAlign(args) {\n    this.canvasPrototype.textAlign = args;\n    this.stepList.push({\n      action: \"textAlign\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get textAlign() {\n    return this.canvasPrototype.textAlign;\n  }\n\n  set textBaseline(args) {\n    this.canvasPrototype.textBaseline = args;\n    this.stepList.push({\n      action: \"textBaseline\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get textBaseline() {\n    return this.canvasPrototype.textBaseline;\n  }\n\n  set fillStyle(args) {\n    this.canvasPrototype.fillStyle = args;\n    this.stepList.push({\n      action: \"fillStyle\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get fillStyle() {\n    return this.canvasPrototype.fillStyle;\n  }\n\n  set strokeStyle(args) {\n    this.canvasPrototype.strokeStyle = args;\n    this.stepList.push({\n      action: \"strokeStyle\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get strokeStyle() {\n    return this.canvasPrototype.strokeStyle;\n  }\n\n  set globalAlpha(args) {\n    this.canvasPrototype.globalAlpha = args;\n    this.stepList.push({\n      action: \"globalAlpha\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get globalAlpha() {\n    return this.canvasPrototype.globalAlpha;\n  }\n\n  set globalCompositeOperation(args) {\n    this.canvasPrototype.globalCompositeOperation = args;\n    this.stepList.push({\n      action: \"globalCompositeOperation\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get globalCompositeOperation() {\n    return this.canvasPrototype.globalCompositeOperation;\n  }\n\n  set shadowColor(args) {\n    this.canvasPrototype.shadowColor = args;\n    this.stepList.push({\n      action: \"shadowColor\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get shadowColor() {\n    return this.canvasPrototype.shadowColor;\n  }\n\n  set shadowOffsetX(args) {\n    this.canvasPrototype.shadowOffsetX = args;\n    this.stepList.push({\n      action: \"shadowOffsetX\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get shadowOffsetX() {\n    return this.canvasPrototype.shadowOffsetX;\n  }\n\n  set shadowOffsetY(args) {\n    this.canvasPrototype.shadowOffsetY = args;\n    this.stepList.push({\n      action: \"shadowOffsetY\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get shadowOffsetY() {\n    return this.canvasPrototype.shadowOffsetY;\n  }\n\n  set shadowBlur(args) {\n    this.canvasPrototype.shadowBlur = args;\n    this.stepList.push({\n      action: \"shadowBlur\",\n      args,\n      actionType: \"set\",\n    });\n  }\n\n  get shadowBlur() {\n    return this.canvasPrototype.shadowBlur;\n  }\n\n  save() {\n    this.stepList.push({\n      action: \"save\",\n      args: null,\n      actionType: \"func\",\n    });\n  }\n\n  restore() {\n    this.stepList.push({\n      action: \"restore\",\n      args: null,\n      actionType: \"func\",\n    });\n  }\n\n  setLineDash(...args) {\n    this.canvasPrototype.lineDash = args;\n    this.stepList.push({\n      action: \"setLineDash\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  moveTo(...args) {\n    this.stepList.push({\n      action: \"moveTo\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  closePath() {\n    this.stepList.push({\n      action: \"closePath\",\n      args: null,\n      actionType: \"func\",\n    });\n  }\n\n  lineTo(...args) {\n    this.stepList.push({\n      action: \"lineTo\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  quadraticCurveTo(...args) {\n    this.stepList.push({\n      action: \"quadraticCurveTo\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  bezierCurveTo(...args) {\n    this.stepList.push({\n      action: \"bezierCurveTo\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  arcTo(...args) {\n    this.stepList.push({\n      action: \"arcTo\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  arc(...args) {\n    this.stepList.push({\n      action: \"arc\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  rect(...args) {\n    this.stepList.push({\n      action: \"rect\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  scale(...args) {\n    this.stepList.push({\n      action: \"scale\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  rotate(...args) {\n    this.stepList.push({\n      action: \"rotate\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  translate(...args) {\n    this.stepList.push({\n      action: \"translate\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  transform(...args) {\n    this.stepList.push({\n      action: \"transform\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  setTransform(...args) {\n    this.stepList.push({\n      action: \"setTransform\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  clearRect(...args) {\n    this.stepList.push({\n      action: \"clearRect\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  fillRect(...args) {\n    this.stepList.push({\n      action: \"fillRect\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  strokeRect(...args) {\n    this.stepList.push({\n      action: \"strokeRect\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  fillText(...args) {\n    this.stepList.push({\n      action: \"fillText\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  strokeText(...args) {\n    this.stepList.push({\n      action: \"strokeText\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  beginPath() {\n    this.stepList.push({\n      action: \"beginPath\",\n      args: null,\n      actionType: \"func\",\n    });\n  }\n\n  fill() {\n    this.stepList.push({\n      action: \"fill\",\n      args: null,\n      actionType: \"func\",\n    });\n  }\n\n  stroke() {\n    this.stepList.push({\n      action: \"stroke\",\n      args: null,\n      actionType: \"func\",\n    });\n  }\n\n  drawFocusIfNeeded(...args) {\n    this.stepList.push({\n      action: \"drawFocusIfNeeded\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  clip() {\n    this.stepList.push({\n      action: \"clip\",\n      args: null,\n      actionType: \"func\",\n    });\n  }\n\n  isPointInPath(...args) {\n    this.stepList.push({\n      action: \"isPointInPath\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  drawImage(...args) {\n    this.stepList.push({\n      action: \"drawImage\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  addHitRegion(...args) {\n    this.stepList.push({\n      action: \"addHitRegion\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  removeHitRegion(...args) {\n    this.stepList.push({\n      action: \"removeHitRegion\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  clearHitRegions(...args) {\n    this.stepList.push({\n      action: \"clearHitRegions\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  putImageData(...args) {\n    this.stepList.push({\n      action: \"putImageData\",\n      args,\n      actionType: \"func\",\n    });\n  }\n\n  getLineDash() {\n    return this.canvasPrototype.lineDash;\n  }\n\n  createLinearGradient(...args) {\n    return this.ctx.createLinearGradient(...args);\n  }\n\n  createRadialGradient(...args) {\n    if (this.type === \"2d\") {\n      return this.ctx.createRadialGradient(...args);\n    } else {\n      return this.ctx.createCircularGradient(...args.slice(3, 6));\n    }\n  }\n\n  createPattern(...args) {\n    return this.ctx.createPattern(...args);\n  }\n\n  measureText(...args) {\n    return this.ctx.measureText(...args);\n  }\n\n  createImageData(...args) {\n    return this.ctx.createImageData(...args);\n  }\n\n  getImageData(...args) {\n    return this.ctx.getImageData(...args);\n  }\n\n  async draw(reserve, func) {\n    const realstepList = this.stepList.slice();\n    this.stepList.length = 0;\n    if (this.type === \"mina\") {\n      if (realstepList.length > 0) {\n        for (const step of realstepList) {\n          this.implementMinaStep(step);\n        }\n        realstepList.length = 0;\n      }\n      this.ctx.draw(reserve, func);\n    } else if (this.type === \"2d\") {\n      if (!reserve) {\n        this.ctx.clearRect(0, 0, this.canvasNode.width, this.canvasNode.height);\n      }\n      if (realstepList.length > 0) {\n        for (const step of realstepList) {\n          await this.implement2DStep(step);\n        }\n        realstepList.length = 0;\n      }\n      if (func) {\n        func();\n      }\n    }\n    realstepList.length = 0;\n  }\n\n  implementMinaStep(step) {\n    switch (step.action) {\n      case \"textAlign\": {\n        this.ctx.setTextAlign(step.args);\n        break;\n      }\n      case \"textBaseline\": {\n        this.ctx.setTextBaseline(step.args);\n        break;\n      }\n      default: {\n        if (step.actionType === \"set\") {\n          this.ctx[step.action] = step.args;\n        } else if (step.actionType === \"func\") {\n          if (step.args) {\n            this.ctx[step.action](...step.args);\n          } else {\n            this.ctx[step.action]();\n          }\n        }\n        break;\n      }\n    }\n  }\n\n  implement2DStep(step) {\n    return new Promise((resolve) => {\n      if (step.action === \"drawImage\") {\n        const img = this.canvasNode.createImage();\n        img.src = step.args[0];\n        img.onload = () => {\n          this.ctx.drawImage(img, ...step.args.slice(1));\n          resolve(1);\n        };\n      } else {\n        if (step.actionType === \"set\") {\n          this.ctx[step.action] = step.args;\n        } else if (step.actionType === \"func\") {\n          if (step.args) {\n            this.ctx[step.action](...step.args);\n          } else {\n            this.ctx[step.action]();\n          }\n        }\n        resolve(1);\n      }\n    });\n  }\n}\n","import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction _createForOfIteratorHelper(r, e) { var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t[\"return\"] || t[\"return\"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\n/* eslint-disable */\nimport React, { Component, Fragment } from 'react';\nimport { View, Button, Canvas } from '@tarojs/components';\nimport Pen, { penCache, clearPenCache } from './libs/pen';\nimport Downloader from './libs/downloader';\nimport WxCanvas from './libs/wx-canvas';\nimport util from './libs/util';\nimport Taro from '@tarojs/taro';\nvar calc = require('./libs/calc');\n\n// 最大尝试的绘制次数\nvar MAX_PAINT_COUNT = 5;\nvar ACTION_DEFAULT_SIZE = 24;\nvar ACTION_OFFSET = '2rpx';\nfunction setStringPrototype(screenK, scale) {\n  // @ts-ignore\n  String.prototype.toPx = function toPx(_, baseSize) {\n    if (this === '0') {\n      return 0;\n    }\n    var REG = /-?[0-9]+(\\.[0-9]+)?(rpx|px|%)/;\n    var parsePx = function parsePx(origin) {\n      var results = new RegExp(REG).exec(origin);\n      if (!origin || !results) {\n        console.error(\"The size: \".concat(origin, \" is illegal\"));\n        return 0;\n      }\n      var unit = results[2];\n      var value = parseFloat(origin);\n      var res = 0;\n      if (unit === 'rpx') {\n        res = Math.round(value * (screenK || 0.5) * (scale || 1));\n      } else if (unit === 'px') {\n        res = Math.round(value * (scale || 1));\n      } else if (unit === '%') {\n        res = Math.round(value * baseSize / 100);\n      }\n      return res;\n    };\n    var formula = /^calc\\((.+)\\)$/.exec(this);\n    if (formula && formula[1]) {\n      // 进行 calc 计算\n      var afterOne = formula[1].replace(/([^\\s\\(\\+\\-\\*\\/]+)\\.(left|right|bottom|top|width|height)/g, function (word) {\n        var _word$split = word.split('.'),\n          _word$split2 = _slicedToArray(_word$split, 2),\n          id = _word$split2[0],\n          attr = _word$split2[1];\n        return penCache.viewRect[id][attr];\n      });\n      var afterTwo = afterOne.replace(new RegExp(REG, 'g'), parsePx);\n      return calc(afterTwo);\n    }\n    return parsePx(this);\n  };\n}\nvar WeAppPoster = /*#__PURE__*/function (_Component) {\n  function WeAppPoster(props) {\n    var _this;\n    _classCallCheck(this, WeAppPoster);\n    _this = _callSuper(this, WeAppPoster, [props]);\n    _this.state = {\n      picURL: '',\n      showCanvas: true,\n      painterStyle: '',\n      photoStyle: ''\n    };\n    _this.canvasWidthInPx = 0;\n    _this.canvasHeightInPx = 0;\n    _this.canvasNode = null;\n    _this.paintCount = 0;\n    _this.currentPalette = {};\n    _this.outterDisabled = false;\n    _this.isDisabled = false;\n    _this.needClear = false;\n    _this.frontContext = Object.create(null);\n    _this.bottomContext = Object.create(null);\n    _this.topContext = Object.create(null);\n    _this.globalContext = Object.create(null);\n    _this.touchedView = {};\n    _this.findedIndex = -1;\n    _this.startX = 0;\n    _this.startY = 0;\n    _this.startH = 0;\n    _this.startW = 0;\n    _this.isScale = false;\n    _this.startTimeStamp = 0;\n    _this.hasMove = false;\n    return _this;\n  }\n  _inherits(WeAppPoster, _Component);\n  return _createClass(WeAppPoster, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.initialize();\n    }\n  }, {\n    key: \"initialize\",\n    value: function initialize() {\n      var _this2 = this;\n      var _this$props = this.props,\n        use2D = _this$props.use2D,\n        palette = _this$props.palette,\n        dancePalette = _this$props.dancePalette,\n        action = _this$props.action,\n        isDisabled = _this$props.isDisabled,\n        clearActionBox = _this$props.clearActionBox;\n      if (!this.isEmpty(palette) && use2D) {\n        this.paintCount = 0;\n        clearPenCache();\n        this.startPaint();\n      }\n      if (!this.isEmpty(dancePalette) && !use2D) {\n        clearPenCache();\n        this.initDancePalette(dancePalette);\n      }\n      if (action && !this.isEmpty(action) && !use2D) {\n        this.doAction(action, null, false, true);\n      }\n      this.outterDisabled = isDisabled;\n      this.isDisabled = isDisabled;\n      if (clearActionBox && !this.needClear) {\n        if (this.frontContext) {\n          var timer = setTimeout(function () {\n            clearTimeout(timer);\n            _this2.frontContext.draw();\n          }, 100);\n          this.touchedView = {};\n          this.prevFindedIndex = this.findedIndex;\n          this.findedIndex = -1;\n        }\n      }\n      this.needClear = clearActionBox;\n    }\n  }, {\n    key: \"isEmpty\",\n    value: function isEmpty(object) {\n      for (var i in object) {\n        return false;\n      }\n      return true;\n    }\n  }, {\n    key: \"isNeedRefresh\",\n    value: function isNeedRefresh(newVal, oldVal) {\n      if (!newVal || this.isEmpty(newVal) || this.props.dirty && util.equal(newVal, oldVal)) {\n        return false;\n      }\n      return true;\n    }\n  }, {\n    key: \"getBox\",\n    value: function getBox(rect, type) {\n      var boxArea = {\n        type: 'rect',\n        css: {\n          height: \"\".concat(rect.bottom - rect.top, \"px\"),\n          width: \"\".concat(rect.right - rect.left, \"px\"),\n          left: \"\".concat(rect.left, \"px\"),\n          top: \"\".concat(rect.top, \"px\"),\n          borderWidth: '4rpx',\n          borderColor: '#1A7AF8',\n          color: 'transparent'\n        }\n      };\n      if (type === 'text') {\n        boxArea.css = _objectSpread(_objectSpread({}, boxArea.css), {}, {\n          borderStyle: 'dashed'\n        });\n      }\n      if (this.props.customActionStyle && this.props.customActionStyle.border) {\n        boxArea.css = _objectSpread(_objectSpread({}, boxArea.css), this.props.customActionStyle.border);\n      }\n      Object.assign(boxArea, {\n        id: 'box'\n      });\n      return boxArea;\n    }\n  }, {\n    key: \"getScaleIcon\",\n    value: function getScaleIcon(rect, type) {\n      var scaleArea = {};\n      var customActionStyle = this.props.customActionStyle;\n      if (customActionStyle && customActionStyle.scale) {\n        scaleArea = {\n          type: 'image',\n          url: type === 'text' ? customActionStyle.scale.textIcon : customActionStyle.scale.imageIcon,\n          css: {\n            height: \"\".concat(2 * ACTION_DEFAULT_SIZE, \"rpx\"),\n            width: \"\".concat(2 * ACTION_DEFAULT_SIZE, \"rpx\"),\n            borderRadius: \"\".concat(ACTION_DEFAULT_SIZE, \"rpx\")\n          }\n        };\n      } else {\n        scaleArea = {\n          type: 'rect',\n          css: {\n            height: \"\".concat(2 * ACTION_DEFAULT_SIZE, \"rpx\"),\n            width: \"\".concat(2 * ACTION_DEFAULT_SIZE, \"rpx\"),\n            borderRadius: \"\".concat(ACTION_DEFAULT_SIZE, \"rpx\"),\n            color: '#0000ff'\n          }\n        };\n      }\n      scaleArea.css = _objectSpread(_objectSpread({}, scaleArea.css), {}, {\n        align: 'center',\n        left: \"\".concat(rect.right + ACTION_OFFSET.toPx(), \"px\"),\n        top: type === 'text' ? \"\".concat(rect.top - ACTION_OFFSET.toPx() - scaleArea.css.height.toPx() / 2, \"px\") : \"\".concat(rect.bottom - ACTION_OFFSET.toPx() - scaleArea.css.height.toPx() / 2, \"px\")\n      });\n      Object.assign(scaleArea, {\n        id: 'scale'\n      });\n      return scaleArea;\n    }\n  }, {\n    key: \"getDeleteIcon\",\n    value: function getDeleteIcon(rect) {\n      var deleteArea = {};\n      var customActionStyle = this.props.customActionStyle;\n      if (customActionStyle && customActionStyle.scale) {\n        deleteArea = {\n          type: 'image',\n          url: customActionStyle[\"delete\"].icon,\n          css: {\n            height: \"\".concat(2 * ACTION_DEFAULT_SIZE, \"rpx\"),\n            width: \"\".concat(2 * ACTION_DEFAULT_SIZE, \"rpx\"),\n            borderRadius: \"\".concat(ACTION_DEFAULT_SIZE, \"rpx\")\n          }\n        };\n      } else {\n        deleteArea = {\n          type: 'rect',\n          css: {\n            height: \"\".concat(2 * ACTION_DEFAULT_SIZE, \"rpx\"),\n            width: \"\".concat(2 * ACTION_DEFAULT_SIZE, \"rpx\"),\n            borderRadius: \"\".concat(ACTION_DEFAULT_SIZE, \"rpx\"),\n            color: '#0000ff'\n          }\n        };\n      }\n      deleteArea.css = _objectSpread(_objectSpread({}, deleteArea.css), {}, {\n        align: 'center',\n        left: \"\".concat(rect.left - ACTION_OFFSET.toPx(), \"px\"),\n        top: \"\".concat(rect.top - ACTION_OFFSET.toPx() - deleteArea.css.height.toPx() / 2, \"px\")\n      });\n      Object.assign(deleteArea, {\n        id: 'delete'\n      });\n      return deleteArea;\n    }\n  }, {\n    key: \"doAction\",\n    value: function doAction(action, callback, isMoving, overwrite) {\n      var _this3 = this;\n      if (this.props.use2D) {\n        return;\n      }\n      var newVal = null;\n      if (action) {\n        newVal = action.view;\n      }\n      if (newVal && newVal.id && this.touchedView.id !== newVal.id) {\n        // 带 id 的动作给撤回时使用，不带 id，表示对当前选中对象进行操作\n        var views = this.currentPalette.views;\n        for (var i = 0; i < views.length; i++) {\n          if (views[i].id === newVal.id) {\n            // 跨层回撤，需要重新构建三层关系\n            this.touchedView = views[i];\n            this.findedIndex = i;\n            this.sliceLayers();\n            break;\n          }\n        }\n      }\n      var doView = this.touchedView;\n      if (!doView || this.isEmpty(doView)) {\n        return;\n      }\n      if (newVal && newVal.css) {\n        if (overwrite) {\n          doView.css = newVal.css;\n        } else if (Array.isArray(doView.css) && Array.isArray(newVal.css)) {\n          doView.css = Object.assign.apply(Object, [{}].concat(_toConsumableArray(doView.css), _toConsumableArray(newVal.css)));\n        } else if (Array.isArray(doView.css)) {\n          doView.css = Object.assign.apply(Object, [{}].concat(_toConsumableArray(doView.css), [newVal.css]));\n        } else if (Array.isArray(newVal.css)) {\n          doView.css = Object.assign.apply(Object, [{}, doView.css].concat(_toConsumableArray(newVal.css)));\n        } else {\n          doView.css = _objectSpread(_objectSpread({}, doView.css), newVal.css);\n        }\n      }\n      if (newVal && newVal.rect) {\n        doView.rect = newVal.rect;\n      }\n      if (newVal && newVal.url && doView.url && newVal.url !== doView.url) {\n        var downloader = new Downloader();\n        downloader.download(newVal.url, this.props.LRU).then(function (path) {\n          if (newVal.url.startsWith('https')) {\n            doView.originUrl = newVal.url;\n          }\n          doView.url = path;\n          Taro.getImageInfo({\n            src: path,\n            success: function success(res) {\n              doView.sHeight = res.height;\n              doView.sWidth = res.width;\n              _this3.reDraw(doView, callback, isMoving);\n            },\n            fail: function fail() {\n              _this3.reDraw(doView, callback, isMoving);\n            }\n          });\n        })[\"catch\"](function (error) {\n          // 未下载成功，直接绘制\n          console.error(error);\n          _this3.reDraw(doView, callback, isMoving);\n        });\n      } else {\n        newVal && newVal.text && doView.text && newVal.text !== doView.text && (doView.text = newVal.text);\n        newVal && newVal.content && doView.content && newVal.content !== doView.content && (doView.content = newVal.content);\n        this.reDraw(doView, callback, isMoving);\n      }\n    }\n  }, {\n    key: \"reDraw\",\n    value: function reDraw(doView, callback, isMoving) {\n      var _this4 = this;\n      var draw = {\n        width: this.currentPalette.width,\n        height: this.currentPalette.height,\n        views: this.isEmpty(doView) ? [] : [doView]\n      };\n      var pen = new Pen(this.globalContext, draw);\n      pen.paint(function (callbackInfo) {\n        callback && callback(callbackInfo);\n        _this4.triggerEvent('viewUpdate', {\n          view: _this4.touchedView\n        });\n      });\n      var rect = doView.rect,\n        css = doView.css,\n        type = doView.type;\n      this.block = {\n        width: this.currentPalette.width,\n        height: this.currentPalette.height,\n        views: this.isEmpty(doView) ? [] : [this.getBox(rect, doView.type)]\n      };\n      if (css && css.scalable) {\n        this.block.views.push(this.getScaleIcon(rect, type));\n      }\n      if (css && css.deletable) {\n        this.block.views.push(this.getDeleteIcon(rect));\n      }\n      var topBlock = new Pen(this.frontContext, this.block);\n      topBlock.paint();\n    }\n  }, {\n    key: \"isInView\",\n    value: function isInView(x, y, rect) {\n      return x > rect.left && y > rect.top && x < rect.right && y < rect.bottom;\n    }\n  }, {\n    key: \"isInDelete\",\n    value: function isInDelete(x, y) {\n      var _iterator = _createForOfIteratorHelper(this.block.views),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var view = _step.value;\n          if (view.id === 'delete') {\n            return x > view.rect.left && y > view.rect.top && x < view.rect.right && y < view.rect.bottom;\n          }\n        }\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      return false;\n    }\n  }, {\n    key: \"isInScale\",\n    value: function isInScale(x, y) {\n      var _iterator2 = _createForOfIteratorHelper(this.block.views),\n        _step2;\n      try {\n        for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n          var view = _step2.value;\n          if (view.id === 'scale') {\n            return x > view.rect.left && y > view.rect.top && x < view.rect.right && y < view.rect.bottom;\n          }\n        }\n      } catch (err) {\n        _iterator2.e(err);\n      } finally {\n        _iterator2.f();\n      }\n      return false;\n    }\n  }, {\n    key: \"onClick\",\n    value: function onClick() {\n      var x = this.startX;\n      var y = this.startY;\n      var totalLayerCount = this.currentPalette.views.length;\n      var canBeTouched = [];\n      var isDelete = false;\n      var deleteIndex = -1;\n      for (var i = totalLayerCount - 1; i >= 0; i--) {\n        var view = this.currentPalette.views[i];\n        var rect = view.rect;\n        if (this.touchedView && this.touchedView.id && this.touchedView.id === view.id && this.isInDelete(x, y, rect)) {\n          canBeTouched.length = 0;\n          deleteIndex = i;\n          isDelete = true;\n          break;\n        }\n        if (this.isInView(x, y, rect)) {\n          canBeTouched.push({\n            view: view,\n            index: i\n          });\n        }\n      }\n      this.touchedView = {};\n      if (canBeTouched.length === 0) {\n        this.findedIndex = -1;\n      } else {\n        var _i = 0;\n        var touchAble = canBeTouched.filter(function (item) {\n          return Boolean(item.view.id);\n        });\n        if (touchAble.length === 0) {\n          this.findedIndex = canBeTouched[0].index;\n        } else {\n          for (_i = 0; _i < touchAble.length; _i++) {\n            if (this.findedIndex === touchAble[_i].index) {\n              _i++;\n              break;\n            }\n          }\n          if (_i === touchAble.length) {\n            _i = 0;\n          }\n          this.touchedView = touchAble[_i].view;\n          this.findedIndex = touchAble[_i].index;\n          this.triggerEvent('viewClicked', {\n            view: this.touchedView\n          });\n        }\n      }\n      if (this.findedIndex < 0 || this.touchedView && !this.touchedView.id) {\n        // 证明点击了背景 或无法移动的view\n        this.frontContext.draw();\n        if (isDelete) {\n          this.triggerEvent('touchEnd', {\n            view: this.currentPalette.views[deleteIndex],\n            index: deleteIndex,\n            type: 'delete'\n          });\n          this.doAction();\n        } else if (this.findedIndex < 0) {\n          this.triggerEvent('viewClicked', {});\n        }\n        this.findedIndex = -1;\n        this.prevFindedIndex = -1;\n      } else if (this.touchedView && this.touchedView.id) {\n        this.sliceLayers();\n      }\n    }\n  }, {\n    key: \"triggerEvent\",\n    value: function triggerEvent(method, data) {\n      if (this.props[method]) {\n        this.props[method](data);\n      }\n    }\n  }, {\n    key: \"sliceLayers\",\n    value: function sliceLayers() {\n      var bottomLayers = this.currentPalette.views.slice(0, this.findedIndex);\n      var topLayers = this.currentPalette.views.slice(this.findedIndex + 1);\n      var bottomDraw = {\n        width: this.currentPalette.width,\n        height: this.currentPalette.height,\n        background: this.currentPalette.background,\n        views: bottomLayers\n      };\n      var topDraw = {\n        width: this.currentPalette.width,\n        height: this.currentPalette.height,\n        views: topLayers\n      };\n      if (this.prevFindedIndex < this.findedIndex) {\n        new Pen(this.bottomContext, bottomDraw).paint();\n        this.doAction();\n        new Pen(this.topContext, topDraw).paint();\n      } else {\n        new Pen(this.topContext, topDraw).paint();\n        this.doAction();\n        new Pen(this.bottomContext, bottomDraw).paint();\n      }\n      this.prevFindedIndex = this.findedIndex;\n    }\n  }, {\n    key: \"onTouchStart\",\n    value: function onTouchStart(event) {\n      if (this.isDisabled) {\n        return;\n      }\n      var _event$touches$ = event.touches[0],\n        x = _event$touches$.x,\n        y = _event$touches$.y;\n      this.startX = x;\n      this.startY = y;\n      this.startTimeStamp = new Date().getTime();\n      if (this.touchedView && !this.isEmpty(this.touchedView)) {\n        var rect = this.touchedView.rect;\n        if (this.isInScale(x, y, rect)) {\n          this.isScale = true;\n          this.startH = rect.bottom - rect.top;\n          this.startW = rect.right - rect.left;\n        } else {\n          this.isScale = false;\n        }\n      } else {\n        this.isScale = false;\n      }\n    }\n  }, {\n    key: \"onTouchEnd\",\n    value: function onTouchEnd(e) {\n      if (this.isDisabled) {\n        return;\n      }\n      var current = new Date().getTime();\n      if (current - this.startTimeStamp <= 500 && !this.hasMove) {\n        !this.isScale && this.onClick(e);\n      } else if (this.touchedView && !this.isEmpty(this.touchedView)) {\n        this.triggerEvent('touchEnd', {\n          view: this.touchedView\n        });\n      }\n      this.hasMove = false;\n    }\n  }, {\n    key: \"onTouchCancel\",\n    value: function onTouchCancel(e) {\n      if (this.isDisabled) {\n        return;\n      }\n      this.onTouchEnd(e);\n    }\n  }, {\n    key: \"onTouchMove\",\n    value: function onTouchMove(event) {\n      if (this.isDisabled) {\n        return;\n      }\n      this.hasMove = true;\n      if (!this.touchedView || this.touchedView && !this.touchedView.id) {\n        return;\n      }\n      var _event$touches$2 = event.touches[0],\n        x = _event$touches$2.x,\n        y = _event$touches$2.y;\n      var offsetX = x - this.startX;\n      var offsetY = y - this.startY;\n      var _this$touchedView = this.touchedView,\n        rect = _this$touchedView.rect,\n        type = _this$touchedView.type;\n      var css = {};\n      if (this.isScale) {\n        clearPenCache(this.touchedView.id);\n        var newW = this.startW + offsetX > 1 ? this.startW + offsetX : 1;\n        if (this.touchedView.css && this.touchedView.css.minWidth) {\n          if (newW < this.touchedView.css.minWidth.toPx()) {\n            return;\n          }\n        }\n        if (this.touchedView.rect && this.touchedView.rect.minWidth) {\n          if (newW < this.touchedView.rect.minWidth) {\n            return;\n          }\n        }\n        var newH = this.startH + offsetY > 1 ? this.startH + offsetY : 1;\n        css = {\n          width: \"\".concat(newW, \"px\")\n        };\n        if (type !== 'text') {\n          if (type === 'image') {\n            css.height = \"\".concat(newW * this.startH / this.startW, \"px\");\n          } else {\n            css.height = \"\".concat(newH, \"px\");\n          }\n        }\n      } else {\n        this.startX = x;\n        this.startY = y;\n        css = {\n          left: \"\".concat(rect.x + offsetX, \"px\"),\n          top: \"\".concat(rect.y + offsetY, \"px\"),\n          right: undefined,\n          bottom: undefined\n        };\n      }\n      this.doAction({\n        view: {\n          css: css\n        }\n      }, null, !this.isScale);\n    }\n  }, {\n    key: \"initScreenK\",\n    value: function initScreenK() {\n      if (!(getApp() && getApp().systemInfo && getApp().systemInfo.screenWidth)) {\n        try {\n          getApp().systemInfo = Taro.getSystemInfoSync();\n        } catch (e) {\n          console.error(\"Painter get system info failed, \".concat(JSON.stringify(e)));\n          return;\n        }\n      }\n      this.screenK = 0.5;\n      if (getApp() && getApp().systemInfo && getApp().systemInfo.screenWidth) {\n        this.screenK = getApp().systemInfo.screenWidth / 750;\n      }\n      setStringPrototype(this.screenK, this.props.scaleRatio);\n    }\n  }, {\n    key: \"initDancePalette\",\n    value: function initDancePalette() {\n      var _this5 = this;\n      if (this.props.use2D) {\n        return;\n      }\n      this.isDisabled = true;\n      this.initScreenK();\n      this.downloadImages(this.props.dancePalette).then(/*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee(palette) {\n          var width, height;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                _this5.currentPalette = palette;\n                width = palette.width, height = palette.height;\n                if (!(!width || !height)) {\n                  _context.next = 5;\n                  break;\n                }\n                console.error(\"You should set width and height correctly for painter, width: \".concat(width, \", height: \").concat(height));\n                return _context.abrupt(\"return\");\n              case 5:\n                _this5.setState({\n                  painterStyle: \"width:\".concat(width.toPx(), \"px;height:\").concat(height.toPx(), \"px;\")\n                });\n                _context.t0 = _this5.frontContext;\n                if (_context.t0) {\n                  _context.next = 11;\n                  break;\n                }\n                _context.next = 10;\n                return _this5.getCanvasContext(_this5.props.use2D, 'front');\n              case 10:\n                _this5.frontContext = _context.sent;\n              case 11:\n                _context.t1 = _this5.bottomContext;\n                if (_context.t1) {\n                  _context.next = 16;\n                  break;\n                }\n                _context.next = 15;\n                return _this5.getCanvasContext(_this5.props.use2D, 'bottom');\n              case 15:\n                _this5.bottomContext = _context.sent;\n              case 16:\n                _context.t2 = _this5.topContext;\n                if (_context.t2) {\n                  _context.next = 21;\n                  break;\n                }\n                _context.next = 20;\n                return _this5.getCanvasContext(_this5.props.use2D, 'top');\n              case 20:\n                _this5.topContext = _context.sent;\n              case 21:\n                _context.t3 = _this5.globalContext;\n                if (_context.t3) {\n                  _context.next = 26;\n                  break;\n                }\n                _context.next = 25;\n                return _this5.getCanvasContext(_this5.props.use2D, 'k-canvas');\n              case 25:\n                _this5.globalContext = _context.sent;\n              case 26:\n                new Pen(_this5.bottomContext, palette, _this5.props.use2D).paint(function () {\n                  _this5.isDisabled = false;\n                  _this5.isDisabled = _this5.outterDisabled;\n                  _this5.triggerEvent('didShow');\n                });\n                _this5.globalContext.draw();\n                _this5.frontContext.draw();\n                _this5.topContext.draw();\n              case 30:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee);\n        }));\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n      this.touchedView = {};\n    }\n  }, {\n    key: \"startPaint\",\n    value: function startPaint() {\n      var _this6 = this;\n      this.initScreenK();\n      var _this$props$palette = this.props.palette,\n        width = _this$props$palette.width,\n        height = _this$props$palette.height;\n      if (!width || !height) {\n        console.error(\"You should set width and height correctly for painter, width: \".concat(width, \", height: \").concat(height));\n        return;\n      }\n      var needScale = false;\n      // 生成图片时，根据设置的像素值重新绘制\n      if (width.toPx() !== this.canvasWidthInPx) {\n        this.canvasWidthInPx = width.toPx();\n        needScale = this.props.use2D;\n      }\n      if (this.props.widthPixels) {\n        setStringPrototype(this.screenK, this.props.widthPixels / this.canvasWidthInPx);\n        this.canvasWidthInPx = this.props.widthPixels;\n      }\n      if (this.canvasHeightInPx !== height.toPx()) {\n        this.canvasHeightInPx = height.toPx();\n        needScale = needScale || this.props.use2D;\n      }\n      this.setState({\n        photoStyle: \"width:\".concat(this.canvasWidthInPx, \"px;height:\").concat(this.canvasHeightInPx, \"px;\")\n      }, function () {\n        _this6.downloadImages(_this6.props.palette).then(/*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(/*#__PURE__*/regeneratorRuntime.mark(function _callee2(palette) {\n            var scale;\n            return regeneratorRuntime.wrap(function _callee2$(_context2) {\n              while (1) switch (_context2.prev = _context2.next) {\n                case 0:\n                  if (_this6.photoContext) {\n                    _context2.next = 4;\n                    break;\n                  }\n                  _context2.next = 3;\n                  return _this6.getCanvasContext(_this6.props.use2D, 'photo');\n                case 3:\n                  _this6.photoContext = _context2.sent;\n                case 4:\n                  if (needScale) {\n                    scale = getApp().systemInfo.pixelRatio;\n                    _this6.photoContext.width = _this6.canvasWidthInPx * scale;\n                    _this6.photoContext.height = _this6.canvasHeightInPx * scale;\n                    _this6.photoContext.scale(scale, scale);\n                  }\n                  new Pen(_this6.photoContext, palette).paint(function () {\n                    _this6.saveImgToLocal();\n                  });\n                  setStringPrototype(_this6.screenK, _this6.props.scaleRatio);\n                case 7:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }, _callee2);\n          }));\n          return function (_x2) {\n            return _ref2.apply(this, arguments);\n          };\n        }());\n      });\n    }\n  }, {\n    key: \"downloadImages\",\n    value: function downloadImages(palette) {\n      var _this7 = this;\n      return new Promise(function (resolve, reject) {\n        var preCount = 0;\n        var completeCount = 0;\n        var paletteCopy = JSON.parse(JSON.stringify(palette));\n        if (paletteCopy.background) {\n          preCount++;\n          var downloader = new Downloader();\n          downloader.download(paletteCopy.background, _this7.props.LRU).then(function (path) {\n            paletteCopy.background = path;\n            completeCount++;\n            if (preCount === completeCount) {\n              resolve(paletteCopy);\n            }\n          }, function () {\n            completeCount++;\n            if (preCount === completeCount) {\n              resolve(paletteCopy);\n            }\n          });\n        }\n        if (paletteCopy.views) {\n          var _iterator3 = _createForOfIteratorHelper(paletteCopy.views),\n            _step3;\n          try {\n            var _loop = function _loop() {\n              var view = _step3.value;\n              if (view && view.type === 'image' && view.url) {\n                preCount++;\n                var _downloader = new Downloader();\n                /* eslint-disable no-loop-func */\n                _downloader.download(view.url, _this7.props.LRU).then(function (path) {\n                  view.originUrl = view.url;\n                  view.url = path;\n                  Taro.getImageInfo({\n                    src: path,\n                    success: function success(res) {\n                      // 获得一下图片信息，供后续裁减使用\n                      view.sWidth = res.width;\n                      view.sHeight = res.height;\n                    },\n                    fail: function fail(error) {\n                      // 如果图片坏了，则直接置空，防止坑爹的 canvas 画崩溃了\n                      console.warn(\"getImageInfo \".concat(view.originUrl, \" failed, \").concat(JSON.stringify(error)));\n                      view.url = '';\n                    },\n                    complete: function complete() {\n                      completeCount++;\n                      if (preCount === completeCount) {\n                        resolve(paletteCopy);\n                      }\n                    }\n                  });\n                }, function () {\n                  completeCount++;\n                  if (preCount === completeCount) {\n                    resolve(paletteCopy);\n                  }\n                });\n              }\n            };\n            for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n              _loop();\n            }\n          } catch (err) {\n            _iterator3.e(err);\n          } finally {\n            _iterator3.f();\n          }\n        }\n        if (preCount === 0) {\n          resolve(paletteCopy);\n        }\n      });\n    }\n  }, {\n    key: \"saveImgToLocal\",\n    value: function saveImgToLocal() {\n      var _this8 = this;\n      var that = this;\n      var optionsOf2d = {\n        canvas: that.canvasNode\n      };\n      var optionsOfOld = {\n        canvasId: 'photo',\n        destWidth: that.canvasWidthInPx,\n        destHeight: that.canvasHeightInPx\n      };\n      var timer = setTimeout(function () {\n        clearTimeout(timer);\n        Taro.canvasToTempFilePath(_objectSpread(_objectSpread({}, that.props.use2D ? optionsOf2d : optionsOfOld), {}, {\n          success: function success(res) {\n            that.getImageInfo(res.tempFilePath);\n          },\n          fail: function fail(error) {\n            console.error(\"canvasToTempFilePath failed, \".concat(JSON.stringify(error)));\n            that.triggerEvent('imgErr', {\n              error: error\n            });\n          }\n        }), _this8);\n      }, 300);\n    }\n  }, {\n    key: \"getCanvasContext\",\n    value: function getCanvasContext(use2D, id) {\n      var that = this;\n      return new Promise(function (resolve) {\n        if (use2D) {\n          var query = Taro.createSelectorQuery();\n          var selectId = \"#\".concat(id);\n          query.select(selectId).fields({\n            node: true,\n            size: true\n          }).exec(function (res) {\n            that.canvasNode = res[0] && res[0].node;\n            if (that.canvasNode) {\n              var ctx = that.canvasNode.getContext('2d');\n              var wxCanvas = new WxCanvas('2d', ctx, id, true, that.canvasNode);\n              resolve(wxCanvas);\n            }\n          });\n        } else {\n          var temp = Taro.createCanvasContext(id, that);\n          resolve(new WxCanvas('mina', temp, id, true));\n        }\n      });\n    }\n  }, {\n    key: \"getImageInfo\",\n    value: function getImageInfo(filePath) {\n      var that = this;\n      Taro.getImageInfo({\n        src: filePath,\n        success: function success(infoRes) {\n          if (that.paintCount > MAX_PAINT_COUNT) {\n            var error = \"The result is always fault, even we tried \".concat(MAX_PAINT_COUNT, \" times\");\n            console.error(error);\n            that.triggerEvent('imgErr', {\n              error: error\n            });\n            return;\n          }\n          // 比例相符时才证明绘制成功，否则进行强制重绘制\n          if (Math.abs((infoRes.width * that.canvasHeightInPx - that.canvasWidthInPx * infoRes.height) / (infoRes.height * that.canvasHeightInPx)) < 0.01) {\n            that.triggerEvent('imgOK', {\n              path: filePath\n            });\n          } else {\n            that.startPaint();\n          }\n          that.paintCount++;\n        },\n        fail: function fail(error) {\n          console.error(\"getImageInfo failed, \".concat(JSON.stringify(error)));\n          that.triggerEvent('imgErr', {\n            error: error\n          });\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this9 = this;\n      var _this$state = this.state,\n        painterStyle = _this$state.painterStyle,\n        photoStyle = _this$state.photoStyle;\n      var _this$props2 = this.props,\n        customStyle = _this$props2.customStyle,\n        use2D = _this$props2.use2D;\n      return /*#__PURE__*/React.createElement(View, {\n        style: \"position: relative;\".concat(customStyle, \";\").concat(painterStyle)\n      }, !use2D ? /*#__PURE__*/React.createElement(Fragment, null, /*#__PURE__*/React.createElement(Canvas, {\n        canvasId: \"photo\",\n        style: \"\".concat(photoStyle, \";position: absolute; left: -9999px; top: -9999rpx;\")\n      }), dancePalette && /*#__PURE__*/React.createElement(Fragment, null, /*#__PURE__*/React.createElement(Canvas, {\n        canvasId: \"bottom\",\n        style: \"\".concat(painterStyle, \" ;position: absolute;\")\n      }), /*#__PURE__*/React.createElement(Canvas, {\n        canvasId: \"k-canvas\",\n        style: \"\".concat(painterStyle, \" ;position: absolute;\")\n      }), /*#__PURE__*/React.createElement(Canvas, {\n        canvasId: \"top\",\n        style: \"\".concat(painterStyle, \" ;position: absolute;\")\n      }), /*#__PURE__*/React.createElement(Canvas, {\n        canvasId: \"front\",\n        style: \"\".concat(painterStyle, \" ;position: absolute;\"),\n        onTouchStart: function onTouchStart(e) {\n          return _this9.onTouchStart(e);\n        },\n        onTouchMove: function onTouchMove(e) {\n          return _this9.onTouchMove(e);\n        },\n        onTouchEnd: function onTouchEnd(e) {\n          return _this9.onTouchEnd(e);\n        },\n        onTouchCancel: function onTouchCancel(e) {\n          return _this9.onTouchCancel(e);\n        },\n        disableScroll: true\n      }))) : /*#__PURE__*/React.createElement(Fragment, null, /*#__PURE__*/React.createElement(Canvas, {\n        type: \"2d\",\n        id: \"photo\",\n        style: photoStyle\n      })));\n    }\n  }]);\n}(Component);\nexport default WeAppPoster;\nWeAppPoster.defaultProps = {\n  use2D: false,\n  customStyle: '',\n  customActionStyle: {},\n  palette: {},\n  dancePalette: {},\n  scaleRatio: 1,\n  widthPixels: 0,\n  dirty: false,\n  LRU: false,\n  action: {},\n  disableAction: false,\n  clearActionBox: false\n};","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/result/result!./result.tsx\"\nvar config = {\"navigationBarTitleText\":\"鉴定结果\",\"navigationStyle\":\"custom\"};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/result/result', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n","function _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nmodule.exports = _arrayLikeToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return arrayLikeToArray(r);\n}\nmodule.exports = _arrayWithoutHoles, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\nfunction _createForOfIteratorHelper(r, e) {\n  var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (!t) {\n    if (Array.isArray(r) || (t = unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) {\n      t && (r = t);\n      var _n = 0,\n        F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          return _n >= r.length ? {\n            done: !0\n          } : {\n            done: !1,\n            value: r[_n++]\n          };\n        },\n        e: function e(r) {\n          throw r;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var o,\n    a = !0,\n    u = !1;\n  return {\n    s: function s() {\n      t = t.call(r);\n    },\n    n: function n() {\n      var r = t.next();\n      return a = r.done, r;\n    },\n    e: function e(r) {\n      u = !0, o = r;\n    },\n    f: function f() {\n      try {\n        a || null == t[\"return\"] || t[\"return\"]();\n      } finally {\n        if (u) throw o;\n      }\n    }\n  };\n}\nmodule.exports = _createForOfIteratorHelper, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nmodule.exports = _iterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nmodule.exports = _nonIterableSpread, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayWithoutHoles = require(\"./arrayWithoutHoles.js\");\nvar iterableToArray = require(\"./iterableToArray.js\");\nvar unsupportedIterableToArray = require(\"./unsupportedIterableToArray.js\");\nvar nonIterableSpread = require(\"./nonIterableSpread.js\");\nfunction _toConsumableArray(r) {\n  return arrayWithoutHoles(r) || iterableToArray(r) || unsupportedIterableToArray(r) || nonIterableSpread();\n}\nmodule.exports = _toConsumableArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var arrayLikeToArray = require(\"./arrayLikeToArray.js\");\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? arrayLikeToArray(r, a) : void 0;\n  }\n}\nmodule.exports = _unsupportedIterableToArray, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","import unsupportedIterableToArray from \"./unsupportedIterableToArray.js\";\nfunction _createForOfIteratorHelper(r, e) {\n  var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (!t) {\n    if (Array.isArray(r) || (t = unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) {\n      t && (r = t);\n      var _n = 0,\n        F = function F() {};\n      return {\n        s: F,\n        n: function n() {\n          return _n >= r.length ? {\n            done: !0\n          } : {\n            done: !1,\n            value: r[_n++]\n          };\n        },\n        e: function e(r) {\n          throw r;\n        },\n        f: F\n      };\n    }\n    throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n  }\n  var o,\n    a = !0,\n    u = !1;\n  return {\n    s: function s() {\n      t = t.call(r);\n    },\n    n: function n() {\n      var r = t.next();\n      return a = r.done, r;\n    },\n    e: function e(r) {\n      u = !0, o = r;\n    },\n    f: function f() {\n      try {\n        a || null == t[\"return\"] || t[\"return\"]();\n      } finally {\n        if (u) throw o;\n      }\n    }\n  };\n}\nexport { _createForOfIteratorHelper as default };"],"names":[],"sourceRoot":""}