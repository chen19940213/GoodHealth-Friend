{"version":3,"file":"app.js","mappings":";;;;;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACtDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACrBA;AAGA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AAGA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAnCA;AAAA;AAAA;AAqCA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAbA;AAAA;AAAA;AAAA;AAeA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAbA;AAAA;AAAA;AAAA;AAeA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAbA;AAAA;AAAA;AAAA;AAeA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAIA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAEA;AAbA;AAAA;AAAA;AAAA;AAcA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAEA;AAXA;AAAA;AAAA;AAAA;AAaA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxQA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AAUA;AACA;AACA;AACA;AACA;AACA;AALA;AAMA;AAEA;AACA;AACA;AAFA;AAKA;AACA;AACA;AACA;AAHA;AAIA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAQA;AAAA;AAAA;AACA;AACA;AAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAAA;AAAA;AASA;AACA;AAAA;AACA;AACA;AAAA;AAAA;AACA;;AAEA;AACA;AACA;AACA;AACA;AAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAbA;AAAA;AAAA;AAAA;AAeA;AACA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AAGA;AACA;AAEA;AAEA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AACA;AAlCA;AAAA;AAAA;AAAA;AAoCA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAGA","sources":["webpack://AppStarCardWXSS/./node_modules/@hb/wisdom-config-sdk/lib/client/index.js","webpack://AppStarCardWXSS/./src/app.tsx","webpack://AppStarCardWXSS/./src/app.tsx?c9a4","webpack://AppStarCardWXSS/./src/common/fusion.tsx","webpack://AppStarCardWXSS/./src/models/appModel.ts"],"sourcesContent":["!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define([],e):\"object\"==typeof exports?exports.HBConfigSDKclient=e():t.HBConfigSDKclient=e()}(this,(function(){return function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=2)}([function(t,e,n){\"use strict\";n.d(e,\"a\",(function(){return s}));var o=function(t,e){try{return t()}catch(t){return e}};var r=function(){return(r=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},i=function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function u(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,c)}s((o=o.apply(t,e||[])).next())}))},u=function(t,e){var n,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},\"function\"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError(\"Generator is already executing.\");for(;u;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(r=u.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){u=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){u.label=i[1];break}if(6===i[0]&&u.label<r[1]){u.label=r[1],r=i;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(i);break}r[2]&&u.ops.pop(),u.trys.pop();continue}i=e.call(t,u)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}},c={project:\"\",fallback:null,fromCache:!0},s=function(){function t(t){this.options=Object.assign({},t),this.cache={}}return t.prototype.requestProject=function(t,e){var n,i,u=this;void 0===e&&(e=\"default\");var c=function(t,e,n,o){return void 0===n&&(n=\"default\"),void 0===o&&(o=\"pro\"),\"https://assets.51downapp.cn/wisdom-config/v1/\"+o+\"/\"+t+\"/\"+e+\"/\"+n+\"/index.json\"}(t,this.options.env,this.options.func||\"default\",this.options.secretEnv||\"pro\");return this.cache[t]?this.cache[t][e]||(this.cache[t][e]=Promise.resolve({})):this.cache[t]=((n={})[e]=Promise.resolve({}),n),Object.assign(this.cache[t],r({},this.cache[t]||{}),((i={})[e]=this.options.request(c,this.options.timeOut).then((function(t){return t&&\"string\"==typeof t?o((function(){return JSON.parse(t)}),t):t})).catch((function(t){return u.log(t&&t.message?t.message:t,\"error\"),null})).then((function(e){return\"object\"!==Object.prototype.toString.call(e).slice(8,-1).toLowerCase()&&u.log(t+\" 配置的内容不合法\"),u.log(\"请求\"+t+\"配置成功: \"+JSON.stringify(e)),e})),i)),this.cache[t][e]},t.prototype.setConfig=function(t){Object.assign(this.options,t),this.cache={}},t.prototype.deriveInfo=function(t){if(!t)return null;var e=t.split(\".\").filter((function(t){return t}));return 1===e.length?this.options.project?{project:this.options.project,func:\"default\",field:e[0]}:null:2===e.length?{project:e[0],func:\"default\",field:e[1]}:3===e.length?{project:e[0],func:e[1],field:e[2]}:null},t.prototype.get=function(t,e,n){return void 0===n&&(n={fromCache:!0}),i(this,void 0,void 0,(function(){var r,i,c,s,a,l,f=this;return u(this,(function(u){return(r=this.deriveInfo(t))?(i=r.project,c=r.func,s=r.field,a=n.fromCache,l=o((function(){return f.cache[i][c]}),null),a&&l||this.requestProject(i),o((function(){return!!f.cache[i][c]}),!1)?[2,this.cache[i][c].then((function(t){return o((function(){if(!t||!t.value)return f.log(\"获取项目\"+i+\"下字段\"+s+\"值失败，项目数据结构错误，请在后台检查一致性，返回fallback: \"+e),e;var n=t.value[s],o=(n||{}).value;return void 0===n||void 0===o?(f.log(\"获取项目\"+i+\"下字段\"+s+\"值失败，返回fallback: \"+e),e):(f.log(\"获取项目\"+i+\"下字段\"+s+\"值成功: \"+o),o)}),e)}))]:(this.log(i+\"获取失败，返回fallback: \"+e),[2,e])):(this.log(\"信息不全\",\"error\"),[2,e])}))}))},t.prototype.getAll=function(t){return i(this,void 0,void 0,(function(){var e,n,o;return u(this,(function(r){switch(r.label){case 0:return(e=Object.assign(c,{project:this.options.project},t||{})).project?e.fromCache&&this.cache[e.project]&&this.cache[e.project].default?[2,this.cache[e.project].default]:[4,this.requestProject(e.project)]:(this.log(\"getAll 未指定项目名\"),[2,e.fallback||null]);case 1:return(n=r.sent())&&(o=n.value)?[2,Object.keys(o).reduce((function(t,e){return t[e]=o[e].value,t}),{})]:[2,null]}}))}))},t.prototype.log=function(t,e){void 0===e&&(e=\"log\"),this.options.log&&console[e](\"[Config SDK]: \"+t)},t}()},,function(t,e,n){\"use strict\";n.r(e);var o,r=n(0),i=(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u={request:function(t,e){return new Promise((function(n,o){var r=3e4;if(e&&/^[1-9]\\d*$/.test(String(e))&&e<6e5&&(r=e),window&&\"undefined\"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;i.open(\"GET\",t),i.timeout=r,i.onloadend=function(){i.status>=200&&i.status<300||304===i.status?n(JSON.parse(i.response)):o(null)},i.onabort=o,i.ontimeout=o,i.onerror=o,i.setRequestHeader(\"Content-Type\",\"application/json; charset=UTF-8\"),i.send()}else\"undefined\"!=typeof my&&my.request&&my.canIUse&&my.canIUse(\"request\")?my.request({url:t,method:\"GET\",timeout:r,success:function(t){return n(t.data)},headers:{\"Content-Type\":\"application/json; charset=utf-8\"},fail:o}):\"undefined\"!=typeof wx&&wx.request&&wx.canIUse&&wx.canIUse(\"request\")?wx.request({url:t,method:\"GET\",headers:{\"Content-Type\":\"application/json; charset=utf-8\"},success:function(t){return n(t.data)},fail:o}):o(null)}))},env:\"pro\"},c=function(t){function e(e){return t.call(this,Object.assign({},u,e||{}))||this}return i(e,t),e}(r.a);e.default=c}])}));","import _classCallCheck from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"/Users/chenwenying/Desktop/\\u661F\\u706B\\u5DE5\\u574A-sparkLab/AppStarCardWXSS/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport Taro, { getCurrentInstance } from '@tarojs/taro';\nimport React, { Component } from 'react';\nimport { Provider } from 'mobx-react';\nimport appModel from '@/models/appModel';\nimport Native from '@/common/native';\nimport { Ubt } from '@hb/taro-fusion-components';\nimport Fusion from '@/common/fusion';\nimport '@/app.scss';\n\n// 导出原始的 APM, PageT\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar _Ubt$exports = Ubt.exports(),\n  APM = _Ubt$exports.APM,\n  PageT = _Ubt$exports.PageT;\n// 配置页面打开时间\nAPM.pageStartTime();\n// 执行 PageT\nPageT(Taro, getCurrentInstance);\n// Fusion 初始化\nFusion.init();\nvar App = /*#__PURE__*/function (_Component) {\n  function App() {\n    _classCallCheck(this, App);\n    return _callSuper(this, App, arguments);\n  }\n  _inherits(App, _Component);\n  return _createClass(App, [{\n    key: \"onLaunch\",\n    value: function onLaunch(options) {\n      // 版本更新检测\n      appModel.checkAppUpdate();\n      // 初始化\n      appModel.init(options);\n    }\n  }, {\n    key: \"componentDidShow\",\n    value: function componentDidShow(options) {\n      if (Native.IS_WEAPP) {\n        appModel.setScene(options);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return /*#__PURE__*/_jsx(Provider, {\n        children: this.props.children\n      });\n    }\n  }]);\n}(Component);\nexport default App;","import '@tarojs/plugin-platform-tt/dist/runtime'\nimport '@tarojs/plugin-inject/dist/runtime'\n\nimport { window } from '@tarojs/runtime'\nimport { createReactApp } from '@tarojs/plugin-framework-react/dist/runtime'\nimport { initPxTransform } from '@tarojs/taro'\n\nimport component from \"!!../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=app!./app.tsx\"\n\nimport * as React from 'react'\nimport ReactDOM from 'react-dom'\n\nvar config = {\"pages\":[\"pages/index/index\",\"pages/my/my\",\"pages/identification/identification\",\"pages/camera/camera\",\"pages/appraisal/appraisal\",\"pages/result/result\",\"pages/settings/settings\",\"pages/profile/profile\",\"pages/nickname-edit/nickname-edit\",\"pages/login/login\",\"pages/about/about\"],\"subPackages\":[{\"root\":\"pages/cathouse\",\"pages\":[\"cathouse-detail/cathouse-detail\"]},{\"root\":\"pages/webview\",\"pages\":[\"webview\"]}],\"tabBar\":{\"list\":[{\"iconPath\":\"./assets/tabs/homepage.png\",\"selectedIconPath\":\"./assets/tabs/homepage_selected.png\",\"pagePath\":\"pages/index/index\",\"text\":\"首页\"},{\"iconPath\":\"./assets/tabs/my.png\",\"selectedIconPath\":\"./assets/tabs/my_selected.png\",\"pagePath\":\"pages/my/my\",\"text\":\"我的\"}],\"color\":\"#333333\",\"selectedColor\":\"#000000\",\"backgroundColor\":\"#fff\",\"borderStyle\":\"black\"},\"window\":{\"backgroundTextStyle\":\"light\",\"navigationBarBackgroundColor\":\"#fff\",\"navigationBarTitleText\":\"哈啰\",\"navigationBarTextStyle\":\"black\"}};\nwindow.__taroAppConfig = config\nvar inst = App(createReactApp(component, React, ReactDOM, config))\n\ninitPxTransform({\n  designWidth: 750,\n  deviceRatio: {\"375\":2,\"640\":1.17,\"750\":1,\"828\":0.905},\n  baseFontSize: 20,\n  unitPrecision: undefined,\n  targetUnit: undefined\n})\n","import React from 'react';\nimport {\n  Ubt, PageSkeleton, Http, Native, ICodeEnv,\n} from '@hb/taro-fusion-components';\nimport Taro from '@tarojs/taro';\nimport Env from '@/common/env';\nimport appConst from '@/constants/app.const';\nimport appModel from '@/models/appModel';\nimport { LoginEvent } from '@/common/events';\nimport loginModel from '@/models/loginModel';\n\nlet mobileInfo = {};\nconst getMobileInfo = () => {\n  if (Object.keys(mobileInfo).length) {\n    return mobileInfo;\n  }\n  try {\n    const {\n      model, system, platform, version,\n    } = Taro.getSystemInfoSync();\n\n    mobileInfo = {\n      mobileVersion: version || 'UNKNOW',\n      mobileModel: model || 'UNKNOW',\n      mobileSystem: system || 'UNKNOW',\n      systemPlatform: platform || 'UNKNOW',\n    };\n    return mobileInfo;\n  } catch {\n    return {\n      mobileVersion: 'UNKNOW',\n      mobileModel: 'UNKNOW',\n      mobileSystem: 'UNKNOW',\n      systemPlatform: 'UNKNOW',\n    };\n  }\n};\n\nconst getHttpBaseParams = () => {\n  const { scene, traceId } = appModel;\n\n  const httpBaseParams = {\n    version: Env.appVersion,\n    appName: Env.appName,\n    $scene: scene,\n    $traceId: traceId,\n    systemCode: appConst.SYSTEM_CODE,\n    ...getMobileInfo(),\n    ...Env.codeEnv !== 'pro' ? {\n      __sysTag: Env.codeEnvTag,\n    } : {},\n  };\n\n  return httpBaseParams;\n};\n\nclass Fusion {\n  /**\n   * 初始化Ubt\n   */\n  static initUbt() {\n    const { appName, appVersion, codeEnv } = Env;\n    const bindUbtData = async () => {\n      const { guid } = await loginModel.getLoginResult();\n      const { latitude, longitude } = await appModel.getLocation({ fromCache: true });\n\n      const {\n        platform,\n        model: deviceModel,\n        version = '',\n        system: osVersion,\n        windowHeight: screenHeight,\n        windowWidth: screenWidth,\n        brand: manufacturer,\n        language,\n      } = Taro.getSystemInfoSync();\n\n      Ubt.bindData({\n        appName,\n        releaseVersion: appVersion,\n        appVersion,\n        latitude: () => latitude,\n        longitude: () => longitude,\n        cityCode: () => '-1',\n        cityName: () => '-1',\n        adCode: () => '-1',\n        userGuid: () => guid,\n        os: () => platform,\n        deviceModel: () => deviceModel,\n        manufacturer: () => manufacturer,\n        version: () => version,\n        osVersion: () => osVersion,\n        screenHeight: () => screenHeight,\n        screenWidth: () => screenWidth,\n        language: () => language,\n      });\n      return guid;\n    };\n\n    Ubt.config({\n      debug: codeEnv !== 'pro',\n      categoryId: appConst.CATEGORY_ID || '',\n      logMaxCount: 3,\n      logTimeout: 3000,\n\n      beforePageView: async (params) => {\n        const { scene, traceId } = appModel;\n        const userGuid = await bindUbtData();\n\n        return {\n          ...params,\n          businessInfo: {\n            ...params.businessInfo,\n            scene,\n            traceId,\n            userGuid,\n          },\n        };\n      },\n\n      beforePageViewOut: async (params) => {\n        const { scene, traceId } = appModel;\n        const userGuid = await bindUbtData();\n\n        return {\n          ...params,\n          businessInfo: {\n            ...params.businessInfo,\n            scene,\n            traceId,\n            userGuid,\n          },\n        };\n      },\n\n      beforeClickButton: async (params) => {\n        const { scene, traceId } = appModel;\n        const userGuid = await bindUbtData();\n\n        return {\n          ...params,\n          businessInfo: {\n            ...params.businessInfo,\n            scene,\n            traceId,\n            userGuid,\n          },\n        };\n      },\n\n      beforeModuleExpose: async (params) => {\n        const { scene, traceId } = appModel;\n        const userGuid = await bindUbtData();\n\n        return {\n          ...params,\n          businessInfo: {\n            ...params.businessInfo,\n            scene,\n            traceId,\n            userGuid,\n          },\n        };\n      },\n    });\n  }\n\n  /**\n   * 初始化Http\n   */\n  static initHttp() {\n    const { APM } = Ubt.exports();\n\n    Http.config({\n      baseURL: appConst.API,\n      /**\n       * 附加通用业务参数\n       */\n      requestParams: async () => {\n        const { token, ticket } = await loginModel.getLoginResult();\n        const { latitude, longitude } = await appModel.getLocation();\n\n        return {\n          ...getHttpBaseParams(),\n          latitude,\n          longitude,\n          ticket,\n          token,\n        };\n      },\n\n      timeout: 15000,\n      /**\n       * 请求发送前统计\n       * 扁鹊上的网络分析\n       */\n      beforeRequest(options) {\n        APM.trackHttp(options);\n        return options;\n      },\n      /**\n       * 处理业务错误码\n       */\n      onBizCodeError(res) {\n      // 登录态过期\n        if (res.code === 103) {\n          Native.showToast('登录态已过期，请重新登录');\n          loginModel.logout();\n        } else {\n          Native.showToast(res.msg || '');\n        }\n      },\n    });\n  }\n\n  /**\n   * 初始化PageSkeleton\n   */\n  static initPageSkeleton() {\n    PageSkeleton.setGlobalOptions({\n      // customSlotRender: (props) => {\n      //   const { hideElf } = props.customProps || {};\n      //   // 生产环境不渲染该逻辑\n      //   if (process.env.CODE_ENV !== 'pro' || Number(process.env.IS_CI) !== 1) {\n      //     // eslint-disable-next-line\n      //     const Elf = require('@/components/common/Elf').default;\n      //     return !hideElf && <Elf />;\n      //   }\n      //   return null;\n      // },\n      onPageUnload() {\n        // 移除当前页面的登录监听器\n        LoginEvent.offCurrent();\n      },\n    });\n  }\n\n  /**\n   * 初始化Native\n   */\n  static initNative() {\n    Native.config({\n      shareAppOptions: {\n        shareOriginId: appConst.MINA_ORIGIN_ID,\n      },\n    });\n  }\n\n  static init() {\n    Fusion.initNative();\n    // Fusion.initUbt();\n    Fusion.initPageSkeleton();\n    Fusion.initHttp();\n  }\n}\n\n// 注册到 Env 中\nEnv.register((codeEnv: ICodeEnv) => {\n  Taro.nextTick(() => {\n    Native.setCodeEnv(codeEnv);\n    Fusion.init();\n  });\n});\n\nexport default Fusion;\n","import Taro from '@tarojs/taro';\nimport { AppShowOptions, ILocationResult, ILocationOptions } from '@/services/types';\nimport env from '@/common/env';\nimport { IGetLocationOptions, Native } from '@hb/taro-fusion-components';\nimport loginModel from '@/models/loginModel';\nimport appConst from '@/constants/app.const';\n\nconst defaultLocation: ILocationResult = {\n  longitude: '0',\n  latitude: '0',\n  resultType: 1,\n};\n\nclass AppModel {\n  /**\n   * 打开小程序的场景值，由系统分配：\n   * - weapp 官方文档：https://developers.weixin.qq.com/miniprogram/dev/reference/scene-list.html\n   * - alipay 官方文档：https://opendocs.alipay.com/mini/08otyv\n   * - tt 官方文档：https://developer.open-douyin.com/docs/resource/zh-CN/mini-app/develop/framework/scene-value\n   * - mpaas 在链接中自定义：hellobike://hellobike.com/bifrost?name={appName}&appId={appId}&scene={scene}&page={page}\n   * @default 0 - 表示没有获取到scene值\n   */\n  scene = 0;\n\n  /**\n   * 链路跟踪id, 由访问链接携带传入，携带规则见 `setTraceId` 定义\n   * @description 该字段会自动上送到所有接口及埋点中:\n   * - 接口报文：$scene、$traceId\n   * - 埋点：businessInfo: { traceId, scene }\n   */\n  traceId = ''; // 由访问入口传入，跟踪用户访问行为\n\n  /**\n   * 缓存当前位置信息，默认为 null\n   */\n  getLocationPromise: Promise<ILocationResult> | null = null;\n\n  /**\n   * 存放 wisdown 配置信息，配置后启用\n   * @see https://hellobike.yuque.com/gzxsb9/gt85o7/mfwxfq?\n   */\n  wisdomConfig = Object.create(null);\n\n  /**\n   * 初始化小程序\n   */\n  init(options: AppShowOptions) {\n    // 设置小程序 打开场景值\n    this.setScene(options);\n    // 设置小程序访问的traceId\n    this.setTraceId(options);\n    // 初始化登录态\n    loginModel.initAppLogin();\n\n    // 初始化当前定位（可开关）\n    this.getLocation();\n    // 初始化 wisdom（可开关）\n    this.initWisdom();\n  }\n\n  /**\n   * 设置小程序打开的`scene`值（兼容全端）\n   * - 原生小程序：由系统分配（weapp、alipay）\n   * - MPAAS：通过链接地址携带`scene`:\n   * hellobike://hellobike.com/bifrost?name={appName}&appId={appId}&scene={scene}&page={page}\n   * @param options\n   */\n  setScene(options: AppShowOptions) {\n    const { scene, query = {} } = options;\n    // 默认2000\n    const { scene: appscene = -1 } = query;\n\n    // MPAAS 的 scene 从 query 中获取\n    if (Native.IS_MPAAS) {\n      this.scene = +appscene;\n    } else {\n      this.scene = scene;\n    }\n  }\n\n  /**\n   * 设置小程序访问的`traceId`值（兼容全端）\n   * 各场景跳转链接格式如下：\n   * - 小程序码（微信太阳码）: /pages/index/index?traceId={traceId}\n   * - 小自定义二维码（微信）: https://c3x.me/miaowa/index?traceId={traceId}\n   * - MPAAS Scheme: hellobike://hellobike.com/bifrost?name={appName}&appId={appId}&page={encode(pageUrl)}&traceId={traceId}\n   * - 支付宝 Scheme: alipays://platformapi/startapp?appId={appId}&page={encode(pageUrl)}&query={encode(traceId={traceId})}\n   * @param options\n   */\n  setTraceId(options: AppShowOptions) {\n    const { query = {} } = options;\n    // 默认为空，即无traceId\n    const { traceId = '', q } = query;\n    this.traceId = traceId;\n\n    // 兼容微信普通二维码参数获取\n    if (Native.IS_WEAPP && q) {\n      const { traceId: wxTraceId } = Native.getUrlParams({\n        url: decodeURIComponent(q as string),\n      });\n      if (wxTraceId) {\n        this.traceId = wxTraceId;\n      }\n    }\n    // 当全局没有时，从页面参数中获取\n    if (!this.traceId && Native.IS_MPAAS) {\n      Taro.nextTick(() => {\n        const { traceId: pageTraceId } = Native.getUrlParams();\n        if (pageTraceId) {\n          this.traceId = pageTraceId;\n        }\n      });\n    }\n  }\n\n  /**\n   * 初始化 wisdom 配置\n   * @description 配置项参考：https://hellobike.yuque.com/gzxsb9/gt85o7/mfwxfq\n   */\n  async initWisdom() {\n    // 全局不启用 wisdom\n    if (+appConst.WISHDOM_ENABLE === 0) {\n      return;\n    }\n    // eslint-disable-next-line\n    const ClientSDK = require('@hb/wisdom-config-sdk').default;\n\n    const { codeEnv } = env;\n    const clientSDK = () => new ClientSDK({ project: 'AppStarCardWXSS', env: codeEnv });\n    const clientConfigEvent = clientSDK();\n    const wisdownConfig = await clientConfigEvent.getAll();\n    this.wisdomConfig = wisdownConfig || {};\n  }\n\n  /**\n   * 获取地理位置信息\n   * @param fromCache 当对实时性要求不高时，可设置 `fromCache:true`，此时会优先查缓存，以提升获取速度。\n   * @returns ILocationResult\n   */\n  async getLocation(options: ILocationOptions = {}) {\n    const {\n      fromCache = true,\n      ...restOptions\n    } = options;\n\n    // 全局不启用定位\n    if (+appConst.LOCATION_ENABLE === 0) {\n      return Promise.resolve(defaultLocation);\n    }\n\n    if (fromCache) {\n      // 如果有缓存，直接返回缓存\n      if (this.getLocationPromise) {\n        return this.getLocationPromise.then((res) => ({\n          ...res,\n          resultType: 2,\n        }));\n      }\n    }\n    // 重新请求定位\n    this.getLocationPromise = Native.getLocation(\n      restOptions as IGetLocationOptions,\n    ).then((res) => ({\n      ...res,\n      resultType: 0,\n    })).catch(() => {\n      // 本次获取失败，清理缓存，下次重新获取\n      this.getLocationPromise = null;\n      // 返回默认值\n      return defaultLocation;\n    });\n\n    return this.getLocationPromise;\n  }\n\n  /**\n   * 小程序检查更新\n   * @supported weapp\n   */\n  checkAppUpdate() {\n    // 全局不启用检查更新\n    if (+appConst.UPDATE_ENABLE === 0) {\n      return;\n    }\n    if (Taro.canIUse('getUpdateManager')) {\n      const updateManager = Taro.getUpdateManager();\n      updateManager.onCheckForUpdate((res) => {\n        if (res.hasUpdate) {\n          updateManager.onUpdateReady(() => {\n            Taro.showModal({\n              title: '更新提示',\n              content: '新版本已经准备好，是否重启应用？',\n              success(rs) {\n                if (rs.confirm) {\n                  updateManager.applyUpdate();\n                }\n              },\n            });\n          });\n          updateManager.onUpdateFailed(() => {\n            Taro.showModal({\n              title: '已经有新版本了哟~',\n              content: '新版本已经上线啦~，请您删除当前小程序，重新搜索打开哟~',\n            });\n          });\n        }\n      });\n    } else {\n      Taro.showModal({\n        title: '提示',\n        content:\n          '当前微信版本过低，无法更好体验程序，请升级到最新微信版本后重试。',\n      });\n    }\n  }\n}\n\nexport default new AppModel();\n"],"names":[],"sourceRoot":""}