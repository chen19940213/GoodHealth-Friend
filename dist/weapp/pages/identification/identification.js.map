{"version":3,"file":"pages/identification/identification.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACxSA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://AppStarCardWXSS/./src/pages/identification/identification.tsx?f975","webpack://AppStarCardWXSS/._src_pages_identification_identification.tsx"],"sourcesContent":["import _regenerator from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nvar _class;\nimport React, { Component, Fragment } from 'react';\nimport { observer } from 'mobx-react';\nimport { View, Image, Text } from '@tarojs/components';\nimport { PageSkeleton, Native, PageHeader } from '@hb/taro-fusion-components';\nimport Taro from '@tarojs/taro';\nimport './identification.scss';\nimport { scanIcon } from '@/assets/index';\nimport photoModel from '@/models/photoModel';\nimport { CAMERA_STEP_INFO } from '@/constants/page.const';\nimport { requestCreateAppraisalApi, requestUploadFileApi } from '@/services/apis/index.api';\nimport { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\nvar Identification = observer(_class = /*#__PURE__*/function (_Component) {\n  function Identification() {\n    var _this;\n    _classCallCheck(this, Identification);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, Identification, [].concat(args));\n    _defineProperty(_this, \"handleBack\", function () {\n      Taro.navigateBack();\n    });\n    _defineProperty(_this, \"handleSubmit\", /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var allPhotos, totalSteps, photoPaths, step, photo, uploadPromises, uploadResults, imageUrls, response, errorMsg, _t;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            // 获取所有照片\n            allPhotos = photoModel.getAllPhotos();\n            totalSteps = Object.keys(CAMERA_STEP_INFO).length; // 按步骤顺序收集照片路径\n            photoPaths = [];\n            for (step = 1; step <= totalSteps; step += 1) {\n              photo = allPhotos[step];\n              if (photo) {\n                photoPaths.push(photo);\n              }\n            }\n\n            // 如果没有照片，提示用户\n            if (!(photoPaths.length === 0)) {\n              _context.n = 1;\n              break;\n            }\n            Native.showToast('请先拍摄照片');\n            return _context.a(2);\n          case 1:\n            _context.p = 1;\n            // 显示提交中提示\n            Taro.showLoading({\n              title: '正在上传照片...'\n            });\n\n            // 步骤1：上传所有照片到服务器，获取 URL 数组\n            uploadPromises = photoPaths.map(function (photoPath) {\n              return requestUploadFileApi({\n                filePath: photoPath\n              });\n            });\n            _context.n = 2;\n            return Promise.all(uploadPromises);\n          case 2:\n            uploadResults = _context.v;\n            // 提取所有上传成功的 URL\n            imageUrls = [];\n            uploadResults.forEach(function (result) {\n              if (result.url) {\n                imageUrls.push(result.url);\n              }\n            });\n\n            // 检查是否所有照片都上传成功\n            if (!(imageUrls.length !== photoPaths.length)) {\n              _context.n = 3;\n              break;\n            }\n            Taro.hideLoading();\n            Native.showToast('部分照片上传失败，请重试');\n            return _context.a(2);\n          case 3:\n            // 步骤2：调用创建鉴定接口\n            Taro.showLoading({\n              title: '正在提交鉴定...'\n            });\n            _context.n = 4;\n            return requestCreateAppraisalApi({\n              card_image: imageUrls\n            });\n          case 4:\n            response = _context.v;\n            // 隐藏加载提示\n            Taro.hideLoading();\n\n            // 提交成功，跳转到鉴定中页面\n            if (response.code === 0) {\n              Native.showToast('提交成功');\n              // 延迟跳转，让用户看到成功提示\n              setTimeout(function () {\n                Taro.navigateTo({\n                  url: '/pages/appraisal/appraisal'\n                });\n              }, 1000);\n            } else {\n              Native.showToast(response.message || '提交失败，请重试');\n            }\n            _context.n = 6;\n            break;\n          case 5:\n            _context.p = 5;\n            _t = _context.v;\n            // 隐藏加载提示\n            Taro.hideLoading();\n            errorMsg = _t instanceof Error ? _t.message : '提交失败，请重试';\n            Native.showToast(errorMsg);\n          case 6:\n            return _context.a(2);\n        }\n      }, _callee, null, [[1, 5]]);\n    })));\n    _defineProperty(_this, \"handlePhotoClick\", function (step) {\n      Taro.navigateTo({\n        url: \"/pages/camera/camera?step=\".concat(step)\n      });\n    });\n    _defineProperty(_this, \"handleExampleImageClick\", function (imageSrc) {\n      var totalSteps = Object.keys(CAMERA_STEP_INFO).length;\n      var imageUrls = Array.from({\n        length: totalSteps\n      }, function (_, index) {\n        var step = index + 1;\n        return CAMERA_STEP_INFO[step].image;\n      });\n      Taro.previewImage({\n        urls: imageUrls,\n        current: imageSrc\n      });\n    });\n    _defineProperty(_this, \"handleAgreementClick\", function () {\n      // 跳转到协议页面\n      Taro.navigateTo({\n        url: \"/pages/webview/webview?url=\".concat(encodeURIComponent('https://m.hellobike.com/mf/spa/u_rntimj/latest/MA2310164656593543907773012.html?activityCode=MA2310164656593543907773012'), \"&title=\\u661F\\u5361\\u9274\\u5B9A\\u5728\\u7EBF\\u9274\\u522B\\u534F\\u8BAE\")\n      });\n    });\n    return _this;\n  }\n  _inherits(Identification, _Component);\n  return _createClass(Identification, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      Native.hideHomeButton();\n    }\n  }, {\n    key: \"componentDidShow\",\n    value: function componentDidShow() {\n      // 页面显示时的逻辑\n    }\n  }, {\n    key: \"componentDidHide\",\n    value: function componentDidHide() {\n      // 页面隐藏时的逻辑\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n      var totalSteps = Object.keys(CAMERA_STEP_INFO).length;\n\n      // 检查所有必填步骤是否都已完成\n      var isAllRequiredPhotosTaken = function isAllRequiredPhotosTaken() {\n        return Object.keys(CAMERA_STEP_INFO).every(function (stepKey) {\n          var step = parseInt(stepKey, 10);\n          var stepInfo = CAMERA_STEP_INFO[step];\n          // 检查该步骤是否有有效照片\n          var photo = photoModel.getPhoto(step);\n          var hasPhoto = photo && photo !== null && photo !== undefined && photo.trim() !== '';\n          // 如果该步骤是必填的，则必须有照片；如果不是必填的，则不需要检查\n          return stepInfo.required ? hasPhoto : true;\n        });\n      };\n      var canSubmit = isAllRequiredPhotosTaken();\n      return /*#__PURE__*/_jsxs(PageSkeleton, {\n        className: \"page-identification-view\",\n        children: [/*#__PURE__*/_jsx(Fragment, {\n          children: /*#__PURE__*/_jsx(PageHeader, {\n            title: \"\\u8BC6\\u522B\\u9274\\u5B9A\"\n          })\n        }, \"header\"), /*#__PURE__*/_jsxs(Fragment, {\n          children: [/*#__PURE__*/_jsxs(View, {\n            className: \"instruction-section\",\n            children: [/*#__PURE__*/_jsx(View, {\n              className: \"instruction-title\",\n              children: \"\\u8BF7\\u6309\\u7167\\u5982\\u4E0B\\u987A\\u5E8F\\u4F9D\\u6B21\\u62CD\\u6444\\u6E05\\u6670\\u5B8C\\u6574\\u7684\\u9274\\u5B9A\\u70B9\\u56FE\\u7247\"\n            }), /*#__PURE__*/_jsx(View, {\n              className: \"photo-upload-section\",\n              children: Array.from({\n                length: totalSteps\n              }, function (_, index) {\n                var step = index + 1;\n                var stepInfo = CAMERA_STEP_INFO[step];\n                var photo = photoModel.getPhoto(step);\n                return /*#__PURE__*/_jsxs(View, {\n                  className: \"photo-item\",\n                  onClick: function onClick() {\n                    return _this2.handlePhotoClick(step);\n                  },\n                  children: [/*#__PURE__*/_jsx(View, {\n                    className: \"photo-frame\",\n                    children: photo ? /*#__PURE__*/_jsx(Image, {\n                      className: \"photo-image\",\n                      src: photo,\n                      mode: \"aspectFill\"\n                    }) : /*#__PURE__*/_jsx(View, {\n                      className: \"photo-placeholder\",\n                      children: /*#__PURE__*/_jsx(View, {\n                        className: \"plus-icon\"\n                      })\n                    })\n                  }), /*#__PURE__*/_jsxs(View, {\n                    className: \"photo-label\",\n                    children: [stepInfo.required && /*#__PURE__*/_jsx(View, {\n                      className: \"required-mark\",\n                      children: \"*\"\n                    }), /*#__PURE__*/_jsx(View, {\n                      className: \"label-text\",\n                      children: stepInfo.label\n                    })]\n                  })]\n                }, step);\n              })\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"agreement-text\",\n              children: [\"\\u63D0\\u4EA4\\u5373\\u5DF2\\u9605\\u8BFB\\u4E14\\u540C\\u610F\", /*#__PURE__*/_jsx(Text, {\n                className: \"agreement-text-link\",\n                onClick: this.handleAgreementClick,\n                children: \"\\u300A\\u661F\\u5361\\u9274\\u5B9A\\u5728\\u7EBF\\u9274\\u522B\\u534F\\u8BAE\\u300B\"\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(View, {\n            className: \"example-section\",\n            children: [/*#__PURE__*/_jsx(View, {\n              className: \"example-title\",\n              children: \"\\u62CD\\u6444\\u8303\\u4F8B\"\n            }), /*#__PURE__*/_jsx(View, {\n              className: \"example-images\",\n              children: Array.from({\n                length: totalSteps\n              }, function (_, index) {\n                var step = index + 1;\n                var stepInfo = CAMERA_STEP_INFO[step];\n                return /*#__PURE__*/_jsxs(View, {\n                  className: \"example-item\",\n                  children: [/*#__PURE__*/_jsx(Image, {\n                    className: \"example-image\",\n                    src: stepInfo.image,\n                    mode: \"aspectFill\",\n                    onClick: function onClick() {\n                      return _this2.handleExampleImageClick(stepInfo.image);\n                    }\n                  }), /*#__PURE__*/_jsxs(View, {\n                    className: \"example-label\",\n                    children: [stepInfo.required && /*#__PURE__*/_jsx(View, {\n                      className: \"required-mark\",\n                      children: \"*\"\n                    }), stepInfo.label]\n                  })]\n                }, step);\n              })\n            })]\n          }), /*#__PURE__*/_jsx(View, {\n            className: \"submit-section\",\n            children: /*#__PURE__*/_jsxs(View, {\n              className: \"submit-button \".concat(canSubmit ? 'active' : 'disabled'),\n              onClick: canSubmit ? this.handleSubmit : undefined,\n              children: [/*#__PURE__*/_jsx(View, {\n                className: \"submit-icon\",\n                children: /*#__PURE__*/_jsx(Image, {\n                  src: scanIcon,\n                  className: \"icon-image\"\n                })\n              }), /*#__PURE__*/_jsx(View, {\n                className: \"submit-text\",\n                children: \"\\u63D0\\u4EA4\\u9274\\u5B9A\"\n              })]\n            })\n          })]\n        }, \"scroll\")]\n      });\n    }\n  }]);\n}(Component)) || _class;\nexport { Identification as default };","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/identification/identification!./identification.tsx\"\nvar config = {\"navigationBarTitleText\":\"识别鉴定\",\"navigationStyle\":\"custom\"};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/identification/identification', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n"],"names":[],"sourceRoot":""}