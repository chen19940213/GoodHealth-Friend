{"version":3,"file":"pages/my/my.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACnRA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;ACTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["webpack://AppStarCardWXSS/./src/pages/my/my.tsx?06bf","webpack://AppStarCardWXSS/._src_common_tianqi.ts","webpack://AppStarCardWXSS/._src_pages_my_my.tsx"],"sourcesContent":["import _regenerator from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _callSuper from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/callSuper.js\";\nimport _inherits from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _defineProperty from \"C:/Users/\\u9648\\u6587\\u5E94/Desktop/GoodHealth-Friend-main/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nvar _class;\nimport React, { Component, Fragment } from 'react';\nimport { observer } from 'mobx-react';\nimport { View, Text, Button } from '@tarojs/components';\nimport { OssImage, Native, SafeAreaView } from '@hb/taro-fusion-components';\nimport Taro from '@tarojs/taro';\nimport { myUBT } from '@/common/tianqi';\nimport loginModel from '@/models/loginModel';\nimport myModel from '@/models/myModel';\nimport { defaultUserAvatar } from '@/constants/page.const';\nimport './my.scss';\nimport { jumpToAnyUrl } from '@/utils/jumpTo';\nimport { noListIcon } from '@/assets/index';\nimport { requestWxLoginMockApi } from '@/services/apis/login.api';\nimport PageSkeleton from '@/components/PageSkeleton';\nimport { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from \"react/jsx-runtime\";\nvar My = observer(_class = /*#__PURE__*/function (_Component) {\n  function My() {\n    var _this;\n    _classCallCheck(this, My);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, My, [].concat(args));\n    _defineProperty(_this, \"handleSettingsClick\", function () {\n      jumpToAnyUrl('/pages/settings/settings');\n    });\n    _defineProperty(_this, \"handleLoginClick\", function () {\n      Taro.getUserProfile({\n        desc: '用于完善用户资料',\n        success: function success() {\n          // 获取用户信息后，调用登录处理\n          _this.handleWxLogin();\n        },\n        fail: function fail() {\n          Native.showToast('获取用户信息失败');\n        }\n      });\n    });\n    // 微信登录处理\n    _defineProperty(_this, \"handleWxLogin\", /*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      var loginRes, result, err, _t;\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.p = _context.n) {\n          case 0:\n            _context.p = 0;\n            _context.n = 1;\n            return Taro.login();\n          case 1:\n            loginRes = _context.v;\n            if (loginRes.code) {\n              _context.n = 2;\n              break;\n            }\n            Native.showToast('获取微信登录凭证失败');\n            return _context.a(2);\n          case 2:\n            _context.n = 3;\n            return requestWxLoginMockApi({\n              code: loginRes.code\n              // userInfo: {\n              //   nickName: userInfo.nickName,\n              //   avatarUrl: userInfo.avatarUrl,\n              //   gender: userInfo.gender,\n              //   city: userInfo.city,\n              //   province: userInfo.province,\n              //   country: userInfo.country,\n              // },\n            });\n          case 3:\n            result = _context.v;\n            Taro.hideLoading();\n\n            // 登录成功，保存登录信息（包含 openId）\n            _this.handleLoginSuccess(result.data);\n            _context.n = 5;\n            break;\n          case 4:\n            _context.p = 4;\n            _t = _context.v;\n            Taro.hideLoading();\n            err = _t;\n            Native.showToast(err.message || '登录失败，请重试');\n          case 5:\n            return _context.a(2);\n        }\n      }, _callee, null, [[0, 4]]);\n    })));\n    _defineProperty(_this, \"handleLoginSuccess\", function (res) {\n      // eslint-disable-next-line no-console\n      console.log('登录成功，保存的数据:', res);\n      loginModel.setLoginResult(res);\n      Native.showToast('登录成功');\n    });\n    _defineProperty(_this, \"handleScrollToLower\", function () {\n      // 加载更多数据\n      if (!myModel.loading && myModel.hasMore) {\n        myModel.getMyIdentifyTaskList(false);\n      }\n    });\n    _defineProperty(_this, \"renderNoList\", function () {\n      return /*#__PURE__*/_jsxs(View, {\n        className: \"no-list-container\",\n        children: [/*#__PURE__*/_jsx(Image, {\n          src: noListIcon,\n          className: \"no-list-icon\"\n        }), /*#__PURE__*/_jsx(View, {\n          className: \"no-list-text\",\n          children: \"\\u6682\\u65F6\\u6CA1\\u6709\\u9274\\u5B9A\\u4EFB\\u4F55\\u4E1C\\u897F\\u54E6\\uFF5E\"\n        })]\n      });\n    });\n    return _this;\n  }\n  _inherits(My, _Component);\n  return _createClass(My, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      // 监听登录态变化\n      loginModel.checkLogin(function (isLogin) {\n        // eslint-disable-next-line no-console\n        console.log('登录态变化', isLogin, loginModel.loginResult);\n        if (isLogin) {\n          // 登录了，重新请求列表数据\n          myModel.getMyIdentifyTaskList(true);\n        } else {\n          // 未登录，清空列表数据\n          myModel.clearCardList();\n        }\n      }, {\n        observe: true // 开启监听，当登录态变化时自动触发回调\n      });\n    }\n  }, {\n    key: \"componentDidShow\",\n    value: function componentDidShow() {\n      var _loginModel$loginResu, _loginModel$loginResu2;\n      myUBT.pageView();\n      Native.hideHomeButton();\n\n      // 根据当前登录态决定是否请求数据\n      var isLogin = !!((_loginModel$loginResu = loginModel.loginResult) !== null && _loginModel$loginResu !== void 0 && _loginModel$loginResu.token && (_loginModel$loginResu2 = loginModel.loginResult) !== null && _loginModel$loginResu2 !== void 0 && _loginModel$loginResu2.ticket);\n      if (isLogin) {\n        // 已登录，请求我的鉴定任务列表数据（包含 token）\n        myModel.getMyIdentifyTaskList(true);\n      } else {\n        // 未登录，清空列表数据\n        myModel.clearCardList();\n      }\n    }\n  }, {\n    key: \"componentDidHide\",\n    value: function componentDidHide() {\n      myUBT.pageViewOut();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _userInfo, _userInfo2;\n      var loginResult = loginModel.loginResult;\n      var token = loginResult.token;\n      // 从 loginResult 中获取用户信息（可能在不同层级）\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var avatar = (loginResult === null || loginResult === void 0 ? void 0 : loginResult.avatar) || (loginResult === null || loginResult === void 0 || (_userInfo = loginResult.userInfo) === null || _userInfo === void 0 ? void 0 : _userInfo.avatar) || '';\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var nickname = (loginResult === null || loginResult === void 0 ? void 0 : loginResult.nickname) || (loginResult === null || loginResult === void 0 || (_userInfo2 = loginResult.userInfo) === null || _userInfo2 === void 0 ? void 0 : _userInfo2.nickname) || '女王陛下';\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      var userNewId = (loginResult === null || loginResult === void 0 ? void 0 : loginResult.userNewId) || (loginResult === null || loginResult === void 0 ? void 0 : loginResult.userId) || '';\n      var isLogin = !!token;\n      return /*#__PURE__*/_jsx(PageSkeleton, {\n        className: \"page-my-view\",\n        onScrollToLower: this.handleScrollToLower,\n        children: /*#__PURE__*/_jsxs(Fragment, {\n          children: [/*#__PURE__*/_jsx(View, {\n            className: \"top-gradient-bg\"\n          }), /*#__PURE__*/_jsxs(View, {\n            className: \"user-section\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"user-info-container\",\n              children: [/*#__PURE__*/_jsx(OssImage, {\n                className: \"user-avatar\",\n                width: 79,\n                height: 79,\n                src: avatar || defaultUserAvatar\n              }), /*#__PURE__*/_jsx(View, {\n                className: \"user-info\",\n                children: isLogin ? /*#__PURE__*/_jsx(_Fragment, {\n                  children: /*#__PURE__*/_jsx(View, {\n                    className: \"user-nickname\",\n                    children: nickname || '女王陛下'\n                  })\n                }) : /*#__PURE__*/_jsx(_Fragment, {\n                  children: /*#__PURE__*/_jsx(View, {\n                    className: \"login-text-btn\",\n                    onClick: this.handleLoginClick,\n                    children: \"\\u53BB\\u767B\\u5F55\"\n                  })\n                })\n              })]\n            }), /*#__PURE__*/_jsx(View, {\n              className: \"settings-icon-wrapper\",\n              onClick: this.handleSettingsClick,\n              children: /*#__PURE__*/_jsx(View, {\n                className: \"settings-icon\"\n              })\n            })]\n          }), /*#__PURE__*/_jsx(View, {\n            className: \"reason-section\",\n            children: /*#__PURE__*/_jsx(Text, {\n              className: \"reason-text\",\n              children: \"\\u51CF\\u80A5\\u539F\\u56E0\\uFF1A\\u8EAB\\u4F53\\u539F\\u56E0\\u8840\\u8102\\u9AD8\\uFF0C\\u5E0C\\u671B\\u6062\\u590D\\u5065\\u5EB7\\uFF0C\\u52A0\\u6CB9\\uFF01\"\n            })\n          }), /*#__PURE__*/_jsxs(View, {\n            className: \"tags-section\",\n            children: [/*#__PURE__*/_jsxs(View, {\n              className: \"tag-item\",\n              children: [/*#__PURE__*/_jsx(View, {\n                className: \"tag-icon\",\n                children: \"\\uD83C\\uDFF7\\uFE0F\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"tag-text\",\n                children: \"\\u4E2D\\u56FD\\u5973\\u4EBA\"\n              })]\n            }), /*#__PURE__*/_jsx(View, {\n              className: \"tag-item\",\n              children: /*#__PURE__*/_jsx(Text, {\n                className: \"tag-text\",\n                children: \"163\"\n              })\n            }), /*#__PURE__*/_jsx(View, {\n              className: \"tag-item\",\n              children: /*#__PURE__*/_jsx(Text, {\n                className: \"tag-text\",\n                children: \"45\"\n              })\n            })]\n          }), /*#__PURE__*/_jsxs(View, {\n            className: \"feedback-card\",\n            children: [/*#__PURE__*/_jsx(View, {\n              className: \"feedback-avatar\"\n            }), /*#__PURE__*/_jsxs(View, {\n              className: \"feedback-content\",\n              children: [/*#__PURE__*/_jsx(Text, {\n                className: \"feedback-title\",\n                children: \"\\u622A\\u6B62\\u76EE\\u524D\\uFF0C\\u597D\\u5065\\u53CB\\u5DF2\\u6709327939\\u4F4D\\u670B\\u53CB\"\n              }), /*#__PURE__*/_jsx(Text, {\n                className: \"feedback-subtitle\",\n                children: \"\\u7D2F\\u8BA1\\u51CF\\u80A5224434\\u65A4\\uFF0C\\u6298\\u5408288\\u5934\\u8001\\u6BCD\\u732A\\uFF01\"\n              })]\n            })]\n          }), /*#__PURE__*/_jsxs(View, {\n            className: \"action-buttons\",\n            children: [/*#__PURE__*/_jsx(Button, {\n              className: \"action-btn primary\",\n              onClick: function onClick() {},\n              children: \"\\u5173\\u6CE8\\u5C0F\\u7EA2\\u4E66\"\n            }), /*#__PURE__*/_jsx(Button, {\n              className: \"action-btn primary\",\n              onClick: function onClick() {},\n              children: \"\\u52A0\\u7FA4\\u4EA4\\u6D41\"\n            })]\n          }), /*#__PURE__*/_jsx(SafeAreaView, {\n            safeAreaInsetBottom: true\n          })]\n        }, \"scroll\")\n      });\n    }\n  }]);\n}(Component)) || _class;\nexport { My as default };","// Ubt 已移除，使用空对象替代\nexport const indexUBT = {\n  pageView: () => {},\n  pageViewOut: () => {},\n};\n\nexport const myUBT = {\n  pageView: () => {},\n  pageViewOut: () => {},\n};\n","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"!!../../../node_modules/@tarojs/taro-loader/lib/entry-cache.js?name=pages/my/my!./my.tsx\"\nvar config = {\"navigationBarTitleText\":\"\",\"navigationStyle\":\"custom\",\"enableShareAppMessage\":false};\n\n\n\nvar taroOption = createPageConfig(component, 'pages/my/my', {root:{cn:[]}}, config || {})\nif (component && component.behaviors) {\n  taroOption.behaviors = (taroOption.behaviors || []).concat(component.behaviors)\n}\nvar inst = Page(taroOption)\n\n\n\nexport default component\n"],"names":[],"sourceRoot":""}